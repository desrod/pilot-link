<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pilot-link: libpisock/darwinusb.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pilot-link
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('darwinusb_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">darwinusb.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;mach/mach.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;IOKit/IOKitLib.h&gt;</code><br />
<code>#include &lt;IOKit/IOMessage.h&gt;</code><br />
<code>#include &lt;IOKit/IOCFPlugIn.h&gt;</code><br />
<code>#include &lt;IOKit/usb/IOUSBLib.h&gt;</code><br />
<code>#include &lt;CoreFoundation/CFByteOrder.h&gt;</code><br />
<code>#include &quot;pi-debug.h&quot;</code><br />
<code>#include &quot;pi-source.h&quot;</code><br />
<code>#include &quot;pi-usb.h&quot;</code><br />
<code>#include &quot;pi-util.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for darwinusb.c:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c__incl.png" border="0" usemap="#alibpisock_2darwinusb_8c" alt=""/></div>
<map name="alibpisock_2darwinusb_8c" id="alibpisock_2darwinusb_8c">
<area shape="rect" title=" " alt="" coords="686,5,833,31"/>
<area shape="rect" title=" " alt="" coords="5,79,106,105"/>
<area shape="poly" title=" " alt="" coords="686,27,439,46,283,62,121,81,121,76,282,56,439,41,686,21"/>
<area shape="rect" title=" " alt="" coords="129,79,190,105"/>
<area shape="poly" title=" " alt="" coords="686,26,474,44,341,60,205,82,204,76,341,55,473,39,686,21"/>
<area shape="rect" title=" " alt="" coords="214,79,289,105"/>
<area shape="poly" title=" " alt="" coords="686,29,516,49,305,81,304,76,515,44,685,24"/>
<area shape="rect" title=" " alt="" coords="314,79,427,105"/>
<area shape="poly" title=" " alt="" coords="693,34,442,80,441,75,693,29"/>
<area shape="rect" title=" " alt="" coords="452,79,585,105"/>
<area shape="poly" title=" " alt="" coords="719,34,574,77,573,72,718,29"/>
<area shape="rect" title=" " alt="" coords="609,79,744,105"/>
<area shape="poly" title=" " alt="" coords="747,34,704,71,700,67,744,30"/>
<area shape="rect" title=" " alt="" coords="768,79,919,105"/>
<area shape="poly" title=" " alt="" coords="775,30,819,67,816,71,772,34"/>
<area shape="rect" title=" " alt="" coords="943,79,1147,105"/>
<area shape="poly" title=" " alt="" coords="809,29,982,72,981,77,807,34"/>
<area shape="rect" title=" " alt="" coords="1171,79,1252,105"/>
<area shape="poly" title=" " alt="" coords="833,26,979,47,1156,76,1155,81,978,52,833,32"/>
<area shape="rect" title=" " alt="" coords="1277,79,1362,105"/>
<area shape="poly" title=" " alt="" coords="833,23,1023,43,1262,76,1261,81,1023,49,833,29"/>
<area shape="rect" title=" " alt="" coords="1386,79,1453,105"/>
<area shape="poly" title=" " alt="" coords="834,20,1069,38,1218,54,1371,76,1370,81,1217,59,1069,43,833,26"/>
<area shape="rect" title=" " alt="" coords="1477,79,1540,105"/>
<area shape="poly" title=" " alt="" coords="833,19,1106,34,1282,51,1462,76,1462,82,1281,57,1106,40,833,24"/>
</map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structklsi__port__settings.html">klsi_port_settings</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structusb__connection__t.html">usb_connection_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvisor__connection__info.html">visor_connection_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae99d6e8e31cdbd8fc416acd8f0c6df2f" id="r_ae99d6e8e31cdbd8fc416acd8f0c6df2f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae99d6e8e31cdbd8fc416acd8f0c6df2f">AUTO_READ_SIZE</a>&#160;&#160;&#160;64</td></tr>
<tr class="separator:ae99d6e8e31cdbd8fc416acd8f0c6df2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa00463c247d30a7f25d2e64d56155280" id="r_aa00463c247d30a7f25d2e64d56155280"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa00463c247d30a7f25d2e64d56155280">FLAG_ANSWERS_CONN_INFO</a>&#160;&#160;&#160;0x0001		/* device is known to answer connection information requests */</td></tr>
<tr class="separator:aa00463c247d30a7f25d2e64d56155280"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae88563097067473f1b784230241b738f" id="r_ae88563097067473f1b784230241b738f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae88563097067473f1b784230241b738f">FLAG_ANSWERS_PALM_CONN_INFO</a>&#160;&#160;&#160;0x0008		/* means that if the device doesn't answer PALM_EXT_CONNECTION_INFORMATION, don't try the visor variant (for stupid PalmOne handhelds) */</td></tr>
<tr class="separator:ae88563097067473f1b784230241b738f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe9328ad413332e48effd71b542abdc2" id="r_afe9328ad413332e48effd71b542abdc2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe9328ad413332e48effd71b542abdc2">FLAG_REJECT</a>&#160;&#160;&#160;0x8000		/* device is known but not supported yet */</td></tr>
<tr class="separator:afe9328ad413332e48effd71b542abdc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9b65d1aae65a8421de1524846821b5c" id="r_aa9b65d1aae65a8421de1524846821b5c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa9b65d1aae65a8421de1524846821b5c">FLAG_USE_FIRST_PAIR</a>&#160;&#160;&#160;0x0002		/* thanks to dumb programmers at Palm, the connection information doesn't match the actual pipes being used. If this flag is set, always try to use the first endoints <a class="el" href="address_8c.html#a4a228f49a30f09ef05548b421868a382">pair</a> */</td></tr>
<tr class="separator:aa9b65d1aae65a8421de1524846821b5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6fbaed2c346cfabbf727d5b266cfbcb" id="r_af6fbaed2c346cfabbf727d5b266cfbcb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af6fbaed2c346cfabbf727d5b266cfbcb">FLAG_USE_SECOND_PAIR</a>&#160;&#160;&#160;0x0004		/* ditto */</td></tr>
<tr class="separator:af6fbaed2c346cfabbf727d5b266cfbcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23da418422fe26791d70a481bce256d0" id="r_a23da418422fe26791d70a481bce256d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a23da418422fe26791d70a481bce256d0">GENERIC_CLOSE_NOTIFICATION</a>&#160;&#160;&#160;0x02</td></tr>
<tr class="separator:a23da418422fe26791d70a481bce256d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a999d97afe6c8af0e9f6e6592e5dddf2f" id="r_a999d97afe6c8af0e9f6e6592e5dddf2f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a999d97afe6c8af0e9f6e6592e5dddf2f">GENERIC_REQUEST_BYTES_AVAILABLE</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a999d97afe6c8af0e9f6e6592e5dddf2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d20564f344120c5e19bc3592fbab4a3" id="r_a3d20564f344120c5e19bc3592fbab4a3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3d20564f344120c5e19bc3592fbab4a3">KLSI_GET_COMM_DESCRIPTOR</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a3d20564f344120c5e19bc3592fbab4a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5130f6ca9bba7d1661f53742630b226" id="r_aa5130f6ca9bba7d1661f53742630b226"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa5130f6ca9bba7d1661f53742630b226">KLSI_GET_FLOWCONTROL</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:aa5130f6ca9bba7d1661f53742630b226"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5ae397bfab61cd0c527102e53c383ca" id="r_ae5ae397bfab61cd0c527102e53c383ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae5ae397bfab61cd0c527102e53c383ca">KLSI_GET_HANDSHAKE_LINES</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ae5ae397bfab61cd0c527102e53c383ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35995b1ba5040d5eca3ae5dd04224e32" id="r_a35995b1ba5040d5eca3ae5dd04224e32"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a35995b1ba5040d5eca3ae5dd04224e32">KLSI_SET_COMM_DESCRIPTOR</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a35995b1ba5040d5eca3ae5dd04224e32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa26baa08ed15a296e2778f7a543970ca" id="r_aa26baa08ed15a296e2778f7a543970ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa26baa08ed15a296e2778f7a543970ca">KLSI_SET_FLOWCONTROL</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:aa26baa08ed15a296e2778f7a543970ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8c8d9b723564b59e131f14ca660a6ef" id="r_ab8c8d9b723564b59e131f14ca660a6ef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8c8d9b723564b59e131f14ca660a6ef">KLSI_SET_HANDSHAKE_LINES</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:ab8c8d9b723564b59e131f14ca660a6ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0de01b4bd1f5311a37a36b33f27e39a" id="r_af0de01b4bd1f5311a37a36b33f27e39a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af0de01b4bd1f5311a37a36b33f27e39a">MAX_AUTO_READ_SIZE</a>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:af0de01b4bd1f5311a37a36b33f27e39a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22b08ff484c0cfd3cc9536dd3aee44db" id="r_a22b08ff484c0cfd3cc9536dd3aee44db"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a22b08ff484c0cfd3cc9536dd3aee44db">PALM_GET_EXT_CONNECTION_INFORMATION</a>&#160;&#160;&#160;0x04</td></tr>
<tr class="separator:a22b08ff484c0cfd3cc9536dd3aee44db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68c5b2c34f6ab445699a6beb3a93bce3" id="r_a68c5b2c34f6ab445699a6beb3a93bce3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a68c5b2c34f6ab445699a6beb3a93bce3">PRODUCT_HANDSPRING_VISOR</a>&#160;&#160;&#160;0x0100</td></tr>
<tr class="separator:a68c5b2c34f6ab445699a6beb3a93bce3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a601606e0ac4526dd03b88b1b864d046f" id="r_a601606e0ac4526dd03b88b1b864d046f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>&#160;&#160;&#160;0x0080</td></tr>
<tr class="separator:a601606e0ac4526dd03b88b1b864d046f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bbfd6236e2726b2c5922ba25d1711db" id="r_a6bbfd6236e2726b2c5922ba25d1711db"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6bbfd6236e2726b2c5922ba25d1711db">PRODUCT_SONY_CLIE_3_5</a>&#160;&#160;&#160;0x0038</td></tr>
<tr class="separator:a6bbfd6236e2726b2c5922ba25d1711db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb790394ac125bbdc67225d17df07a2" id="r_aadb790394ac125bbdc67225d17df07a2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>(a)&#160;&#160;&#160;do {} while(0)</td></tr>
<tr class="separator:aadb790394ac125bbdc67225d17df07a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8b6376cd0b053b74c7f17b35882c5d0" id="r_ac8b6376cd0b053b74c7f17b35882c5d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac8b6376cd0b053b74c7f17b35882c5d0">VENDOR_HANDSPRING</a>&#160;&#160;&#160;0x082d</td></tr>
<tr class="separator:ac8b6376cd0b053b74c7f17b35882c5d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59879199c074f11c8d710ab0b618a4fb" id="r_a59879199c074f11c8d710ab0b618a4fb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a59879199c074f11c8d710ab0b618a4fb">VENDOR_KEYSPAN</a>&#160;&#160;&#160;0x06cd</td></tr>
<tr class="separator:a59879199c074f11c8d710ab0b618a4fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ae1af091a8c549c6dd222f1348dc4bd" id="r_a0ae1af091a8c549c6dd222f1348dc4bd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a>&#160;&#160;&#160;0x0830</td></tr>
<tr class="separator:a0ae1af091a8c549c6dd222f1348dc4bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a8d346d23be20f1fbfc78e229b6e41b" id="r_a4a8d346d23be20f1fbfc78e229b6e41b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4a8d346d23be20f1fbfc78e229b6e41b">VENDOR_SONY</a>&#160;&#160;&#160;0x054c</td></tr>
<tr class="separator:a4a8d346d23be20f1fbfc78e229b6e41b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b9a2d21d3e6f62d8d96dcadd65e9d3" id="r_a46b9a2d21d3e6f62d8d96dcadd65e9d3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46b9a2d21d3e6f62d8d96dcadd65e9d3">VENDOR_TAPWAVE</a>&#160;&#160;&#160;0x12ef</td></tr>
<tr class="separator:a46b9a2d21d3e6f62d8d96dcadd65e9d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62017a0f13ecb6550aa118043a39bf56" id="r_a62017a0f13ecb6550aa118043a39bf56"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a62017a0f13ecb6550aa118043a39bf56">VISOR_ENDPOINT_1</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a62017a0f13ecb6550aa118043a39bf56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab412e3df0ca860455a9c66478663b4cc" id="r_ab412e3df0ca860455a9c66478663b4cc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab412e3df0ca860455a9c66478663b4cc">VISOR_ENDPOINT_2</a>&#160;&#160;&#160;0x02</td></tr>
<tr class="separator:ab412e3df0ca860455a9c66478663b4cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b54f2a9722be80f664e5ec9433a64ae" id="r_a4b54f2a9722be80f664e5ec9433a64ae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4b54f2a9722be80f664e5ec9433a64ae">VISOR_FUNCTION_CONSOLE</a>&#160;&#160;&#160;0x03</td></tr>
<tr class="separator:a4b54f2a9722be80f664e5ec9433a64ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adde5c16f3a4a6496d40f0ec545da7056" id="r_adde5c16f3a4a6496d40f0ec545da7056"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adde5c16f3a4a6496d40f0ec545da7056">VISOR_FUNCTION_DEBUGGER</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:adde5c16f3a4a6496d40f0ec545da7056"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0987f64d971059f38d9c02f205de0605" id="r_a0987f64d971059f38d9c02f205de0605"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0987f64d971059f38d9c02f205de0605">VISOR_FUNCTION_GENERIC</a>&#160;&#160;&#160;0x00</td></tr>
<tr class="separator:a0987f64d971059f38d9c02f205de0605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad438829a5b519c892325847ed3d7daa4" id="r_ad438829a5b519c892325847ed3d7daa4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad438829a5b519c892325847ed3d7daa4">VISOR_FUNCTION_HOTSYNC</a>&#160;&#160;&#160;0x02</td></tr>
<tr class="separator:ad438829a5b519c892325847ed3d7daa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a727e8ebd40a8aab9603d264c3ddaf193" id="r_a727e8ebd40a8aab9603d264c3ddaf193"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a727e8ebd40a8aab9603d264c3ddaf193">VISOR_FUNCTION_REMOTE_FILE_SYS</a>&#160;&#160;&#160;0x04</td></tr>
<tr class="separator:a727e8ebd40a8aab9603d264c3ddaf193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3b8ec3afa8751af3cb8d549ab49cdec" id="r_ad3b8ec3afa8751af3cb8d549ab49cdec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad3b8ec3afa8751af3cb8d549ab49cdec">VISOR_GET_CONNECTION_INFORMATION</a>&#160;&#160;&#160;0x03</td></tr>
<tr class="separator:ad3b8ec3afa8751af3cb8d549ab49cdec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a505f6c5afa59c9aeaa6453fa5f222951" id="r_a505f6c5afa59c9aeaa6453fa5f222951"><td class="memItemLeft" align="right" valign="top">typedef struct usb_connection_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a505f6c5afa59c9aeaa6453fa5f222951">usb_connection_t</a></td></tr>
<tr class="separator:a505f6c5afa59c9aeaa6453fa5f222951"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:abc6126af1d45847bc59afa0aa3216b04" id="r_abc6126af1d45847bc59afa0aa3216b04"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891">KLSI_BAUD_115200</a> = 0
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440">KLSI_BAUD_57600</a> = 1
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8">KLSI_BAUD_38400</a> = 2
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb">KLSI_BAUD_28800</a> = 3
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc">KLSI_BAUD_19200</a> = 4
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b">KLSI_BAUD_14400</a> = 5
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee">KLSI_BAUD_9600</a> = 6
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1">KLSI_BAUD_7200</a> = 7
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f">KLSI_BAUD_4800</a> = 8
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1">KLSI_BAUD_2400</a> = 9
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a">KLSI_BAUD_1200</a> = 10
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a">KLSI_BAUD_600</a> = 11
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a">KLSI_BAUD_230400</a> = 12
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca">KLSI_PARITY_NONE</a> = 0
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a">KLSI_PARITY_ODD</a> = 1
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad">KLSI_PARITY_EVEN</a> = 2
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe">KLSI_PARITY_MARK</a> = 3
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00">KLSI_STOPBITS_0</a> = 0
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383">KLSI_STOPBITS_2</a> = 2
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c">KLSI_GETHS_DCD</a> = 0x80
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1">KLSI_GETHS_RI</a> = 0x40
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33">KLSI_GETHS_DSR</a> = 0x20
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574">KLSI_GETHS_CTS</a> = 0x10
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2">KLSI_SETHS_RTS</a> = 0x02
, <br />
&#160;&#160;<a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34">KLSI_SETHS_DTR</a> = 0x01
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4">KLSI_FLOW_USE_RTS</a> = 0x01
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c">KLSI_FLOW_USE_DSR</a> = 0x02
, <a class="el" href="#abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523">KLSI_FLOW_USE_XON</a> = 0x04
<br />
 }</td></tr>
<tr class="separator:abc6126af1d45847bc59afa0aa3216b04"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab10d2c139ee0772df628b5e705368986" id="r_ab10d2c139ee0772df628b5e705368986"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab10d2c139ee0772df628b5e705368986">accepts_device</a> (unsigned short vendor, unsigned short product, unsigned short *<a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</td></tr>
<tr class="separator:ab10d2c139ee0772df628b5e705368986"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab97608baf2dc20e00693ea3d28b1c5fe" id="r_ab97608baf2dc20e00693ea3d28b1c5fe"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab97608baf2dc20e00693ea3d28b1c5fe">add_connection</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *c)</td></tr>
<tr class="separator:ab97608baf2dc20e00693ea3d28b1c5fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b11be685f613bf98fd2492cd26c7ce6" id="r_a6b11be685f613bf98fd2492cd26c7ce6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *c, int increment)</td></tr>
<tr class="separator:a6b11be685f613bf98fd2492cd26c7ce6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44db8313ee840eece0ab14aa96ca9bf9" id="r_a44db8313ee840eece0ab14aa96ca9bf9"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a44db8313ee840eece0ab14aa96ca9bf9">configure_device</a> (IOUSBDeviceInterface **dev, unsigned short vendor, unsigned short product, unsigned short <a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>, int *port_number, int *input_pipe_number, int *output_pipe_number, int *pipe_info_retrieved)</td></tr>
<tr class="separator:a44db8313ee840eece0ab14aa96ca9bf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ae745d90757c279ff496b669e7dfff4" id="r_a7ae745d90757c279ff496b669e7dfff4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structusb__connection__t.html">usb_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7ae745d90757c279ff496b669e7dfff4">connection_for_socket</a> (pi_socket_t *ps)</td></tr>
<tr class="separator:a7ae745d90757c279ff496b669e7dfff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bf0b49b7f893ca4dd2b2a7739c59aec" id="r_a6bf0b49b7f893ca4dd2b2a7739c59aec"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a> (IOUSBDeviceInterface **dev, UInt8 requestType, UInt8 request, UInt16 value, UInt16 index, void *pData, UInt16 maxReplyLength)</td></tr>
<tr class="separator:a6bf0b49b7f893ca4dd2b2a7739c59aec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc3c7be2611f3f3152b1351e8d696270" id="r_afc3c7be2611f3f3152b1351e8d696270"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc3c7be2611f3f3152b1351e8d696270">darwinusb_setoptions</a> (int multiple_connections_support)</td></tr>
<tr class="separator:afc3c7be2611f3f3152b1351e8d696270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cc85622030ec13870fc90026ace908b" id="r_a0cc85622030ec13870fc90026ace908b"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0cc85622030ec13870fc90026ace908b">decode_generic_connection_information</a> (<a class="el" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a> *ci, int *port_number, int *input_pipe, int *output_pipe)</td></tr>
<tr class="separator:a0cc85622030ec13870fc90026ace908b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2382b0d9c99eeded50fdcb6f448b92d" id="r_ad2382b0d9c99eeded50fdcb6f448b92d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad2382b0d9c99eeded50fdcb6f448b92d">device_added</a> (void *refCon, io_iterator_t iterator)</td></tr>
<tr class="separator:ad2382b0d9c99eeded50fdcb6f448b92d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6378ac6f6b9262ad7cba19de626cd74b" id="r_a6378ac6f6b9262ad7cba19de626cd74b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6378ac6f6b9262ad7cba19de626cd74b">device_already_in_use</a> (IOUSBDeviceInterface **device)</td></tr>
<tr class="separator:a6378ac6f6b9262ad7cba19de626cd74b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1760782cd564351de8fb058afe311e05" id="r_a1760782cd564351de8fb058afe311e05"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1760782cd564351de8fb058afe311e05">device_notification</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *connexion, io_service_t service, natural_t messageType, void *messageArgument)</td></tr>
<tr class="separator:a1760782cd564351de8fb058afe311e05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2b23562cd53b9fee904b9ad45ab2889" id="r_ad2b23562cd53b9fee904b9ad45ab2889"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad2b23562cd53b9fee904b9ad45ab2889">find_interfaces</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *usb, IOUSBDeviceInterface **dev, unsigned short vendor, unsigned short product, unsigned short accept_flags, int port_number, int input_pipe_number, int output_pipe_number, int pipe_info_retrieved)</td></tr>
<tr class="separator:ad2b23562cd53b9fee904b9ad45ab2889"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75b8e770479707f2ca65619e5e15248b" id="r_a75b8e770479707f2ca65619e5e15248b"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a75b8e770479707f2ca65619e5e15248b">klsi_set_portspeed</a> (IOUSBDeviceInterface **dev, int speed)</td></tr>
<tr class="separator:a75b8e770479707f2ca65619e5e15248b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21b4c9d5b57f1d4a8f6b08b170b1d29f" id="r_a21b4c9d5b57f1d4a8f6b08b170b1d29f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a21b4c9d5b57f1d4a8f6b08b170b1d29f">pi_usb_impl_init</a> (struct pi_usb_impl *impl)</td></tr>
<tr class="separator:a21b4c9d5b57f1d4a8f6b08b170b1d29f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a37658b034e10d52a5affda2c28a26d" id="r_a9a37658b034e10d52a5affda2c28a26d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9a37658b034e10d52a5affda2c28a26d">prime_read</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *connexion)</td></tr>
<tr class="separator:a9a37658b034e10d52a5affda2c28a26d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a657fc918c5800dab2a0fbdf7e4a97d73" id="r_a657fc918c5800dab2a0fbdf7e4a97d73"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a657fc918c5800dab2a0fbdf7e4a97d73">read_completion</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *connexion, IOReturn result, void *arg0)</td></tr>
<tr class="separator:a657fc918c5800dab2a0fbdf7e4a97d73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fdb9881cd44d8dfa115018ef8a8a07a" id="r_a1fdb9881cd44d8dfa115018ef8a8a07a"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1fdb9881cd44d8dfa115018ef8a8a07a">read_generic_connection_information</a> (IOUSBDeviceInterface **dev, int *port_number, int *input_pipe_number, int *output_pipe_number)</td></tr>
<tr class="separator:a1fdb9881cd44d8dfa115018ef8a8a07a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90eff23f2e0b0132dbb82d4cbfeb4cc0" id="r_a90eff23f2e0b0132dbb82d4cbfeb4cc0"><td class="memItemLeft" align="right" valign="top">static IOReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a90eff23f2e0b0132dbb82d4cbfeb4cc0">read_visor_connection_information</a> (IOUSBDeviceInterface **dev, int *port_number, int *input_pipe, int *output_pipe)</td></tr>
<tr class="separator:a90eff23f2e0b0132dbb82d4cbfeb4cc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a173addd105f622a77d8797cad4a33a68" id="r_a173addd105f622a77d8797cad4a33a68"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a173addd105f622a77d8797cad4a33a68">remove_connection</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *c)</td></tr>
<tr class="separator:a173addd105f622a77d8797cad4a33a68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a9d99aa7696e0e755b80cdd81c0709d" id="r_a7a9d99aa7696e0e755b80cdd81c0709d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7a9d99aa7696e0e755b80cdd81c0709d">start_listening</a> (void)</td></tr>
<tr class="separator:a7a9d99aa7696e0e755b80cdd81c0709d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7974faab5165fb2b558c2f0f08e921ae" id="r_a7974faab5165fb2b558c2f0f08e921ae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7974faab5165fb2b558c2f0f08e921ae">stop_listening</a> (<a class="el" href="structusb__connection__t.html">usb_connection_t</a> *c)</td></tr>
<tr class="separator:a7974faab5165fb2b558c2f0f08e921ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18148cdc8c3dbba549e8a762a791bc0e" id="r_a18148cdc8c3dbba549e8a762a791bc0e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a18148cdc8c3dbba549e8a762a791bc0e">u_changebaud</a> (pi_socket_t *ps)</td></tr>
<tr class="separator:a18148cdc8c3dbba549e8a762a791bc0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad04208dd4d06c0f62d2ba47da8269257" id="r_ad04208dd4d06c0f62d2ba47da8269257"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad04208dd4d06c0f62d2ba47da8269257">u_close</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps)</td></tr>
<tr class="separator:ad04208dd4d06c0f62d2ba47da8269257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab042613c0c2ec32c60dbc9b0c5f03b75" id="r_ab042613c0c2ec32c60dbc9b0c5f03b75"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab042613c0c2ec32c60dbc9b0c5f03b75">u_flush</a> (pi_socket_t *ps, int <a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</td></tr>
<tr class="separator:ab042613c0c2ec32c60dbc9b0c5f03b75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad2542bd9cbedf6534bc2443fea26657" id="r_aad2542bd9cbedf6534bc2443fea26657"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aad2542bd9cbedf6534bc2443fea26657">u_open</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps, struct pi_sockaddr *addr, size_t addrlen)</td></tr>
<tr class="separator:aad2542bd9cbedf6534bc2443fea26657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20220d60460da3af89e8e25bec84a595" id="r_a20220d60460da3af89e8e25bec84a595"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a20220d60460da3af89e8e25bec84a595">u_poll</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps, int timeout)</td></tr>
<tr class="separator:a20220d60460da3af89e8e25bec84a595"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c4b6061f971ce2de3b2f581a87f3751" id="r_a8c4b6061f971ce2de3b2f581a87f3751"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c4b6061f971ce2de3b2f581a87f3751">u_read</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps, pi_buffer_t *<a class="el" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, size_t len, int <a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</td></tr>
<tr class="separator:a8c4b6061f971ce2de3b2f581a87f3751"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a392c406126a2b42d4c9279a1664111ef" id="r_a392c406126a2b42d4c9279a1664111ef"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a392c406126a2b42d4c9279a1664111ef">u_wait_for_device</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps, int *timeout)</td></tr>
<tr class="separator:a392c406126a2b42d4c9279a1664111ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62be9dca709b9fa802954d73d21ab332" id="r_a62be9dca709b9fa802954d73d21ab332"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a62be9dca709b9fa802954d73d21ab332">u_write</a> (struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *ps, const unsigned char *<a class="el" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, size_t len, int <a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</td></tr>
<tr class="separator:a62be9dca709b9fa802954d73d21ab332"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae063014a517d3d5d8b74a3b7348349f3" id="r_ae063014a517d3d5d8b74a3b7348349f3"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae063014a517d3d5d8b74a3b7348349f3">usb_thread_run</a> (void *foo)</td></tr>
<tr class="separator:ae063014a517d3d5d8b74a3b7348349f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8bdf361a62cb4e7c490fc6023606a290" id="r_a8bdf361a62cb4e7c490fc6023606a290"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8bdf361a62cb4e7c490fc6023606a290">accept_multiple_simultaneous_connections</a> = 0</td></tr>
<tr class="separator:a8bdf361a62cb4e7c490fc6023606a290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce0dbf009bbc997676eb85f78dfac7d" id="r_a2ce0dbf009bbc997676eb85f78dfac7d"><td class="memItemLeft" >struct {&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cbb17ede73ea044a04a129bf4d86976" id="r_a1cbb17ede73ea044a04a129bf4d86976"><td class="memItemLeft" >&#160;&#160;&#160;unsigned short&#160;&#160;&#160;<a class="el" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a1cbb17ede73ea044a04a129bf4d86976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43b0eb165838e76a61358dc70072e62b" id="r_a43b0eb165838e76a61358dc70072e62b"><td class="memItemLeft" >&#160;&#160;&#160;unsigned short&#160;&#160;&#160;<a class="el" href="#a43b0eb165838e76a61358dc70072e62b">productID</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a43b0eb165838e76a61358dc70072e62b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafae79b6a22926854b79c987d784db2d" id="r_aafae79b6a22926854b79c987d784db2d"><td class="memItemLeft" >&#160;&#160;&#160;unsigned short&#160;&#160;&#160;<a class="el" href="#aafae79b6a22926854b79c987d784db2d">vendorID</a>&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:aafae79b6a22926854b79c987d784db2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce0dbf009bbc997676eb85f78dfac7d" id="r_a2ce0dbf009bbc997676eb85f78dfac7d"><td class="memItemLeft" valign="top">}&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a> []&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a2ce0dbf009bbc997676eb85f78dfac7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8236dfde083ec56b0a613afbecf88237" id="r_a8236dfde083ec56b0a613afbecf88237"><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8236dfde083ec56b0a613afbecf88237">usb_connection_added_cond</a> = PTHREAD_COND_INITIALIZER</td></tr>
<tr class="separator:a8236dfde083ec56b0a613afbecf88237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bb24b1602e506248a782023abbef0b5" id="r_a8bb24b1602e506248a782023abbef0b5"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structusb__connection__t.html">usb_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a> = NULL</td></tr>
<tr class="separator:a8bb24b1602e506248a782023abbef0b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46fbd25dde6a77fa97ee6d01ce7dcf39" id="r_a46fbd25dde6a77fa97ee6d01ce7dcf39"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a> = PTHREAD_MUTEX_INITIALIZER</td></tr>
<tr class="separator:a46fbd25dde6a77fa97ee6d01ce7dcf39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9b66f16119c60eefb658bfc4ac4b617" id="r_af9b66f16119c60eefb658bfc4ac4b617"><td class="memItemLeft" align="right" valign="top">static io_iterator_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a></td></tr>
<tr class="separator:af9b66f16119c60eefb658bfc4ac4b617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bd3b03e77dab6f4cb1e1dba056ece1f" id="r_a1bd3b03e77dab6f4cb1e1dba056ece1f"><td class="memItemLeft" align="right" valign="top">static IONotificationPortRef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a></td></tr>
<tr class="separator:a1bd3b03e77dab6f4cb1e1dba056ece1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8f71bd48f1b7d294f04994511f77eeb" id="r_aa8f71bd48f1b7d294f04994511f77eeb"><td class="memItemLeft" align="right" valign="top">static CFRunLoopRef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a> = 0</td></tr>
<tr class="separator:aa8f71bd48f1b7d294f04994511f77eeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8360facefc49be38517fde7b07169f82" id="r_a8360facefc49be38517fde7b07169f82"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a> = PTHREAD_MUTEX_INITIALIZER</td></tr>
<tr class="separator:a8360facefc49be38517fde7b07169f82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4622ae4614d20e142779408a7f8c7825" id="r_a4622ae4614d20e142779408a7f8c7825"><td class="memItemLeft" align="right" valign="top">static pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a> = 0</td></tr>
<tr class="separator:a4622ae4614d20e142779408a7f8c7825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba17cac29b694d3e604d4b608228c8c1" id="r_aba17cac29b694d3e604d4b608228c8c1"><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aba17cac29b694d3e604d4b608228c8c1">usb_thread_ready_cond</a> = PTHREAD_COND_INITIALIZER</td></tr>
<tr class="separator:aba17cac29b694d3e604d4b608228c8c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f2c71376203c7c3c34d2adc0d1c8acd" id="r_a4f2c71376203c7c3c34d2adc0d1c8acd"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a> = PTHREAD_MUTEX_INITIALIZER</td></tr>
<tr class="separator:a4f2c71376203c7c3c34d2adc0d1c8acd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae99d6e8e31cdbd8fc416acd8f0c6df2f" name="ae99d6e8e31cdbd8fc416acd8f0c6df2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae99d6e8e31cdbd8fc416acd8f0c6df2f">&#9670;&#160;</a></span>AUTO_READ_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTO_READ_SIZE&#160;&#160;&#160;64</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>

</div>
</div>
<a id="aa00463c247d30a7f25d2e64d56155280" name="aa00463c247d30a7f25d2e64d56155280"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa00463c247d30a7f25d2e64d56155280">&#9670;&#160;</a></span>FLAG_ANSWERS_CONN_INFO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_ANSWERS_CONN_INFO&#160;&#160;&#160;0x0001		/* device is known to answer connection information requests */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>

</div>
</div>
<a id="ae88563097067473f1b784230241b738f" name="ae88563097067473f1b784230241b738f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae88563097067473f1b784230241b738f">&#9670;&#160;</a></span>FLAG_ANSWERS_PALM_CONN_INFO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_ANSWERS_PALM_CONN_INFO&#160;&#160;&#160;0x0008		/* means that if the device doesn't answer PALM_EXT_CONNECTION_INFORMATION, don't try the visor variant (for stupid PalmOne handhelds) */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>

</div>
</div>
<a id="afe9328ad413332e48effd71b542abdc2" name="afe9328ad413332e48effd71b542abdc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe9328ad413332e48effd71b542abdc2">&#9670;&#160;</a></span>FLAG_REJECT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_REJECT&#160;&#160;&#160;0x8000		/* device is known but not supported yet */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01551">accepts_device()</a>.</p>

</div>
</div>
<a id="aa9b65d1aae65a8421de1524846821b5c" name="aa9b65d1aae65a8421de1524846821b5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9b65d1aae65a8421de1524846821b5c">&#9670;&#160;</a></span>FLAG_USE_FIRST_PAIR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_USE_FIRST_PAIR&#160;&#160;&#160;0x0002		/* thanks to dumb programmers at Palm, the connection information doesn't match the actual pipes being used. If this flag is set, always try to use the first endoints <a class="el" href="address_8c.html#a4a228f49a30f09ef05548b421868a382">pair</a> */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, and <a class="el" href="#l00992">find_interfaces()</a>.</p>

</div>
</div>
<a id="af6fbaed2c346cfabbf727d5b266cfbcb" name="af6fbaed2c346cfabbf727d5b266cfbcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6fbaed2c346cfabbf727d5b266cfbcb">&#9670;&#160;</a></span>FLAG_USE_SECOND_PAIR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FLAG_USE_SECOND_PAIR&#160;&#160;&#160;0x0004		/* ditto */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>

</div>
</div>
<a id="a23da418422fe26791d70a481bce256d0" name="a23da418422fe26791d70a481bce256d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23da418422fe26791d70a481bce256d0">&#9670;&#160;</a></span>GENERIC_CLOSE_NOTIFICATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GENERIC_CLOSE_NOTIFICATION&#160;&#160;&#160;0x02</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a999d97afe6c8af0e9f6e6592e5dddf2f" name="a999d97afe6c8af0e9f6e6592e5dddf2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a999d97afe6c8af0e9f6e6592e5dddf2f">&#9670;&#160;</a></span>GENERIC_REQUEST_BYTES_AVAILABLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GENERIC_REQUEST_BYTES_AVAILABLE&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, and <a class="el" href="#l00923">USB_configure_device()</a>.</p>

</div>
</div>
<a id="a3d20564f344120c5e19bc3592fbab4a3" name="a3d20564f344120c5e19bc3592fbab4a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d20564f344120c5e19bc3592fbab4a3">&#9670;&#160;</a></span>KLSI_GET_COMM_DESCRIPTOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_GET_COMM_DESCRIPTOR&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa5130f6ca9bba7d1661f53742630b226" name="aa5130f6ca9bba7d1661f53742630b226"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5130f6ca9bba7d1661f53742630b226">&#9670;&#160;</a></span>KLSI_GET_FLOWCONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_GET_FLOWCONTROL&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae5ae397bfab61cd0c527102e53c383ca" name="ae5ae397bfab61cd0c527102e53c383ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5ae397bfab61cd0c527102e53c383ca">&#9670;&#160;</a></span>KLSI_GET_HANDSHAKE_LINES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_GET_HANDSHAKE_LINES&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a35995b1ba5040d5eca3ae5dd04224e32" name="a35995b1ba5040d5eca3ae5dd04224e32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35995b1ba5040d5eca3ae5dd04224e32">&#9670;&#160;</a></span>KLSI_SET_COMM_DESCRIPTOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_SET_COMM_DESCRIPTOR&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01342">klsi_set_portspeed()</a>.</p>

</div>
</div>
<a id="aa26baa08ed15a296e2778f7a543970ca" name="aa26baa08ed15a296e2778f7a543970ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa26baa08ed15a296e2778f7a543970ca">&#9670;&#160;</a></span>KLSI_SET_FLOWCONTROL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_SET_FLOWCONTROL&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01342">klsi_set_portspeed()</a>.</p>

</div>
</div>
<a id="ab8c8d9b723564b59e131f14ca660a6ef" name="ab8c8d9b723564b59e131f14ca660a6ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8c8d9b723564b59e131f14ca660a6ef">&#9670;&#160;</a></span>KLSI_SET_HANDSHAKE_LINES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KLSI_SET_HANDSHAKE_LINES&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01342">klsi_set_portspeed()</a>.</p>

</div>
</div>
<a id="af0de01b4bd1f5311a37a36b33f27e39a" name="af0de01b4bd1f5311a37a36b33f27e39a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0de01b4bd1f5311a37a36b33f27e39a">&#9670;&#160;</a></span>MAX_AUTO_READ_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_AUTO_READ_SIZE&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01493">prime_read()</a>.</p>

</div>
</div>
<a id="a22b08ff484c0cfd3cc9536dd3aee44db" name="a22b08ff484c0cfd3cc9536dd3aee44db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22b08ff484c0cfd3cc9536dd3aee44db">&#9670;&#160;</a></span>PALM_GET_EXT_CONNECTION_INFORMATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PALM_GET_EXT_CONNECTION_INFORMATION&#160;&#160;&#160;0x04</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01326">read_generic_connection_information()</a>, and <a class="el" href="#l01030">USB_configure_generic()</a>.</p>

</div>
</div>
<a id="a68c5b2c34f6ab445699a6beb3a93bce3" name="a68c5b2c34f6ab445699a6beb3a93bce3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68c5b2c34f6ab445699a6beb3a93bce3">&#9670;&#160;</a></span>PRODUCT_HANDSPRING_VISOR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRODUCT_HANDSPRING_VISOR&#160;&#160;&#160;0x0100</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a601606e0ac4526dd03b88b1b864d046f" name="a601606e0ac4526dd03b88b1b864d046f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a601606e0ac4526dd03b88b1b864d046f">&#9670;&#160;</a></span>PRODUCT_PALMCONNECT_USB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRODUCT_PALMCONNECT_USB&#160;&#160;&#160;0x0080</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l01930">u_changebaud()</a>, <a class="el" href="#l01642">u_wait_for_device()</a>, and <a class="el" href="#l01742">u_write()</a>.</p>

</div>
</div>
<a id="a6bbfd6236e2726b2c5922ba25d1711db" name="a6bbfd6236e2726b2c5922ba25d1711db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bbfd6236e2726b2c5922ba25d1711db">&#9670;&#160;</a></span>PRODUCT_SONY_CLIE_3_5</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRODUCT_SONY_CLIE_3_5&#160;&#160;&#160;0x0038</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aadb790394ac125bbdc67225d17df07a2" name="aadb790394ac125bbdc67225d17df07a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb790394ac125bbdc67225d17df07a2">&#9670;&#160;</a></span>ULOG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ULOG</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>a</em></span></td><td>)</td>
          <td>&#160;&#160;&#160;do {} while(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>, <a class="el" href="#l01378">device_notification()</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l01621">u_close()</a>, <a class="el" href="#l01695">u_poll()</a>, <a class="el" href="#l01642">u_wait_for_device()</a>, and <a class="el" href="#l01742">u_write()</a>.</p>

</div>
</div>
<a id="ac8b6376cd0b053b74c7f17b35882c5d0" name="ac8b6376cd0b053b74c7f17b35882c5d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8b6376cd0b053b74c7f17b35882c5d0">&#9670;&#160;</a></span>VENDOR_HANDSPRING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VENDOR_HANDSPRING&#160;&#160;&#160;0x082d</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a59879199c074f11c8d710ab0b618a4fb" name="a59879199c074f11c8d710ab0b618a4fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59879199c074f11c8d710ab0b618a4fb">&#9670;&#160;</a></span>VENDOR_KEYSPAN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VENDOR_KEYSPAN&#160;&#160;&#160;0x06cd</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0ae1af091a8c549c6dd222f1348dc4bd" name="a0ae1af091a8c549c6dd222f1348dc4bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ae1af091a8c549c6dd222f1348dc4bd">&#9670;&#160;</a></span>VENDOR_PALMONE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VENDOR_PALMONE&#160;&#160;&#160;0x0830</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l01930">u_changebaud()</a>, <a class="el" href="#l01642">u_wait_for_device()</a>, and <a class="el" href="#l01742">u_write()</a>.</p>

</div>
</div>
<a id="a4a8d346d23be20f1fbfc78e229b6e41b" name="a4a8d346d23be20f1fbfc78e229b6e41b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a8d346d23be20f1fbfc78e229b6e41b">&#9670;&#160;</a></span>VENDOR_SONY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VENDOR_SONY&#160;&#160;&#160;0x054c</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a46b9a2d21d3e6f62d8d96dcadd65e9d3" name="a46b9a2d21d3e6f62d8d96dcadd65e9d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46b9a2d21d3e6f62d8d96dcadd65e9d3">&#9670;&#160;</a></span>VENDOR_TAPWAVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VENDOR_TAPWAVE&#160;&#160;&#160;0x12ef</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>

</div>
</div>
<a id="a62017a0f13ecb6550aa118043a39bf56" name="a62017a0f13ecb6550aa118043a39bf56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62017a0f13ecb6550aa118043a39bf56">&#9670;&#160;</a></span>VISOR_ENDPOINT_1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_ENDPOINT_1&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab412e3df0ca860455a9c66478663b4cc" name="ab412e3df0ca860455a9c66478663b4cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab412e3df0ca860455a9c66478663b4cc">&#9670;&#160;</a></span>VISOR_ENDPOINT_2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_ENDPOINT_2&#160;&#160;&#160;0x02</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4b54f2a9722be80f664e5ec9433a64ae" name="a4b54f2a9722be80f664e5ec9433a64ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b54f2a9722be80f664e5ec9433a64ae">&#9670;&#160;</a></span>VISOR_FUNCTION_CONSOLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_FUNCTION_CONSOLE&#160;&#160;&#160;0x03</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<a id="adde5c16f3a4a6496d40f0ec545da7056" name="adde5c16f3a4a6496d40f0ec545da7056"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adde5c16f3a4a6496d40f0ec545da7056">&#9670;&#160;</a></span>VISOR_FUNCTION_DEBUGGER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_FUNCTION_DEBUGGER&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<a id="a0987f64d971059f38d9c02f205de0605" name="a0987f64d971059f38d9c02f205de0605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0987f64d971059f38d9c02f205de0605">&#9670;&#160;</a></span>VISOR_FUNCTION_GENERIC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_FUNCTION_GENERIC&#160;&#160;&#160;0x00</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<a id="ad438829a5b519c892325847ed3d7daa4" name="ad438829a5b519c892325847ed3d7daa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad438829a5b519c892325847ed3d7daa4">&#9670;&#160;</a></span>VISOR_FUNCTION_HOTSYNC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_FUNCTION_HOTSYNC&#160;&#160;&#160;0x02</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<a id="a727e8ebd40a8aab9603d264c3ddaf193" name="a727e8ebd40a8aab9603d264c3ddaf193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a727e8ebd40a8aab9603d264c3ddaf193">&#9670;&#160;</a></span>VISOR_FUNCTION_REMOTE_FILE_SYS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_FUNCTION_REMOTE_FILE_SYS&#160;&#160;&#160;0x04</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<a id="ad3b8ec3afa8751af3cb8d549ab49cdec" name="ad3b8ec3afa8751af3cb8d549ab49cdec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3b8ec3afa8751af3cb8d549ab49cdec">&#9670;&#160;</a></span>VISOR_GET_CONNECTION_INFORMATION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VISOR_GET_CONNECTION_INFORMATION&#160;&#160;&#160;0x03</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01224">read_visor_connection_information()</a>, and <a class="el" href="#l00982">USB_configure_visor()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a505f6c5afa59c9aeaa6453fa5f222951" name="a505f6c5afa59c9aeaa6453fa5f222951"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a505f6c5afa59c9aeaa6453fa5f222951">&#9670;&#160;</a></span>usb_connection_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct usb_connection_t usb_connection_t</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="abc6126af1d45847bc59afa0aa3216b04" name="abc6126af1d45847bc59afa0aa3216b04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc6126af1d45847bc59afa0aa3216b04">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891" name="abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891"></a>KLSI_BAUD_115200&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440" name="abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440"></a>KLSI_BAUD_57600&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8" name="abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8"></a>KLSI_BAUD_38400&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb" name="abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb"></a>KLSI_BAUD_28800&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc" name="abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc"></a>KLSI_BAUD_19200&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b" name="abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b"></a>KLSI_BAUD_14400&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee" name="abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee"></a>KLSI_BAUD_9600&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1" name="abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1"></a>KLSI_BAUD_7200&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f" name="abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f"></a>KLSI_BAUD_4800&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1" name="abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1"></a>KLSI_BAUD_2400&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a" name="abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a"></a>KLSI_BAUD_1200&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a" name="abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a"></a>KLSI_BAUD_600&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a" name="abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a"></a>KLSI_BAUD_230400&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca" name="abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca"></a>KLSI_PARITY_NONE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a" name="abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a"></a>KLSI_PARITY_ODD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad" name="abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad"></a>KLSI_PARITY_EVEN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe" name="abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe"></a>KLSI_PARITY_MARK&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00" name="abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00"></a>KLSI_STOPBITS_0&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383" name="abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383"></a>KLSI_STOPBITS_2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c" name="abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c"></a>KLSI_GETHS_DCD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1" name="abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1"></a>KLSI_GETHS_RI&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33" name="abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33"></a>KLSI_GETHS_DSR&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574" name="abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574"></a>KLSI_GETHS_CTS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2" name="abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2"></a>KLSI_SETHS_RTS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34" name="abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34"></a>KLSI_SETHS_DTR&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4" name="abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4"></a>KLSI_FLOW_USE_RTS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c" name="abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c"></a>KLSI_FLOW_USE_DSR&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523" name="abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523"></a>KLSI_FLOW_USE_XON&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">  230</span>     {</div>
<div class="line"><span class="lineno">  231</span>    <span class="comment">/* Values for KLSI_GET/SET_COMM_DESCRIPTOR */</span></div>
<div class="line"><span class="lineno">  232</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891">KLSI_BAUD_115200</a> = 0,</div>
<div class="line"><span class="lineno">  233</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440">KLSI_BAUD_57600</a>  = 1,</div>
<div class="line"><span class="lineno">  234</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8">KLSI_BAUD_38400</a>  = 2,</div>
<div class="line"><span class="lineno">  235</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb">KLSI_BAUD_28800</a>  = 3,</div>
<div class="line"><span class="lineno">  236</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc">KLSI_BAUD_19200</a>  = 4,</div>
<div class="line"><span class="lineno">  237</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b">KLSI_BAUD_14400</a>  = 5,</div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee">KLSI_BAUD_9600</a>   = 6,</div>
<div class="line"><span class="lineno">  239</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1">KLSI_BAUD_7200</a>   = 7,</div>
<div class="line"><span class="lineno">  240</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f">KLSI_BAUD_4800</a>   = 8,</div>
<div class="line"><span class="lineno">  241</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1">KLSI_BAUD_2400</a>   = 9,</div>
<div class="line"><span class="lineno">  242</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a">KLSI_BAUD_1200</a>   = 10,</div>
<div class="line"><span class="lineno">  243</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a">KLSI_BAUD_600</a>    = 11,</div>
<div class="line"><span class="lineno">  244</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a">KLSI_BAUD_230400</a> = 12,</div>
<div class="line"><span class="lineno">  245</span>    </div>
<div class="line"><span class="lineno">  246</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca">KLSI_PARITY_NONE</a> = 0,</div>
<div class="line"><span class="lineno">  247</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a">KLSI_PARITY_ODD</a>  = 1,</div>
<div class="line"><span class="lineno">  248</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad">KLSI_PARITY_EVEN</a> = 2,</div>
<div class="line"><span class="lineno">  249</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe">KLSI_PARITY_MARK</a> = 3,</div>
<div class="line"><span class="lineno">  250</span>    </div>
<div class="line"><span class="lineno">  251</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00">KLSI_STOPBITS_0</a> = 0,</div>
<div class="line"><span class="lineno">  252</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383">KLSI_STOPBITS_2</a> = 2,</div>
<div class="line"><span class="lineno">  253</span>    </div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">/* Handshake values for KLSI_GET_HANDSHAKE_LINES */</span></div>
<div class="line"><span class="lineno">  255</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c">KLSI_GETHS_DCD</a> = 0x80,      <span class="comment">/* Data Carrier Detect */</span></div>
<div class="line"><span class="lineno">  256</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1">KLSI_GETHS_RI</a>  = 0x40,      <span class="comment">/* Ring Indicator */</span></div>
<div class="line"><span class="lineno">  257</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33">KLSI_GETHS_DSR</a> = 0x20,      <span class="comment">/* Data Set Ready */</span></div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574">KLSI_GETHS_CTS</a> = 0x10,      <span class="comment">/* Clear To Send */</span></div>
<div class="line"><span class="lineno">  259</span>    </div>
<div class="line"><span class="lineno">  260</span>    <span class="comment">/* Handshake values for KLST_SET_HANDSHAKE_LINES */</span></div>
<div class="line"><span class="lineno">  261</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2">KLSI_SETHS_RTS</a> = 0x02,      <span class="comment">/* Ready To Send */</span></div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34">KLSI_SETHS_DTR</a> = 0x01,      <span class="comment">/* Data Terminal Ready */</span></div>
<div class="line"><span class="lineno">  263</span>    </div>
<div class="line"><span class="lineno">  264</span>    <span class="comment">/* Flow control values */</span></div>
<div class="line"><span class="lineno">  265</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4">KLSI_FLOW_USE_RTS</a> = 0x01,   <span class="comment">/* use RTS/CTS */</span></div>
<div class="line"><span class="lineno">  266</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c">KLSI_FLOW_USE_DSR</a> = 0x02,   <span class="comment">/* use DSR/CD */</span></div>
<div class="line"><span class="lineno">  267</span>    <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523">KLSI_FLOW_USE_XON</a> = 0x04    <span class="comment">/* use XON/XOFF */</span></div>
<div class="line"><span class="lineno">  268</span>};</div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891">KLSI_BAUD_115200</a></div><div class="ttdeci">@ KLSI_BAUD_115200</div><div class="ttdef"><b>Definition</b> darwinusb.c:232</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1">KLSI_BAUD_2400</a></div><div class="ttdeci">@ KLSI_BAUD_2400</div><div class="ttdef"><b>Definition</b> darwinusb.c:241</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440">KLSI_BAUD_57600</a></div><div class="ttdeci">@ KLSI_BAUD_57600</div><div class="ttdef"><b>Definition</b> darwinusb.c:233</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8">KLSI_BAUD_38400</a></div><div class="ttdeci">@ KLSI_BAUD_38400</div><div class="ttdef"><b>Definition</b> darwinusb.c:234</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a1cf83f14210ae1673668ad68ef620574">KLSI_GETHS_CTS</a></div><div class="ttdeci">@ KLSI_GETHS_CTS</div><div class="ttdef"><b>Definition</b> darwinusb.c:258</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a1dc700fb85871da98b930bb2c3d27f33">KLSI_GETHS_DSR</a></div><div class="ttdeci">@ KLSI_GETHS_DSR</div><div class="ttdef"><b>Definition</b> darwinusb.c:257</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a">KLSI_BAUD_230400</a></div><div class="ttdeci">@ KLSI_BAUD_230400</div><div class="ttdef"><b>Definition</b> darwinusb.c:244</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a21cb0e9061be91aad6d99ba533287eb1">KLSI_GETHS_RI</a></div><div class="ttdeci">@ KLSI_GETHS_RI</div><div class="ttdef"><b>Definition</b> darwinusb.c:256</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2">KLSI_SETHS_RTS</a></div><div class="ttdeci">@ KLSI_SETHS_RTS</div><div class="ttdef"><b>Definition</b> darwinusb.c:261</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b">KLSI_BAUD_14400</a></div><div class="ttdeci">@ KLSI_BAUD_14400</div><div class="ttdef"><b>Definition</b> darwinusb.c:237</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f">KLSI_BAUD_4800</a></div><div class="ttdeci">@ KLSI_BAUD_4800</div><div class="ttdef"><b>Definition</b> darwinusb.c:240</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4">KLSI_FLOW_USE_RTS</a></div><div class="ttdeci">@ KLSI_FLOW_USE_RTS</div><div class="ttdef"><b>Definition</b> darwinusb.c:265</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb">KLSI_BAUD_28800</a></div><div class="ttdeci">@ KLSI_BAUD_28800</div><div class="ttdef"><b>Definition</b> darwinusb.c:235</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a">KLSI_BAUD_600</a></div><div class="ttdeci">@ KLSI_BAUD_600</div><div class="ttdef"><b>Definition</b> darwinusb.c:243</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1">KLSI_BAUD_7200</a></div><div class="ttdeci">@ KLSI_BAUD_7200</div><div class="ttdef"><b>Definition</b> darwinusb.c:239</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc">KLSI_BAUD_19200</a></div><div class="ttdeci">@ KLSI_BAUD_19200</div><div class="ttdef"><b>Definition</b> darwinusb.c:236</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a46bd92143950284b5022b4ef5621d16a">KLSI_PARITY_ODD</a></div><div class="ttdeci">@ KLSI_PARITY_ODD</div><div class="ttdef"><b>Definition</b> darwinusb.c:247</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee">KLSI_BAUD_9600</a></div><div class="ttdeci">@ KLSI_BAUD_9600</div><div class="ttdef"><b>Definition</b> darwinusb.c:238</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a55a39fdae2cb760397da5924778cc1fe">KLSI_PARITY_MARK</a></div><div class="ttdeci">@ KLSI_PARITY_MARK</div><div class="ttdef"><b>Definition</b> darwinusb.c:249</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34">KLSI_SETHS_DTR</a></div><div class="ttdeci">@ KLSI_SETHS_DTR</div><div class="ttdef"><b>Definition</b> darwinusb.c:262</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca">KLSI_PARITY_NONE</a></div><div class="ttdeci">@ KLSI_PARITY_NONE</div><div class="ttdef"><b>Definition</b> darwinusb.c:246</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04a95969db142e4bf9edbf254426b28037c">KLSI_FLOW_USE_DSR</a></div><div class="ttdeci">@ KLSI_FLOW_USE_DSR</div><div class="ttdef"><b>Definition</b> darwinusb.c:266</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04aa0695c081009e57c174450c693e3223c">KLSI_GETHS_DCD</a></div><div class="ttdeci">@ KLSI_GETHS_DCD</div><div class="ttdef"><b>Definition</b> darwinusb.c:255</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04aa84204618666d8dd2148dc5aafd9ebad">KLSI_PARITY_EVEN</a></div><div class="ttdeci">@ KLSI_PARITY_EVEN</div><div class="ttdef"><b>Definition</b> darwinusb.c:248</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04ab803c4618d25e81026b75823798f3523">KLSI_FLOW_USE_XON</a></div><div class="ttdeci">@ KLSI_FLOW_USE_XON</div><div class="ttdef"><b>Definition</b> darwinusb.c:267</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00">KLSI_STOPBITS_0</a></div><div class="ttdeci">@ KLSI_STOPBITS_0</div><div class="ttdef"><b>Definition</b> darwinusb.c:251</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04add948156299e1a2b595d4ff117194383">KLSI_STOPBITS_2</a></div><div class="ttdeci">@ KLSI_STOPBITS_2</div><div class="ttdef"><b>Definition</b> darwinusb.c:252</div></div>
<div class="ttc" id="adarwinusb_8c_html_abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a"><div class="ttname"><a href="#abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a">KLSI_BAUD_1200</a></div><div class="ttdeci">@ KLSI_BAUD_1200</div><div class="ttdef"><b>Definition</b> darwinusb.c:242</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab10d2c139ee0772df628b5e705368986" name="ab10d2c139ee0772df628b5e705368986"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab10d2c139ee0772df628b5e705368986">&#9670;&#160;</a></span>accepts_device()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int accepts_device </td>
          <td>(</td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>vendor</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>product</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short *</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1552</span>{</div>
<div class="line"><span class="lineno"> 1553</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 1554</span>    <span class="keywordflow">for</span> (i=0; i &lt; (int)(<span class="keyword">sizeof</span>(<a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>) / <span class="keyword">sizeof</span>(<a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[0])); i++)</div>
<div class="line"><span class="lineno"> 1555</span>    {</div>
<div class="line"><span class="lineno"> 1556</span>        <span class="keywordflow">if</span> (vendor == <a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[i].<a class="code hl_variable" href="#aafae79b6a22926854b79c987d784db2d">vendorID</a>)</div>
<div class="line"><span class="lineno"> 1557</span>        {</div>
<div class="line"><span class="lineno"> 1558</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[i].<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; <a class="code hl_define" href="#afe9328ad413332e48effd71b542abdc2">FLAG_REJECT</a>)</div>
<div class="line"><span class="lineno"> 1559</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1560</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[i].<a class="code hl_variable" href="#a43b0eb165838e76a61358dc70072e62b">productID</a> == 0xffff || product == <a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[i].<a class="code hl_variable" href="#a43b0eb165838e76a61358dc70072e62b">productID</a>)</div>
<div class="line"><span class="lineno"> 1561</span>            {</div>
<div class="line"><span class="lineno"> 1562</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>)</div>
<div class="line"><span class="lineno"> 1563</span>                    *<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> = <a class="code hl_variable" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>[i].flags;</div>
<div class="line"><span class="lineno"> 1564</span>                <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1565</span>            }</div>
<div class="line"><span class="lineno"> 1566</span>        }</div>
<div class="line"><span class="lineno"> 1567</span>    }</div>
<div class="line"><span class="lineno"> 1568</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1569</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a1cbb17ede73ea044a04a129bf4d86976"><div class="ttname"><a href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a></div><div class="ttdeci">unsigned short flags</div><div class="ttdef"><b>Definition</b> darwinusb.c:311</div></div>
<div class="ttc" id="adarwinusb_8c_html_a2ce0dbf009bbc997676eb85f78dfac7d"><div class="ttname"><a href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a></div><div class="ttdeci">static struct @4 acceptedDevices[]</div></div>
<div class="ttc" id="adarwinusb_8c_html_a43b0eb165838e76a61358dc70072e62b"><div class="ttname"><a href="#a43b0eb165838e76a61358dc70072e62b">productID</a></div><div class="ttdeci">unsigned short productID</div><div class="ttdef"><b>Definition</b> darwinusb.c:310</div></div>
<div class="ttc" id="adarwinusb_8c_html_aafae79b6a22926854b79c987d784db2d"><div class="ttname"><a href="#aafae79b6a22926854b79c987d784db2d">vendorID</a></div><div class="ttdeci">unsigned short vendorID</div><div class="ttdef"><b>Definition</b> darwinusb.c:309</div></div>
<div class="ttc" id="adarwinusb_8c_html_afe9328ad413332e48effd71b542abdc2"><div class="ttname"><a href="#afe9328ad413332e48effd71b542abdc2">FLAG_REJECT</a></div><div class="ttdeci">#define FLAG_REJECT</div><div class="ttdef"><b>Definition</b> darwinusb.c:306</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#a2ce0dbf009bbc997676eb85f78dfac7d">acceptedDevices</a>, <a class="el" href="#l00306">FLAG_REJECT</a>, <a class="el" href="#l00311">flags</a>, <a class="el" href="#l00310">productID</a>, and <a class="el" href="#l00309">vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ab10d2c139ee0772df628b5e705368986_icgraph.png" border="0" usemap="#adarwinusb_8c_ab10d2c139ee0772df628b5e705368986_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ab10d2c139ee0772df628b5e705368986_icgraph" id="adarwinusb_8c_ab10d2c139ee0772df628b5e705368986_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,1974,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="ab97608baf2dc20e00693ea3d28b1c5fe" name="ab97608baf2dc20e00693ea3d28b1c5fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab97608baf2dc20e00693ea3d28b1c5fe">&#9670;&#160;</a></span>add_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>c</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  418</span>{</div>
<div class="line"><span class="lineno">  419</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: adding connection %p to linked list\n&quot;</span>, c));</div>
<div class="line"><span class="lineno">  420</span>    pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  421</span>    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a> = <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a>;</div>
<div class="line"><span class="lineno">  422</span>    <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a> = c;</div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">//pthread_cond_signal(&amp;usb_connection_added_cond);</span></div>
<div class="line"><span class="lineno">  424</span>    pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  425</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a46fbd25dde6a77fa97ee6d01ce7dcf39"><div class="ttname"><a href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a></div><div class="ttdeci">static pthread_mutex_t usb_connections_mutex</div><div class="ttdef"><b>Definition</b> darwinusb.c:131</div></div>
<div class="ttc" id="adarwinusb_8c_html_a8bb24b1602e506248a782023abbef0b5"><div class="ttname"><a href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a></div><div class="ttdeci">static usb_connection_t * usb_connections</div><div class="ttdef"><b>Definition</b> darwinusb.c:178</div></div>
<div class="ttc" id="astructusb__connection__t_html_a9fb446ce2250b205634d4826efa0d9ab"><div class="ttname"><a href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">usb_connection_t::next</a></div><div class="ttdeci">struct usb_connection_t * next</div><div class="ttdef"><b>Definition</b> darwinusb.c:138</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00138">usb_connection_t::next</a>, <a class="el" href="#l00178">usb_connections</a>, and <a class="el" href="#l00131">usb_connections_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ab97608baf2dc20e00693ea3d28b1c5fe_icgraph.png" border="0" usemap="#adarwinusb_8c_ab97608baf2dc20e00693ea3d28b1c5fe_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ab97608baf2dc20e00693ea3d28b1c5fe_icgraph" id="adarwinusb_8c_ab97608baf2dc20e00693ea3d28b1c5fe_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,1974,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a6b11be685f613bf98fd2492cd26c7ce6" name="a6b11be685f613bf98fd2492cd26c7ce6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b11be685f613bf98fd2492cd26c7ce6">&#9670;&#160;</a></span>change_refcount()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int change_refcount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>increment</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  493</span>{</div>
<div class="line"><span class="lineno">  494</span>    <span class="comment">/* update the refcount on the connection structure. If the refcount becomes</span></div>
<div class="line"><span class="lineno">  495</span><span class="comment">     * zero, call the stop_listening() function</span></div>
<div class="line"><span class="lineno">  496</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  497</span>    <span class="keywordtype">int</span> rc;</div>
<div class="line"><span class="lineno">  498</span>    <span class="keywordflow">if</span> (c == NULL)</div>
<div class="line"><span class="lineno">  499</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  500</span>    <span class="keywordflow">if</span> (pthread_mutex_lock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>) != 0)</div>
<div class="line"><span class="lineno">  501</span>    {</div>
<div class="line"><span class="lineno">  502</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: connection %p, can&#39;t lock ref_count_mutex (ref_count=%d)\n&quot;</span>,c,c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>));</div>
<div class="line"><span class="lineno">  503</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  504</span>    }</div>
<div class="line"><span class="lineno">  505</span>    rc = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a> = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a> + increment;</div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordflow">if</span> (rc &lt; 0)</div>
<div class="line"><span class="lineno">  507</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: connection %p&#39;s refcount became &lt; 0 (%d)\n&quot;</span>, c, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a>));</div>
<div class="line"><span class="lineno">  508</span>    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line"><span class="lineno">  509</span>    {</div>
<div class="line"><span class="lineno">  510</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a173addd105f622a77d8797cad4a33a68">remove_connection</a>(c))</div>
<div class="line"><span class="lineno">  511</span>            <a class="code hl_function" href="#a7974faab5165fb2b558c2f0f08e921ae">stop_listening</a>(c);</div>
<div class="line"><span class="lineno">  512</span>    }</div>
<div class="line"><span class="lineno">  513</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  514</span>        pthread_mutex_unlock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>);</div>
<div class="line"><span class="lineno">  515</span>    <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  516</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a173addd105f622a77d8797cad4a33a68"><div class="ttname"><a href="#a173addd105f622a77d8797cad4a33a68">remove_connection</a></div><div class="ttdeci">static int remove_connection(usb_connection_t *c)</div><div class="ttdef"><b>Definition</b> darwinusb.c:428</div></div>
<div class="ttc" id="adarwinusb_8c_html_a7974faab5165fb2b558c2f0f08e921ae"><div class="ttname"><a href="#a7974faab5165fb2b558c2f0f08e921ae">stop_listening</a></div><div class="ttdeci">static void stop_listening(usb_connection_t *c)</div><div class="ttdef"><b>Definition</b> darwinusb.c:582</div></div>
<div class="ttc" id="astructusb__connection__t_html_a223a278e0bf3b42ae887efe07bfbeac0"><div class="ttname"><a href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">usb_connection_t::ref_count</a></div><div class="ttdeci">int ref_count</div><div class="ttdef"><b>Definition</b> darwinusb.c:143</div></div>
<div class="ttc" id="astructusb__connection__t_html_aa40d718670d32f65e7b63678b7de41f2"><div class="ttname"><a href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">usb_connection_t::ref_count_mutex</a></div><div class="ttdeci">pthread_mutex_t ref_count_mutex</div><div class="ttdef"><b>Definition</b> darwinusb.c:142</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00143">usb_connection_t::ref_count</a>, <a class="el" href="#l00142">usb_connection_t::ref_count_mutex</a>, <a class="el" href="#l00428">remove_connection()</a>, and <a class="el" href="#l00582">stop_listening()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00467">connection_for_socket()</a>, <a class="el" href="#l01378">device_notification()</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l01621">u_close()</a>, <a class="el" href="#l01578">u_flush()</a>, <a class="el" href="#l01695">u_poll()</a>, <a class="el" href="#l01808">u_read()</a>, and <a class="el" href="#l01742">u_write()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_cgraph.png" border="0" usemap="#adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_cgraph" id="adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,123,56"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="171,5,305,31"/>
<area shape="poly" title=" " alt="" coords="123,32,155,28,156,33,124,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="187,55,288,80"/>
<area shape="poly" title=" " alt="" coords="124,49,172,56,171,61,123,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_icgraph.png" border="0" usemap="#adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_icgraph" id="adarwinusb_8c_a6b11be685f613bf98fd2492cd26c7ce6_icgraph">
<area shape="rect" title=" " alt="" coords="2093,192,2210,217"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="1892,42,2045,68"/>
<area shape="poly" title=" " alt="" coords="2132,180,2095,129,2071,103,2043,81,2023,71,2025,66,2046,77,2074,100,2099,126,2136,176"/>
<area shape="rect" href="darwinusb_8c.html#a20220d60460da3af89e8e25bec84a595" title=" " alt="" coords="1758,40,1814,65"/>
<area shape="poly" title=" " alt="" coords="2140,177,2127,142,2108,101,2080,62,2063,45,2043,32,2015,20,1984,13,1952,12,1920,15,1861,27,1815,43,1814,38,1860,22,1920,9,1952,7,1984,8,2016,15,2046,27,2066,41,2084,58,2112,98,2132,140,2145,175"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="1904,92,2033,117"/>
<area shape="poly" title=" " alt="" coords="2122,184,2086,156,2043,131,2018,120,2020,115,2046,126,2089,152,2125,179"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="1926,141,2011,166"/>
<area shape="poly" title=" " alt="" coords="2087,189,2011,168,2012,163,2088,184"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="1728,190,1844,216"/>
<area shape="poly" title=" " alt="" coords="2077,207,1845,206,1845,201,2077,201"/>
<area shape="rect" href="darwinusb_8c.html#ad04208dd4d06c0f62d2ba47da8269257" title=" " alt="" coords="1433,242,1500,268"/>
<area shape="poly" title=" " alt="" coords="2078,213,1845,231,1500,255,1500,250,1844,226,2077,208"/>
<area shape="rect" href="darwinusb_8c.html#ab042613c0c2ec32c60dbc9b0c5f03b75" title=" " alt="" coords="1292,293,1355,318"/>
<area shape="poly" title=" " alt="" coords="2109,227,2048,252,1969,278,1879,300,1833,306,1788,308,1628,308,1356,308,1356,303,1628,303,1787,303,1833,301,1878,294,1967,273,2046,247,2107,222"/>
<area shape="rect" href="darwinusb_8c.html#a8c4b6061f971ce2de3b2f581a87f3751" title=" " alt="" coords="1599,344,1659,369"/>
<area shape="poly" title=" " alt="" coords="2137,232,2101,282,2075,307,2046,327,1994,348,1940,362,1884,370,1829,374,1731,372,1659,364,1660,359,1731,366,1829,369,1883,365,1939,357,1993,343,2043,322,2072,303,2097,279,2133,229"/>
<area shape="rect" href="darwinusb_8c.html#a62be9dca709b9fa802954d73d21ab332" title=" " alt="" coords="1597,394,1660,420"/>
<area shape="poly" title=" " alt="" coords="2144,233,2130,267,2110,306,2082,344,2046,375,1996,399,1943,415,1888,425,1834,429,1734,425,1661,416,1661,411,1734,420,1833,423,1887,419,1942,410,1994,394,2043,370,2078,340,2105,303,2126,265,2139,231"/>
<area shape="poly" title=" " alt="" coords="1877,56,1814,55,1814,50,1877,51"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1403,97,1530,122"/>
<area shape="poly" title=" " alt="" coords="1887,74,1845,80,1674,98,1530,109,1530,104,1674,93,1844,75,1886,68"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1743,53,1676,53,1591,57,1497,67,1404,87,1345,108,1294,142,1264,168,1238,196,1200,244,1195,240,1234,192,1261,164,1290,138,1343,103,1403,82,1496,62,1591,52,1676,48,1743,48"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="1401,130,1347,149,1293,175,1242,210,1204,244,1200,240,1239,206,1291,170,1345,144,1400,125"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1736,141,1837,166"/>
<area shape="poly" title=" " alt="" coords="1904,124,1837,143,1836,138,1903,119"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1578,166,1680,192"/>
<area shape="poly" title=" " alt="" coords="1721,167,1681,173,1680,168,1720,162"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1411,173,1522,198"/>
<area shape="poly" title=" " alt="" coords="1562,184,1522,186,1522,181,1562,179"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,185,1355,210"/>
<area shape="poly" title=" " alt="" coords="1396,194,1356,198,1356,192,1396,189"/>
<area shape="poly" title=" " alt="" coords="1279,219,1221,244,1219,239,1277,214"/>
<area shape="poly" title=" " alt="" coords="1910,156,1837,156,1837,151,1910,151"/>
<area shape="poly" title=" " alt="" coords="1928,175,1846,198,1844,193,1927,170"/>
<area shape="poly" title=" " alt="" coords="1826,182,1925,155,1926,160,1828,187"/>
<area shape="poly" title=" " alt="" coords="1418,258,1244,258,1244,252,1418,252"/>
<area shape="poly" title=" " alt="" coords="1277,291,1223,271,1224,266,1278,286"/>
<area shape="poly" title=" " alt="" coords="1583,363,1524,366,1450,364,1369,354,1291,334,1263,320,1238,303,1199,270,1203,266,1241,299,1266,316,1293,328,1370,349,1450,359,1524,360,1583,358"/>
<area shape="poly" title=" " alt="" coords="1582,411,1521,409,1447,402,1367,386,1328,373,1291,357,1260,338,1233,314,1196,270,1200,267,1237,310,1263,334,1293,353,1330,368,1369,381,1448,397,1522,404,1582,406"/>
</map>
</div>

</div>
</div>
<a id="a44db8313ee840eece0ab14aa96ca9bf9" name="a44db8313ee840eece0ab14aa96ca9bf9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44db8313ee840eece0ab14aa96ca9bf9">&#9670;&#160;</a></span>configure_device()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn configure_device </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>vendor</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>product</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>port_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>input_pipe_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>output_pipe_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>pipe_info_retrieved</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  886</span>{</div>
<div class="line"><span class="lineno">  887</span>    UInt8 numConf, conf, deviceClass;</div>
<div class="line"><span class="lineno">  888</span>    IOReturn kr;</div>
<div class="line"><span class="lineno">  889</span>    IOUSBConfigurationDescriptorPtr confDesc;</div>
<div class="line"><span class="lineno">  890</span> </div>
<div class="line"><span class="lineno">  891</span>    <span class="comment">/* Get the device class. Most handhelds are registered as composite devices</span></div>
<div class="line"><span class="lineno">  892</span><span class="comment">     * and therefore already opened &amp; configured by OS X drivers! It seems that</span></div>
<div class="line"><span class="lineno">  893</span><span class="comment">     * reconfiguring them as we did before is what caused some Sony devices to</span></div>
<div class="line"><span class="lineno">  894</span><span class="comment">     * refuse talking to us.</span></div>
<div class="line"><span class="lineno">  895</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  896</span>    kr = (*di)-&gt;GetDeviceClass (di, &amp;deviceClass);</div>
<div class="line"><span class="lineno">  897</span>    <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  898</span>        <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno">  899</span> </div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">if</span> (deviceClass != kUSBCompositeClass)</div>
<div class="line"><span class="lineno">  901</span>    {</div>
<div class="line"><span class="lineno">  902</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: Not a composite device: performing confiuration\n&quot;</span>));</div>
<div class="line"><span class="lineno">  903</span> </div>
<div class="line"><span class="lineno">  904</span>        kr = (*di)-&gt;GetNumberOfConfigurations (di, &amp;numConf);</div>
<div class="line"><span class="lineno">  905</span>        <span class="keywordflow">if</span> (!numConf)</div>
<div class="line"><span class="lineno">  906</span>        {</div>
<div class="line"><span class="lineno">  907</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: device has zero configurations!\n&quot;</span>));</div>
<div class="line"><span class="lineno">  908</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  909</span>        }</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span>        <span class="comment">/* try all possible configurations if the first one fails</span></div>
<div class="line"><span class="lineno">  912</span><span class="comment">         * (shouldn&#39;t happen in most cases though)</span></div>
<div class="line"><span class="lineno">  913</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  914</span>        <span class="keywordflow">for</span> (conf=0; conf &lt; numConf; conf++)</div>
<div class="line"><span class="lineno">  915</span>        {</div>
<div class="line"><span class="lineno">  916</span>            kr = (*di)-&gt;GetConfigurationDescriptorPtr(di, 0, &amp;confDesc);</div>
<div class="line"><span class="lineno">  917</span>            <span class="keywordflow">if</span> (kr)</div>
<div class="line"><span class="lineno">  918</span>            {</div>
<div class="line"><span class="lineno">  919</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to get config descriptor for index %d (err=%08x numConf=%d)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  920</span>                    0, kr, (<span class="keywordtype">int</span>)numConf));</div>
<div class="line"><span class="lineno">  921</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  922</span>            }</div>
<div class="line"><span class="lineno">  923</span> </div>
<div class="line"><span class="lineno">  924</span>            kr = (*di)-&gt;SetConfiguration(di, confDesc-&gt;bConfigurationValue);</div>
<div class="line"><span class="lineno">  925</span>            <span class="keywordflow">if</span> (kr == kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  926</span>            {</div>
<div class="line"><span class="lineno">  927</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: successfully set configuration %d\n&quot;</span>,(<span class="keywordtype">int</span>)confDesc-&gt;bConfigurationValue));</div>
<div class="line"><span class="lineno">  928</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  929</span>            }</div>
<div class="line"><span class="lineno">  930</span> </div>
<div class="line"><span class="lineno">  931</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to set configuration to value %d (err=%08x numConf=%d)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  932</span>                (<span class="keywordtype">int</span>)confDesc-&gt;bConfigurationValue, kr, (<span class="keywordtype">int</span>)numConf));</div>
<div class="line"><span class="lineno">  933</span>        }</div>
<div class="line"><span class="lineno">  934</span>        <span class="keywordflow">if</span> (conf == numConf)</div>
<div class="line"><span class="lineno">  935</span>            <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno">  936</span>    }</div>
<div class="line"><span class="lineno">  937</span> </div>
<div class="line"><span class="lineno">  938</span>    <span class="keywordflow">if</span> (vendor == <a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; product == <a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno">  939</span>    {</div>
<div class="line"><span class="lineno">  940</span>        kr = <a class="code hl_function" href="#a75b8e770479707f2ca65619e5e15248b">klsi_set_portspeed</a>(di, 9600);</div>
<div class="line"><span class="lineno">  941</span>        *input_pipe_number = 0x01;</div>
<div class="line"><span class="lineno">  942</span>        *output_pipe_number = 0x02;</div>
<div class="line"><span class="lineno">  943</span>        *pipe_info_retrieved = 1;</div>
<div class="line"><span class="lineno">  944</span>        <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno">  945</span>    }</div>
<div class="line"><span class="lineno">  946</span> </div>
<div class="line"><span class="lineno">  947</span>    <span class="comment">/* Try reading pipe information. Most handhelds support a control request that returns info about the ports and</span></div>
<div class="line"><span class="lineno">  948</span><span class="comment">     * pipes. We first try the generic control code, and if it doesn&#39;t work we try the Visor one which seems to be</span></div>
<div class="line"><span class="lineno">  949</span><span class="comment">     * supported by some devices Also, we can detect that a T5 / LifeDrive is in &quot;wait&quot; mode</span></div>
<div class="line"><span class="lineno">  950</span><span class="comment">     * (device appears on USB but not synchronizing) and in this case we return a kIOReturnNotReady code.</span></div>
<div class="line"><span class="lineno">  951</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  952</span>    kr = <a class="code hl_function" href="#a1fdb9881cd44d8dfa115018ef8a8a07a">read_generic_connection_information</a> (di, port_number, input_pipe_number, output_pipe_number);</div>
<div class="line"><span class="lineno">  953</span>    <span class="keywordflow">if</span> (kr != kIOReturnSuccess &amp;&amp; kr != kIOReturnNotReady &amp;&amp; !(<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; <a class="code hl_define" href="#ae88563097067473f1b784230241b738f">FLAG_ANSWERS_PALM_CONN_INFO</a>))</div>
<div class="line"><span class="lineno">  954</span>        kr = <a class="code hl_function" href="#a90eff23f2e0b0132dbb82d4cbfeb4cc0">read_visor_connection_information</a> (di, port_number, input_pipe_number, output_pipe_number);</div>
<div class="line"><span class="lineno">  955</span>    <span class="keywordflow">if</span> (kr == kIOReturnNotReady)</div>
<div class="line"><span class="lineno">  956</span>        <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>    <span class="comment">/* With some devices (Palm) we need to hardcode the location of the pipes to use</span></div>
<div class="line"><span class="lineno">  959</span><span class="comment">     * because the Palm engineers had the good idea to mismatch the connection information data</span></div>
<div class="line"><span class="lineno">  960</span><span class="comment">     * and the actual pipes to use</span></div>
<div class="line"><span class="lineno">  961</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  962</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; (<a class="code hl_define" href="#aa9b65d1aae65a8421de1524846821b5c">FLAG_USE_FIRST_PAIR</a> | <a class="code hl_define" href="#af6fbaed2c346cfabbf727d5b266cfbcb">FLAG_USE_SECOND_PAIR</a>))</div>
<div class="line"><span class="lineno">  963</span>    {</div>
<div class="line"><span class="lineno">  964</span>        *pipe_info_retrieved = 1;</div>
<div class="line"><span class="lineno">  965</span>        <span class="keywordflow">return</span> kIOReturnSuccess;</div>
<div class="line"><span class="lineno">  966</span>    }</div>
<div class="line"><span class="lineno">  967</span> </div>
<div class="line"><span class="lineno">  968</span>    <span class="comment">/* For device which we know return connection information, we want it to be returned to</span></div>
<div class="line"><span class="lineno">  969</span><span class="comment">     * consider the device alive</span></div>
<div class="line"><span class="lineno">  970</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  971</span>    <span class="keywordflow">if</span> (kr != kIOReturnSuccess &amp;&amp; (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; <a class="code hl_define" href="#aa00463c247d30a7f25d2e64d56155280">FLAG_ANSWERS_CONN_INFO</a>))</div>
<div class="line"><span class="lineno">  972</span>        <span class="keywordflow">return</span> kIOReturnNotReady;</div>
<div class="line"><span class="lineno">  973</span> </div>
<div class="line"><span class="lineno">  974</span>    *pipe_info_retrieved = (kr == kIOReturnSuccess);</div>
<div class="line"><span class="lineno">  975</span> </div>
<div class="line"><span class="lineno">  976</span>    <span class="comment">/* query bytes available. Not that we really care, but most devices expect to receive this</span></div>
<div class="line"><span class="lineno">  977</span><span class="comment">     * before they agree on talking to us.</span></div>
<div class="line"><span class="lineno">  978</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  979</span>    <span class="keywordflow">if</span> (vendor != <a class="code hl_define" href="#a46b9a2d21d3e6f62d8d96dcadd65e9d3">VENDOR_TAPWAVE</a>)</div>
<div class="line"><span class="lineno">  980</span>    {</div>
<div class="line"><span class="lineno">  981</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ba[2];</div>
<div class="line"><span class="lineno">  982</span>        kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a> (di, 0xc2, <a class="code hl_define" href="#a999d97afe6c8af0e9f6e6592e5dddf2f">GENERIC_REQUEST_BYTES_AVAILABLE</a>, 0, 0, &amp;ba[0] , 2);</div>
<div class="line"><span class="lineno">  983</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  984</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: GENERIC_REQUEST_BYTES_AVAILABLE failed (err=%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  985</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;GENERIC_REQUEST_BYTES_AVAILABLE returns 0x%02x%02x\n&quot;</span>, ba[0], ba[1]));</div>
<div class="line"><span class="lineno">  986</span>    }</div>
<div class="line"><span class="lineno">  987</span> </div>
<div class="line"><span class="lineno">  988</span>    <span class="keywordflow">return</span> kIOReturnSuccess;</div>
<div class="line"><span class="lineno">  989</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a0ae1af091a8c549c6dd222f1348dc4bd"><div class="ttname"><a href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a></div><div class="ttdeci">#define VENDOR_PALMONE</div><div class="ttdef"><b>Definition</b> darwinusb.c:290</div></div>
<div class="ttc" id="adarwinusb_8c_html_a1fdb9881cd44d8dfa115018ef8a8a07a"><div class="ttname"><a href="#a1fdb9881cd44d8dfa115018ef8a8a07a">read_generic_connection_information</a></div><div class="ttdeci">static IOReturn read_generic_connection_information(IOUSBDeviceInterface **dev, int *port_number, int *input_pipe_number, int *output_pipe_number)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1326</div></div>
<div class="ttc" id="adarwinusb_8c_html_a46b9a2d21d3e6f62d8d96dcadd65e9d3"><div class="ttname"><a href="#a46b9a2d21d3e6f62d8d96dcadd65e9d3">VENDOR_TAPWAVE</a></div><div class="ttdeci">#define VENDOR_TAPWAVE</div><div class="ttdef"><b>Definition</b> darwinusb.c:291</div></div>
<div class="ttc" id="adarwinusb_8c_html_a601606e0ac4526dd03b88b1b864d046f"><div class="ttname"><a href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a></div><div class="ttdeci">#define PRODUCT_PALMCONNECT_USB</div><div class="ttdef"><b>Definition</b> darwinusb.c:292</div></div>
<div class="ttc" id="adarwinusb_8c_html_a6bf0b49b7f893ca4dd2b2a7739c59aec"><div class="ttname"><a href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a></div><div class="ttdeci">static IOReturn control_request(IOUSBDeviceInterface **dev, UInt8 requestType, UInt8 request, UInt16 value, UInt16 index, void *pData, UInt16 maxReplyLength)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1196</div></div>
<div class="ttc" id="adarwinusb_8c_html_a75b8e770479707f2ca65619e5e15248b"><div class="ttname"><a href="#a75b8e770479707f2ca65619e5e15248b">klsi_set_portspeed</a></div><div class="ttdeci">static IOReturn klsi_set_portspeed(IOUSBDeviceInterface **dev, int speed)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1342</div></div>
<div class="ttc" id="adarwinusb_8c_html_a90eff23f2e0b0132dbb82d4cbfeb4cc0"><div class="ttname"><a href="#a90eff23f2e0b0132dbb82d4cbfeb4cc0">read_visor_connection_information</a></div><div class="ttdeci">static IOReturn read_visor_connection_information(IOUSBDeviceInterface **dev, int *port_number, int *input_pipe, int *output_pipe)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1224</div></div>
<div class="ttc" id="adarwinusb_8c_html_a999d97afe6c8af0e9f6e6592e5dddf2f"><div class="ttname"><a href="#a999d97afe6c8af0e9f6e6592e5dddf2f">GENERIC_REQUEST_BYTES_AVAILABLE</a></div><div class="ttdeci">#define GENERIC_REQUEST_BYTES_AVAILABLE</div><div class="ttdef"><b>Definition</b> darwinusb.c:183</div></div>
<div class="ttc" id="adarwinusb_8c_html_aa00463c247d30a7f25d2e64d56155280"><div class="ttname"><a href="#aa00463c247d30a7f25d2e64d56155280">FLAG_ANSWERS_CONN_INFO</a></div><div class="ttdeci">#define FLAG_ANSWERS_CONN_INFO</div><div class="ttdef"><b>Definition</b> darwinusb.c:302</div></div>
<div class="ttc" id="adarwinusb_8c_html_aa9b65d1aae65a8421de1524846821b5c"><div class="ttname"><a href="#aa9b65d1aae65a8421de1524846821b5c">FLAG_USE_FIRST_PAIR</a></div><div class="ttdeci">#define FLAG_USE_FIRST_PAIR</div><div class="ttdef"><b>Definition</b> darwinusb.c:303</div></div>
<div class="ttc" id="adarwinusb_8c_html_ae88563097067473f1b784230241b738f"><div class="ttname"><a href="#ae88563097067473f1b784230241b738f">FLAG_ANSWERS_PALM_CONN_INFO</a></div><div class="ttdeci">#define FLAG_ANSWERS_PALM_CONN_INFO</div><div class="ttdef"><b>Definition</b> darwinusb.c:305</div></div>
<div class="ttc" id="adarwinusb_8c_html_af6fbaed2c346cfabbf727d5b266cfbcb"><div class="ttname"><a href="#af6fbaed2c346cfabbf727d5b266cfbcb">FLAG_USE_SECOND_PAIR</a></div><div class="ttdeci">#define FLAG_USE_SECOND_PAIR</div><div class="ttdef"><b>Definition</b> darwinusb.c:304</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01196">control_request()</a>, <a class="el" href="#l00302">FLAG_ANSWERS_CONN_INFO</a>, <a class="el" href="#l00305">FLAG_ANSWERS_PALM_CONN_INFO</a>, <a class="el" href="#l00303">FLAG_USE_FIRST_PAIR</a>, <a class="el" href="#l00304">FLAG_USE_SECOND_PAIR</a>, <a class="el" href="#l00311">flags</a>, <a class="el" href="#l00183">GENERIC_REQUEST_BYTES_AVAILABLE</a>, <a class="el" href="#l01342">klsi_set_portspeed()</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l01326">read_generic_connection_information()</a>, <a class="el" href="#l01224">read_visor_connection_information()</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00291">VENDOR_TAPWAVE</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_cgraph.png" border="0" usemap="#adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_cgraph" id="adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_cgraph">
<area shape="rect" title=" " alt="" coords="5,57,125,82"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="422,33,532,58"/>
<area shape="poly" title=" " alt="" coords="84,54,123,31,172,12,237,4,304,5,366,14,418,26,417,31,365,19,303,11,238,9,173,18,126,36,87,58"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="190,27,320,53"/>
<area shape="poly" title=" " alt="" coords="125,58,175,50,175,55,126,63"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="173,143,338,183"/>
<area shape="poly" title=" " alt="" coords="90,81,174,127,187,133,185,138,171,132,87,85"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="180,77,331,118"/>
<area shape="poly" title=" " alt="" coords="126,76,165,82,164,87,125,81"/>
<area shape="poly" title=" " alt="" coords="321,39,406,41,406,47,321,44"/>
<area shape="poly" title=" " alt="" coords="310,140,337,127,393,96,442,65,445,69,396,100,339,132,312,144"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="386,139,568,179"/>
<area shape="poly" title=" " alt="" coords="338,159,370,158,371,164,338,164"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="616,118,712,144"/>
<area shape="poly" title=" " alt="" coords="569,143,600,138,601,143,569,148"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="760,118,850,144"/>
<area shape="poly" title=" " alt="" coords="712,128,744,128,744,134,712,134"/>
<area shape="poly" title=" " alt="" coords="331,77,406,59,407,65,332,82"/>
<area shape="poly" title=" " alt="" coords="332,101,601,123,601,129,331,106"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_icgraph.png" border="0" usemap="#adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_icgraph" id="adarwinusb_8c_a44db8313ee840eece0ab14aa96ca9bf9_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,1981,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a7ae745d90757c279ff496b669e7dfff4" name="a7ae745d90757c279ff496b669e7dfff4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ae745d90757c279ff496b669e7dfff4">&#9670;&#160;</a></span>connection_for_socket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structusb__connection__t.html">usb_connection_t</a> * connection_for_socket </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  468</span>{</div>
<div class="line"><span class="lineno">  469</span>    <span class="comment">/* if there is no active connection associated with this socket,</span></div>
<div class="line"><span class="lineno">  470</span><span class="comment">     * try to associate the first unassociated connection</span></div>
<div class="line"><span class="lineno">  471</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  472</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref;</div>
<div class="line"><span class="lineno">  473</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, +1) &gt; 0)</div>
<div class="line"><span class="lineno">  474</span>        <span class="keywordflow">return</span> c;</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>    pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  477</span>    c = <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a>;</div>
<div class="line"><span class="lineno">  478</span>    <span class="keywordflow">while</span> (c &amp;&amp; (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a> != NULL || c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a> == 0 || c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a715fe784af3cb29d86252c388dce4be3">total_bytes_read</a> == 0))  <span class="comment">/* skip connections which are being disposed of (opened=0) */</span></div>
<div class="line"><span class="lineno">  479</span>        c = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, +1) &lt;= 0)</div>
<div class="line"><span class="lineno">  481</span>        c = NULL;</div>
<div class="line"><span class="lineno">  482</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  483</span>    {</div>
<div class="line"><span class="lineno">  484</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a> = ps;</div>
<div class="line"><span class="lineno">  485</span>        ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref = c;</div>
<div class="line"><span class="lineno">  486</span>    }</div>
<div class="line"><span class="lineno">  487</span>    pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  488</span>    <span class="keywordflow">return</span> c;</div>
<div class="line"><span class="lineno">  489</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a6b11be685f613bf98fd2492cd26c7ce6"><div class="ttname"><a href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a></div><div class="ttdeci">static int change_refcount(usb_connection_t *c, int increment)</div><div class="ttdef"><b>Definition</b> darwinusb.c:492</div></div>
<div class="ttc" id="astructusb__connection__t_html"><div class="ttname"><a href="structusb__connection__t.html">usb_connection_t</a></div><div class="ttdef"><b>Definition</b> darwinusb.c:137</div></div>
<div class="ttc" id="astructusb__connection__t_html_a69437af107eea378fe9b96e041cfadd2"><div class="ttname"><a href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">usb_connection_t::ps</a></div><div class="ttdeci">struct pi_socket * ps</div><div class="ttdef"><b>Definition</b> darwinusb.c:139</div></div>
<div class="ttc" id="astructusb__connection__t_html_a715fe784af3cb29d86252c388dce4be3"><div class="ttname"><a href="structusb__connection__t.html#a715fe784af3cb29d86252c388dce4be3">usb_connection_t::total_bytes_read</a></div><div class="ttdeci">unsigned long total_bytes_read</div><div class="ttdef"><b>Definition</b> darwinusb.c:166</div></div>
<div class="ttc" id="astructusb__connection__t_html_af2606797deda70b5effbc50b2648d699"><div class="ttname"><a href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">usb_connection_t::opened</a></div><div class="ttdeci">int opened</div><div class="ttdef"><b>Definition</b> darwinusb.c:153</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00138">usb_connection_t::next</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00139">usb_connection_t::ps</a>, <a class="el" href="#l00166">usb_connection_t::total_bytes_read</a>, <a class="el" href="#l00178">usb_connections</a>, and <a class="el" href="#l00131">usb_connections_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01695">u_poll()</a>, and <a class="el" href="#l01642">u_wait_for_device()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_cgraph.png" border="0" usemap="#adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_cgraph" id="adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,158,56"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="206,31,323,56"/>
<area shape="poly" title=" " alt="" coords="158,41,190,41,190,46,158,46"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="371,5,505,31"/>
<area shape="poly" title=" " alt="" coords="323,32,355,28,356,33,324,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="388,55,489,80"/>
<area shape="poly" title=" " alt="" coords="324,49,372,56,372,61,323,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_icgraph.png" border="0" usemap="#adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_icgraph" id="adarwinusb_8c_a7ae745d90757c279ff496b669e7dfff4_icgraph">
<area shape="rect" title=" " alt="" coords="1466,242,1619,268"/>
<area shape="rect" href="darwinusb_8c.html#a20220d60460da3af89e8e25bec84a595" title=" " alt="" coords="1328,217,1383,242"/>
<area shape="poly" title=" " alt="" coords="1451,245,1383,236,1384,231,1451,240"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1292,266,1418,292"/>
<area shape="poly" title=" " alt="" coords="1451,269,1419,274,1418,268,1451,264"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1313,239,1245,249,1244,244,1312,233"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="1276,270,1244,266,1245,261,1277,265"/>
</map>
</div>

</div>
</div>
<a id="a6bf0b49b7f893ca4dd2b2a7739c59aec" name="a6bf0b49b7f893ca4dd2b2a7739c59aec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">&#9670;&#160;</a></span>control_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn control_request </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UInt8</td>          <td class="paramname"><span class="paramname"><em>requestType</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UInt8</td>          <td class="paramname"><span class="paramname"><em>request</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UInt16</td>          <td class="paramname"><span class="paramname"><em>value</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UInt16</td>          <td class="paramname"><span class="paramname"><em>index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>pData</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UInt16</td>          <td class="paramname"><span class="paramname"><em>maxReplyLength</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1197</span>{</div>
<div class="line"><span class="lineno"> 1198</span>    IOReturn kr;</div>
<div class="line"><span class="lineno"> 1199</span>    IOUSBDevRequest req;</div>
<div class="line"><span class="lineno"> 1200</span>    <span class="keywordtype">void</span> *pReply = pData;</div>
<div class="line"><span class="lineno"> 1201</span> </div>
<div class="line"><span class="lineno"> 1202</span>    <span class="keywordflow">if</span> (!pReply &amp;&amp; maxReplyLength)</div>
<div class="line"><span class="lineno"> 1203</span>        pReply = malloc(maxReplyLength);</div>
<div class="line"><span class="lineno"> 1204</span> </div>
<div class="line"><span class="lineno"> 1205</span>    req.bmRequestType = requestType;    <span class="comment">/* i.e. 0xc2=kUSBIn, kUSBVendor, kUSBEndpoint */</span></div>
<div class="line"><span class="lineno"> 1206</span>    req.bRequest = request;</div>
<div class="line"><span class="lineno"> 1207</span>    req.wValue = value;</div>
<div class="line"><span class="lineno"> 1208</span>    req.wIndex = index;</div>
<div class="line"><span class="lineno"> 1209</span>    req.wLength = maxReplyLength;</div>
<div class="line"><span class="lineno"> 1210</span>    req.pData = pReply;</div>
<div class="line"><span class="lineno"> 1211</span>    req.wLenDone = 0;</div>
<div class="line"><span class="lineno"> 1212</span> </div>
<div class="line"><span class="lineno"> 1213</span>    kr = (*dev)-&gt;DeviceRequest (dev, &amp;req);</div>
<div class="line"><span class="lineno"> 1214</span> </div>
<div class="line"><span class="lineno"> 1215</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: control_request(0x%02x) wLenDone=%d kr=0x%08lx\n&quot;</span>, (<span class="keywordtype">int</span>)request, req.wLenDone, kr));</div>
<div class="line"><span class="lineno"> 1216</span> </div>
<div class="line"><span class="lineno"> 1217</span>    <span class="keywordflow">if</span> (pReply &amp;&amp; !pData)</div>
<div class="line"><span class="lineno"> 1218</span>        free (pReply);</div>
<div class="line"><span class="lineno"> 1219</span> </div>
<div class="line"><span class="lineno"> 1220</span>    <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno"> 1221</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l01342">klsi_set_portspeed()</a>, <a class="el" href="#l01326">read_generic_connection_information()</a>, and <a class="el" href="#l01224">read_visor_connection_information()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a6bf0b49b7f893ca4dd2b2a7739c59aec_icgraph.png" border="0" usemap="#adarwinusb_8c_a6bf0b49b7f893ca4dd2b2a7739c59aec_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a6bf0b49b7f893ca4dd2b2a7739c59aec_icgraph" id="adarwinusb_8c_a6bf0b49b7f893ca4dd2b2a7739c59aec_icgraph">
<area shape="rect" title=" " alt="" coords="2270,182,2380,208"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="1889,192,2009,217"/>
<area shape="poly" title=" " alt="" coords="2296,175,2262,151,2221,132,2176,120,2139,116,2103,120,2058,132,2030,144,2004,160,1965,193,1962,189,2001,156,2027,139,2056,127,2102,115,2139,111,2177,115,2223,127,2265,146,2299,170"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="2074,272,2204,297"/>
<area shape="poly" title=" " alt="" coords="2295,219,2261,241,2223,261,2192,273,2190,268,2221,257,2258,236,2292,215"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="2057,141,2222,182"/>
<area shape="poly" title=" " alt="" coords="2254,185,2222,179,2223,174,2255,180"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="2064,207,2215,247"/>
<area shape="poly" title=" " alt="" coords="2255,210,2216,217,2215,211,2254,205"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1738,192,1839,217"/>
<area shape="poly" title=" " alt="" coords="1874,207,1840,207,1840,202,1874,202"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1574,192,1676,217"/>
<area shape="poly" title=" " alt="" coords="1723,207,1677,207,1677,202,1723,202"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,192,1514,217"/>
<area shape="poly" title=" " alt="" coords="1558,207,1514,207,1514,202,1558,202"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,192,1355,217"/>
<area shape="poly" title=" " alt="" coords="1388,207,1356,207,1356,202,1388,202"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1278,224,1224,244,1223,239,1277,219"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="2075,269,2056,261,1974,220,1976,215,2058,257,2077,264"/>
<area shape="rect" href="darwinusb_8c.html#a18148cdc8c3dbba549e8a762a791bc0e" title=" " alt="" coords="1736,242,1841,268"/>
<area shape="poly" title=" " alt="" coords="2059,280,1842,262,1842,257,2059,275"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1562,293,1688,318"/>
<area shape="poly" title=" " alt="" coords="2059,290,1689,306,1688,300,2058,285"/>
<area shape="poly" title=" " alt="" coords="1721,258,1245,258,1245,252,1721,252"/>
<area shape="poly" title=" " alt="" coords="1546,303,1426,292,1292,276,1244,269,1245,263,1292,271,1426,287,1546,297"/>
<area shape="poly" title=" " alt="" coords="2042,186,2010,194,2009,188,2041,181"/>
<area shape="poly" title=" " alt="" coords="2048,219,2009,214,2010,209,2049,214"/>
</map>
</div>

</div>
</div>
<a id="afc3c7be2611f3f3152b1351e8d696270" name="afc3c7be2611f3f3152b1351e8d696270"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc3c7be2611f3f3152b1351e8d696270">&#9670;&#160;</a></span>darwinusb_setoptions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void darwinusb_setoptions </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>multiple_connections_support</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  406</span>{</div>
<div class="line"><span class="lineno">  407</span>    <a class="code hl_variable" href="#a8bdf361a62cb4e7c490fc6023606a290">accept_multiple_simultaneous_connections</a> = multiple_connections_support;</div>
<div class="line"><span class="lineno">  408</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a8bdf361a62cb4e7c490fc6023606a290"><div class="ttname"><a href="#a8bdf361a62cb4e7c490fc6023606a290">accept_multiple_simultaneous_connections</a></div><div class="ttdeci">static int accept_multiple_simultaneous_connections</div><div class="ttdef"><b>Definition</b> darwinusb.c:119</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00119">accept_multiple_simultaneous_connections</a>.</p>

</div>
</div>
<a id="a0cc85622030ec13870fc90026ace908b" name="a0cc85622030ec13870fc90026ace908b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cc85622030ec13870fc90026ace908b">&#9670;&#160;</a></span>decode_generic_connection_information()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn decode_generic_connection_information </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a> *</td>          <td class="paramname"><span class="paramname"><em>ci</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>port_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>input_pipe</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>output_pipe</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1280</span>{</div>
<div class="line"><span class="lineno"> 1281</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 1282</span> </div>
<div class="line"><span class="lineno"> 1283</span>    CHECK(PI_DBG_DEV, PI_DBG_LVL_DEBUG, <a class="code hl_function" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9">pi_dumpdata</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)ci, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a>)));</div>
<div class="line"><span class="lineno"> 1284</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: decode_generic_connection_information num_ports=%d, endpoint_numbers_different=%d\n&quot;</span>, ci-&gt;num_ports, ci-&gt;endpoint_numbers_different));</div>
<div class="line"><span class="lineno"> 1285</span> </div>
<div class="line"><span class="lineno"> 1286</span>    <span class="keywordflow">for</span> (i=0; i &lt; ci-&gt;num_ports; i++)</div>
<div class="line"><span class="lineno"> 1287</span>    {</div>
<div class="line"><span class="lineno"> 1288</span>        UInt32 port_function_id = CFSwapInt32LittleToHost(ci-&gt;connections[i].port_function_id);</div>
<div class="line"><span class="lineno"> 1289</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;\t[%d] port_function_id=0x%08lx (&#39;%4.4s&#39;)\n&quot;</span>, i, port_function_id, (<span class="keywordtype">char</span>*)&amp;port_function_id));</div>
<div class="line"><span class="lineno"> 1290</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;\t[%d] port=%d\n&quot;</span>, i, ci-&gt;connections[i].port));</div>
<div class="line"><span class="lineno"> 1291</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;\t[%d] endpoint_info=%d (0x%02x)\n&quot;</span>, i, ci-&gt;connections[i].endpoint_info, (<span class="keywordtype">int</span>)ci-&gt;connections[i].endpoint_info));</div>
<div class="line"><span class="lineno"> 1292</span>        <span class="keywordflow">if</span> (port_function_id == <span class="stringliteral">&#39;rfsL&#39;</span>)</div>
<div class="line"><span class="lineno"> 1293</span>        {</div>
<div class="line"><span class="lineno"> 1294</span>            <span class="comment">/* This is a T5 in USB connected but not synchronizing:</span></div>
<div class="line"><span class="lineno"> 1295</span><span class="comment">             * don&#39;t bother trying to talk to it</span></div>
<div class="line"><span class="lineno"> 1296</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 1297</span>            <span class="keywordflow">return</span> kIOReturnNotReady;</div>
<div class="line"><span class="lineno"> 1298</span>        }</div>
<div class="line"><span class="lineno"> 1299</span>        <span class="keywordflow">if</span> (port_function_id == <span class="stringliteral">&#39;sync&#39;</span> || port_function_id == <span class="stringliteral">&#39;ppp_&#39;</span>)</div>
<div class="line"><span class="lineno"> 1300</span>        {</div>
<div class="line"><span class="lineno"> 1301</span>            <span class="comment">/* we found the port/pipes to use for synchronization</span></div>
<div class="line"><span class="lineno"> 1302</span><span class="comment">             * If endpoint_numbers_different is != 0, then the number of each</span></div>
<div class="line"><span class="lineno"> 1303</span><span class="comment">             * endpoint to use for IN and OUT is stored in endpoint_info.</span></div>
<div class="line"><span class="lineno"> 1304</span><span class="comment">             * Otherwise, the port number (same for both endpoints) is in</span></div>
<div class="line"><span class="lineno"> 1305</span><span class="comment">             * port.</span></div>
<div class="line"><span class="lineno"> 1306</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 1307</span>            <span class="keywordflow">if</span> (!ci-&gt;endpoint_numbers_different)</div>
<div class="line"><span class="lineno"> 1308</span>            {</div>
<div class="line"><span class="lineno"> 1309</span>                <span class="keywordflow">if</span> (port_number)</div>
<div class="line"><span class="lineno"> 1310</span>                    *port_number = ci-&gt;connections[i].port;</div>
<div class="line"><span class="lineno"> 1311</span>            }</div>
<div class="line"><span class="lineno"> 1312</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ci-&gt;connections[i].endpoint_info)</div>
<div class="line"><span class="lineno"> 1313</span>            {</div>
<div class="line"><span class="lineno"> 1314</span>                <span class="keywordflow">if</span> (input_pipe)</div>
<div class="line"><span class="lineno"> 1315</span>                    *input_pipe = ci-&gt;connections[i].endpoint_info &gt;&gt; 4;</div>
<div class="line"><span class="lineno"> 1316</span>                <span class="keywordflow">if</span> (output_pipe)</div>
<div class="line"><span class="lineno"> 1317</span>                    *output_pipe = ci-&gt;connections[i].endpoint_info &amp; 0x0f;</div>
<div class="line"><span class="lineno"> 1318</span>            }</div>
<div class="line"><span class="lineno"> 1319</span>        }</div>
<div class="line"><span class="lineno"> 1320</span>    }</div>
<div class="line"><span class="lineno"> 1321</span> </div>
<div class="line"><span class="lineno"> 1322</span>    <span class="keywordflow">return</span> kIOReturnSuccess;</div>
<div class="line"><span class="lineno"> 1323</span>}</div>
<div class="ttc" id="adebug_8c_html_ac942525fcc03cc9c77dfe0628ade03b9"><div class="ttname"><a href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9">pi_dumpdata</a></div><div class="ttdeci">void pi_dumpdata(const char *buf, size_t len)</div><div class="ttdef"><b>Definition</b> debug.c:222</div></div>
<div class="ttc" id="astructpalm__ext__connection__info_html"><div class="ttname"><a href="structpalm__ext__connection__info.html">palm_ext_connection_info</a></div><div class="ttdef"><b>Definition</b> darwinusb.c:213</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpalm__ext__connection__info.html#afaddc03616def8c4649345548c7a6131">palm_ext_connection_info::connections</a>, <a class="el" href="#l00221">palm_ext_connection_info::endpoint_info</a>, <a class="el" href="#l00215">palm_ext_connection_info::endpoint_numbers_different</a>, <a class="el" href="#l00214">palm_ext_connection_info::num_ports</a>, <a class="el" href="#l00222">pi_dumpdata()</a>, <a class="el" href="#l00220">palm_ext_connection_info::port</a>, and <a class="el" href="#l00219">palm_ext_connection_info::port_function_id</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00992">find_interfaces()</a>, and <a class="el" href="#l01326">read_generic_connection_information()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a0cc85622030ec13870fc90026ace908b_cgraph.png" border="0" usemap="#adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_cgraph" id="adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,188,46"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="236,13,331,38"/>
<area shape="poly" title=" " alt="" coords="188,23,220,23,220,28,188,28"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="379,13,469,38"/>
<area shape="poly" title=" " alt="" coords="331,23,363,23,363,28,331,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a0cc85622030ec13870fc90026ace908b_icgraph.png" border="0" usemap="#adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_icgraph" id="adarwinusb_8c_a0cc85622030ec13870fc90026ace908b_icgraph">
<area shape="rect" title=" " alt="" coords="2242,235,2424,275"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="1868,216,1974,241"/>
<area shape="poly" title=" " alt="" coords="2226,251,1974,234,1975,229,2226,245"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="2029,263,2194,303"/>
<area shape="poly" title=" " alt="" coords="2227,271,2195,275,2194,270,2226,266"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1853,242,1814,249,1813,244,1852,237"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="1861,266,1981,292"/>
<area shape="poly" title=" " alt="" coords="2013,284,1981,283,1981,278,2013,278"/>
<area shape="poly" title=" " alt="" coords="1845,270,1813,265,1814,260,1846,265"/>
</map>
</div>

</div>
</div>
<a id="ad2382b0d9c99eeded50fdcb6f448b92d" name="ad2382b0d9c99eeded50fdcb6f448b92d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2382b0d9c99eeded50fdcb6f448b92d">&#9670;&#160;</a></span>device_added()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void device_added </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>refCon</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">io_iterator_t</td>          <td class="paramname"><span class="paramname"><em>iterator</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  715</span>{</div>
<div class="line"><span class="lineno">  716</span>    kern_return_t kr;</div>
<div class="line"><span class="lineno">  717</span>    io_service_t ioDevice;</div>
<div class="line"><span class="lineno">  718</span>    IOCFPlugInInterface **plugInInterface = NULL;</div>
<div class="line"><span class="lineno">  719</span>    IOUSBDeviceInterface **dev = NULL;</div>
<div class="line"><span class="lineno">  720</span>    HRESULT res;</div>
<div class="line"><span class="lineno">  721</span>    SInt32 score;</div>
<div class="line"><span class="lineno">  722</span>    UInt16 vendor, product;</div>
<div class="line"><span class="lineno">  723</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> accept_flags;</div>
<div class="line"><span class="lineno">  724</span>    <span class="keywordtype">int</span> port_number = 0xff,</div>
<div class="line"><span class="lineno">  725</span>        input_pipe_number = 0xff,</div>
<div class="line"><span class="lineno">  726</span>        output_pipe_number = 0xff,</div>
<div class="line"><span class="lineno">  727</span>        pipe_info_retrieved = 0;</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: device_added\n&quot;</span>));</div>
<div class="line"><span class="lineno">  730</span> </div>
<div class="line"><span class="lineno">  731</span>    <span class="keywordflow">while</span> ((ioDevice = IOIteratorNext (iterator)))</div>
<div class="line"><span class="lineno">  732</span>    {</div>
<div class="line"><span class="lineno">  733</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a> != NULL &amp;&amp; !<a class="code hl_variable" href="#a8bdf361a62cb4e7c490fc6023606a290">accept_multiple_simultaneous_connections</a>)</div>
<div class="line"><span class="lineno">  734</span>        {</div>
<div class="line"><span class="lineno">  735</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: new device plugged but we already have a running connection\n&quot;</span>));</div>
<div class="line"><span class="lineno">  736</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  737</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  738</span>        }</div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>        kr = IOCreatePlugInInterfaceForService (ioDevice, kIOUSBDeviceUserClientTypeID, kIOCFPlugInInterfaceID, &amp;plugInInterface, &amp;score);</div>
<div class="line"><span class="lineno">  741</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess || !plugInInterface)</div>
<div class="line"><span class="lineno">  742</span>        {</div>
<div class="line"><span class="lineno">  743</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: -&gt; unable to create a plugin (kr=0x%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  744</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  745</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  746</span>        }</div>
<div class="line"><span class="lineno">  747</span> </div>
<div class="line"><span class="lineno">  748</span>        res = (*plugInInterface)-&gt;QueryInterface (plugInInterface, CFUUIDGetUUIDBytes (kIOUSBDeviceInterfaceID), (LPVOID *)&amp;dev);</div>
<div class="line"><span class="lineno">  749</span>        (*plugInInterface)-&gt;Release (plugInInterface);</div>
<div class="line"><span class="lineno">  750</span>        <span class="keywordflow">if</span> (res || !dev)</div>
<div class="line"><span class="lineno">  751</span>        {</div>
<div class="line"><span class="lineno">  752</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: couldn&#39;t create a device interface (res=0x%08x)\n&quot;</span>, (<span class="keywordtype">int</span>) res));</div>
<div class="line"><span class="lineno">  753</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  754</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  755</span>        }</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>        <span class="comment">/* make sure this device is not already being handled (this may happen</span></div>
<div class="line"><span class="lineno">  758</span><span class="comment">         * with some handhelds that reconnect immediately after disconnecting, like the T5)</span></div>
<div class="line"><span class="lineno">  759</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  760</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6378ac6f6b9262ad7cba19de626cd74b">device_already_in_use</a>(dev))</div>
<div class="line"><span class="lineno">  761</span>        {</div>
<div class="line"><span class="lineno">  762</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: device %p already in use, skipping it\n&quot;</span>));</div>
<div class="line"><span class="lineno">  763</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  764</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  765</span>        }</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>        kr = (*dev)-&gt;GetDeviceVendor (dev, &amp;vendor);</div>
<div class="line"><span class="lineno">  768</span>        kr = (*dev)-&gt;GetDeviceProduct (dev, &amp;product);</div>
<div class="line"><span class="lineno">  769</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#ab10d2c139ee0772df628b5e705368986">accepts_device</a>(vendor, product, &amp;accept_flags) == 0)</div>
<div class="line"><span class="lineno">  770</span>        {</div>
<div class="line"><span class="lineno">  771</span>            <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: not accepting device (vendor=0x%04x product=0x%04x)\n&quot;</span>, vendor, product));</div>
<div class="line"><span class="lineno">  772</span>            (*dev)-&gt;Release(dev);</div>
<div class="line"><span class="lineno">  773</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  774</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  775</span>        }</div>
<div class="line"><span class="lineno">  776</span> </div>
<div class="line"><span class="lineno">  777</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: Accepted USB device, vendor: 0x%04x product: 0x%04x\n&quot;</span>, vendor, product));</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>        kr = (*dev)-&gt;USBDeviceOpen (dev);</div>
<div class="line"><span class="lineno">  780</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  781</span>        {</div>
<div class="line"><span class="lineno">  782</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to open device (kr=0x%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  783</span>            (*dev)-&gt;Release(dev);</div>
<div class="line"><span class="lineno">  784</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  785</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  786</span>        }</div>
<div class="line"><span class="lineno">  787</span> </div>
<div class="line"><span class="lineno">  788</span>        <span class="comment">/* configure the device and query for its preferred I/O pipes */</span></div>
<div class="line"><span class="lineno">  789</span>        kr = <a class="code hl_function" href="#a44db8313ee840eece0ab14aa96ca9bf9">configure_device</a> (dev, vendor, product, accept_flags, &amp;port_number, &amp;input_pipe_number, &amp;output_pipe_number, &amp;pipe_info_retrieved);</div>
<div class="line"><span class="lineno">  790</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  791</span>        {</div>
<div class="line"><span class="lineno">  792</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, (kr == kIOReturnNotReady)</div>
<div class="line"><span class="lineno">  793</span>                ?   <span class="stringliteral">&quot;darwinusb: device not ready to synchonize\n&quot;</span></div>
<div class="line"><span class="lineno">  794</span>                :   <span class="stringliteral">&quot;darwinusb: unable to configure device (kr=0x%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  795</span>            (*dev)-&gt;USBDeviceClose (dev);</div>
<div class="line"><span class="lineno">  796</span>            (*dev)-&gt;Release (dev);</div>
<div class="line"><span class="lineno">  797</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  798</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  799</span>        }</div>
<div class="line"><span class="lineno">  800</span> </div>
<div class="line"><span class="lineno">  801</span>        <span class="comment">/* allocate and initialize the USB connection structure */</span></div>
<div class="line"><span class="lineno">  802</span>        <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = malloc(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a>));</div>
<div class="line"><span class="lineno">  803</span>        <span class="keywordflow">if</span> (c == NULL)</div>
<div class="line"><span class="lineno">  804</span>        {</div>
<div class="line"><span class="lineno">  805</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;out of memory&quot;</span>));</div>
<div class="line"><span class="lineno">  806</span>            (*dev)-&gt;USBDeviceClose (dev);</div>
<div class="line"><span class="lineno">  807</span>            (*dev)-&gt;Release (dev);</div>
<div class="line"><span class="lineno">  808</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  809</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  810</span>        }</div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>        memset(c, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a>));</div>
<div class="line"><span class="lineno">  813</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#adeee881b70cc7c96d0bbd73ebf17ccd6">auto_read_size</a> = <a class="code hl_define" href="#ae99d6e8e31cdbd8fc416acd8f0c6df2f">AUTO_READ_SIZE</a>;</div>
<div class="line"><span class="lineno">  814</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a> = dev;</div>
<div class="line"><span class="lineno">  815</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a> = 1;</div>
<div class="line"><span class="lineno">  816</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a> = 1;</div>
<div class="line"><span class="lineno">  817</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a59f3e9e231f31b803dc068e5cbfcb4ac">device_present</a> = 1;</div>
<div class="line"><span class="lineno">  818</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aafae79b6a22926854b79c987d784db2d">vendorID</a> = vendor;</div>
<div class="line"><span class="lineno">  819</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a43b0eb165838e76a61358dc70072e62b">productID</a> = product;</div>
<div class="line"><span class="lineno">  820</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a3aac450cb830fcdd9b14d91cf7d6cbaf">dev_flags</a> = accept_flags;</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>        <span class="comment">/* try to locate the pipes we need to talk to the device */</span></div>
<div class="line"><span class="lineno">  823</span>        kr = <a class="code hl_function" href="#ad2b23562cd53b9fee904b9ad45ab2889">find_interfaces</a>(c, dev, vendor, product, accept_flags, port_number, input_pipe_number, output_pipe_number, pipe_info_retrieved);</div>
<div class="line"><span class="lineno">  824</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  825</span>        {</div>
<div class="line"><span class="lineno">  826</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to find interfaces (kr=0x%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  827</span>            free(c);</div>
<div class="line"><span class="lineno">  828</span>            (*dev)-&gt;USBDeviceClose (dev);</div>
<div class="line"><span class="lineno">  829</span>            (*dev)-&gt;Release (dev);</div>
<div class="line"><span class="lineno">  830</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  831</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  832</span>        }</div>
<div class="line"><span class="lineno">  833</span> </div>
<div class="line"><span class="lineno">  834</span>        <span class="comment">/* Just like with service matching notifications, we need to create an event source and add it</span></div>
<div class="line"><span class="lineno">  835</span><span class="comment">         * to our run loop in order to receive async completion notifications.</span></div>
<div class="line"><span class="lineno">  836</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  837</span>        CFRunLoopSourceRef runLoopSource;</div>
<div class="line"><span class="lineno">  838</span>        kr = (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)-&gt;CreateInterfaceAsyncEventSource (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>, &amp;runLoopSource);</div>
<div class="line"><span class="lineno">  839</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno">  840</span>        {</div>
<div class="line"><span class="lineno">  841</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: Unable to create async event source (%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  842</span>            free(c);</div>
<div class="line"><span class="lineno">  843</span>            (*dev)-&gt;USBDeviceClose (dev);</div>
<div class="line"><span class="lineno">  844</span>            (*dev)-&gt;Release (dev);</div>
<div class="line"><span class="lineno">  845</span>            IOObjectRelease (ioDevice);</div>
<div class="line"><span class="lineno">  846</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  847</span>        }</div>
<div class="line"><span class="lineno">  848</span>        CFRunLoopAddSource (CFRunLoopGetCurrent(), runLoopSource, kCFRunLoopDefaultMode);</div>
<div class="line"><span class="lineno">  849</span> </div>
<div class="line"><span class="lineno">  850</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_INFO, <span class="stringliteral">&quot;darwinusb: USBConnection %p OPENED c-&gt;in_pipe_ref=%d c-&gt;out_pipe_ref=%d\n&quot;</span>,c,c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#acc95a38d797cbd26598763dd6411e223">in_pipe_ref</a>,c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a68cda814b13e4e7b07f76f0291771bca">out_pipe_ref</a>));</div>
<div class="line"><span class="lineno">  851</span> </div>
<div class="line"><span class="lineno">  852</span>        <span class="comment">/* Register for an interest notification for this device,</span></div>
<div class="line"><span class="lineno">  853</span><span class="comment">         * so we get notified when it goes away</span></div>
<div class="line"><span class="lineno">  854</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  855</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: registering for disconnect notification\n&quot;</span>));</div>
<div class="line"><span class="lineno">  856</span>        kr = IOServiceAddInterestNotification(</div>
<div class="line"><span class="lineno">  857</span>                <a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a>,</div>
<div class="line"><span class="lineno">  858</span>                ioDevice,</div>
<div class="line"><span class="lineno">  859</span>                kIOGeneralInterest,</div>
<div class="line"><span class="lineno">  860</span>                (IOServiceInterestCallback)<a class="code hl_function" href="#a1760782cd564351de8fb058afe311e05">device_notification</a>,</div>
<div class="line"><span class="lineno">  861</span>                (<span class="keywordtype">void</span> *)c,</div>
<div class="line"><span class="lineno">  862</span>                &amp;c-&gt;device_notification);</div>
<div class="line"><span class="lineno">  863</span>        IOObjectRelease(ioDevice);</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>        <span class="comment">/* add the device to our linked list, then only start reading data</span></div>
<div class="line"><span class="lineno">  866</span><span class="comment">         * (order of operations matters here to avoid race conditions)</span></div>
<div class="line"><span class="lineno">  867</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  868</span>        pthread_mutex_init(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>, NULL);</div>
<div class="line"><span class="lineno">  869</span>        pthread_mutex_init(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>, NULL);</div>
<div class="line"><span class="lineno">  870</span>        pthread_cond_init(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">read_queue_data_avail_cond</a>, NULL);</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>        <a class="code hl_function" href="#ab97608baf2dc20e00693ea3d28b1c5fe">add_connection</a>(c);</div>
<div class="line"><span class="lineno">  873</span>        <a class="code hl_function" href="#a9a37658b034e10d52a5affda2c28a26d">prime_read</a>(c);</div>
<div class="line"><span class="lineno">  874</span>    }</div>
<div class="line"><span class="lineno">  875</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a1760782cd564351de8fb058afe311e05"><div class="ttname"><a href="#a1760782cd564351de8fb058afe311e05">device_notification</a></div><div class="ttdeci">static void device_notification(usb_connection_t *connexion, io_service_t service, natural_t messageType, void *messageArgument)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1378</div></div>
<div class="ttc" id="adarwinusb_8c_html_a1bd3b03e77dab6f4cb1e1dba056ece1f"><div class="ttname"><a href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a></div><div class="ttdeci">static IONotificationPortRef usb_notify_port</div><div class="ttdef"><b>Definition</b> darwinusb.c:123</div></div>
<div class="ttc" id="adarwinusb_8c_html_a44db8313ee840eece0ab14aa96ca9bf9"><div class="ttname"><a href="#a44db8313ee840eece0ab14aa96ca9bf9">configure_device</a></div><div class="ttdeci">static IOReturn configure_device(IOUSBDeviceInterface **dev, unsigned short vendor, unsigned short product, unsigned short flags, int *port_number, int *input_pipe_number, int *output_pipe_number, int *pipe_info_retrieved)</div><div class="ttdef"><b>Definition</b> darwinusb.c:878</div></div>
<div class="ttc" id="adarwinusb_8c_html_a6378ac6f6b9262ad7cba19de626cd74b"><div class="ttname"><a href="#a6378ac6f6b9262ad7cba19de626cd74b">device_already_in_use</a></div><div class="ttdeci">static int device_already_in_use(IOUSBDeviceInterface **device)</div><div class="ttdef"><b>Definition</b> darwinusb.c:455</div></div>
<div class="ttc" id="adarwinusb_8c_html_a9a37658b034e10d52a5affda2c28a26d"><div class="ttname"><a href="#a9a37658b034e10d52a5affda2c28a26d">prime_read</a></div><div class="ttdeci">static int prime_read(usb_connection_t *connexion)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1493</div></div>
<div class="ttc" id="adarwinusb_8c_html_aadb790394ac125bbdc67225d17df07a2"><div class="ttname"><a href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a></div><div class="ttdeci">#define ULOG(a)</div><div class="ttdef"><b>Definition</b> darwinusb.c:106</div></div>
<div class="ttc" id="adarwinusb_8c_html_ab10d2c139ee0772df628b5e705368986"><div class="ttname"><a href="#ab10d2c139ee0772df628b5e705368986">accepts_device</a></div><div class="ttdeci">static int accepts_device(unsigned short vendor, unsigned short product, unsigned short *flags)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1551</div></div>
<div class="ttc" id="adarwinusb_8c_html_ab97608baf2dc20e00693ea3d28b1c5fe"><div class="ttname"><a href="#ab97608baf2dc20e00693ea3d28b1c5fe">add_connection</a></div><div class="ttdeci">static void add_connection(usb_connection_t *c)</div><div class="ttdef"><b>Definition</b> darwinusb.c:417</div></div>
<div class="ttc" id="adarwinusb_8c_html_ad2b23562cd53b9fee904b9ad45ab2889"><div class="ttname"><a href="#ad2b23562cd53b9fee904b9ad45ab2889">find_interfaces</a></div><div class="ttdeci">static IOReturn find_interfaces(usb_connection_t *usb, IOUSBDeviceInterface **dev, unsigned short vendor, unsigned short product, unsigned short accept_flags, int port_number, int input_pipe_number, int output_pipe_number, int pipe_info_retrieved)</div><div class="ttdef"><b>Definition</b> darwinusb.c:992</div></div>
<div class="ttc" id="adarwinusb_8c_html_ae99d6e8e31cdbd8fc416acd8f0c6df2f"><div class="ttname"><a href="#ae99d6e8e31cdbd8fc416acd8f0c6df2f">AUTO_READ_SIZE</a></div><div class="ttdeci">#define AUTO_READ_SIZE</div><div class="ttdef"><b>Definition</b> darwinusb.c:113</div></div>
<div class="ttc" id="astructusb__connection__t_html_a15cef2af78c20d8458a10dca6fd3fc47"><div class="ttname"><a href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">usb_connection_t::device</a></div><div class="ttdeci">IOUSBDeviceInterface ** device</div><div class="ttdef"><b>Definition</b> darwinusb.c:146</div></div>
<div class="ttc" id="astructusb__connection__t_html_a3aac450cb830fcdd9b14d91cf7d6cbaf"><div class="ttname"><a href="structusb__connection__t.html#a3aac450cb830fcdd9b14d91cf7d6cbaf">usb_connection_t::dev_flags</a></div><div class="ttdeci">unsigned short dev_flags</div><div class="ttdef"><b>Definition</b> darwinusb.c:151</div></div>
<div class="ttc" id="astructusb__connection__t_html_a43b0eb165838e76a61358dc70072e62b"><div class="ttname"><a href="structusb__connection__t.html#a43b0eb165838e76a61358dc70072e62b">usb_connection_t::productID</a></div><div class="ttdeci">unsigned short productID</div><div class="ttdef"><b>Definition</b> darwinusb.c:150</div></div>
<div class="ttc" id="astructusb__connection__t_html_a59f3e9e231f31b803dc068e5cbfcb4ac"><div class="ttname"><a href="structusb__connection__t.html#a59f3e9e231f31b803dc068e5cbfcb4ac">usb_connection_t::device_present</a></div><div class="ttdeci">int device_present</div><div class="ttdef"><b>Definition</b> darwinusb.c:154</div></div>
<div class="ttc" id="astructusb__connection__t_html_a68cda814b13e4e7b07f76f0291771bca"><div class="ttname"><a href="structusb__connection__t.html#a68cda814b13e4e7b07f76f0291771bca">usb_connection_t::out_pipe_ref</a></div><div class="ttdeci">int out_pipe_ref</div><div class="ttdef"><b>Definition</b> darwinusb.c:158</div></div>
<div class="ttc" id="astructusb__connection__t_html_a94f77f42cff14e8e1a1ef7d78a4d2716"><div class="ttname"><a href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">usb_connection_t::read_queue_data_avail_cond</a></div><div class="ttdeci">pthread_cond_t read_queue_data_avail_cond</div><div class="ttdef"><b>Definition</b> darwinusb.c:170</div></div>
<div class="ttc" id="astructusb__connection__t_html_aafae79b6a22926854b79c987d784db2d"><div class="ttname"><a href="structusb__connection__t.html#aafae79b6a22926854b79c987d784db2d">usb_connection_t::vendorID</a></div><div class="ttdeci">unsigned short vendorID</div><div class="ttdef"><b>Definition</b> darwinusb.c:149</div></div>
<div class="ttc" id="astructusb__connection__t_html_acc95a38d797cbd26598763dd6411e223"><div class="ttname"><a href="structusb__connection__t.html#acc95a38d797cbd26598763dd6411e223">usb_connection_t::in_pipe_ref</a></div><div class="ttdeci">int in_pipe_ref</div><div class="ttdef"><b>Definition</b> darwinusb.c:156</div></div>
<div class="ttc" id="astructusb__connection__t_html_ada025c31273ecb90a17a5a5750201d12"><div class="ttname"><a href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">usb_connection_t::read_queue_mutex</a></div><div class="ttdeci">pthread_mutex_t read_queue_mutex</div><div class="ttdef"><b>Definition</b> darwinusb.c:169</div></div>
<div class="ttc" id="astructusb__connection__t_html_adeee881b70cc7c96d0bbd73ebf17ccd6"><div class="ttname"><a href="structusb__connection__t.html#adeee881b70cc7c96d0bbd73ebf17ccd6">usb_connection_t::auto_read_size</a></div><div class="ttdeci">int auto_read_size</div><div class="ttdef"><b>Definition</b> darwinusb.c:162</div></div>
<div class="ttc" id="astructusb__connection__t_html_ae72e762f197de7be222f5cb0cc0beac1"><div class="ttname"><a href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">usb_connection_t::interface</a></div><div class="ttdeci">IOUSBInterfaceInterface190 ** interface</div><div class="ttdef"><b>Definition</b> darwinusb.c:145</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00119">accept_multiple_simultaneous_connections</a>, <a class="el" href="#l01551">accepts_device()</a>, <a class="el" href="#l00417">add_connection()</a>, <a class="el" href="#l00113">AUTO_READ_SIZE</a>, <a class="el" href="#l00162">usb_connection_t::auto_read_size</a>, <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l00151">usb_connection_t::dev_flags</a>, <a class="el" href="#l00146">usb_connection_t::device</a>, <a class="el" href="#l00455">device_already_in_use()</a>, <a class="el" href="#l01378">device_notification()</a>, <a class="el" href="#l00147">usb_connection_t::device_notification</a>, <a class="el" href="#l00154">usb_connection_t::device_present</a>, <a class="el" href="#l00992">find_interfaces()</a>, <a class="el" href="#l00156">usb_connection_t::in_pipe_ref</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00158">usb_connection_t::out_pipe_ref</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00170">usb_connection_t::read_queue_data_avail_cond</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, <a class="el" href="#l00143">usb_connection_t::ref_count</a>, <a class="el" href="#l00142">usb_connection_t::ref_count_mutex</a>, <a class="el" href="#l00106">ULOG</a>, <a class="el" href="#l00178">usb_connections</a>, <a class="el" href="#l00123">usb_notify_port</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00524">start_listening()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_cgraph.png" border="0" usemap="#adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_cgraph" alt=""/></div>
<map name="adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_cgraph" id="adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_cgraph">
<area shape="rect" title=" " alt="" coords="5,169,107,195"/>
<area shape="rect" href="darwinusb_8c.html#ab10d2c139ee0772df628b5e705368986" title=" " alt="" coords="175,20,288,45"/>
<area shape="poly" title=" " alt="" coords="62,167,96,113,122,82,153,54,160,50,163,55,156,59,126,85,100,116,66,170"/>
<area shape="rect" href="darwinusb_8c.html#ab97608baf2dc20e00693ea3d28b1c5fe" title=" " alt="" coords="175,69,288,95"/>
<area shape="poly" title=" " alt="" coords="69,167,105,136,153,104,164,99,166,103,156,108,109,140,72,171"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="172,118,291,144"/>
<area shape="poly" title=" " alt="" coords="102,166,169,146,171,151,104,171"/>
<area shape="rect" href="darwinusb_8c.html#a6378ac6f6b9262ad7cba19de626cd74b" title=" " alt="" coords="155,220,308,245"/>
<area shape="poly" title=" " alt="" coords="104,193,171,212,169,218,102,198"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="374,270,503,296"/>
<area shape="poly" title=" " alt="" coords="71,193,107,226,130,242,156,255,207,271,260,280,359,285,359,291,259,286,205,276,154,260,127,247,103,230,67,197"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="386,221,492,247"/>
<area shape="poly" title=" " alt="" coords="107,183,201,191,308,205,371,216,370,221,308,210,200,197,107,188"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="189,346,274,372"/>
<area shape="poly" title=" " alt="" coords="69,194,105,243,157,300,199,335,196,339,153,304,101,246,64,197"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="605,46,716,72"/>
<area shape="poly" title=" " alt="" coords="289,116,306,105,322,86,328,65,336,44,355,26,388,12,422,5,458,3,494,5,562,19,617,38,615,43,560,24,493,11,458,8,423,10,389,17,357,31,340,47,333,67,326,88,310,109,291,120"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="374,41,504,67"/>
<area shape="poly" title=" " alt="" coords="279,115,307,105,331,91,355,77,373,70,375,75,357,82,333,96,309,110,281,120"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="356,156,521,197"/>
<area shape="poly" title=" " alt="" coords="292,142,341,153,340,158,291,147"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="363,91,514,132"/>
<area shape="poly" title=" " alt="" coords="291,123,347,117,348,123,292,128"/>
<area shape="poly" title=" " alt="" coords="504,53,590,55,589,60,504,58"/>
<area shape="poly" title=" " alt="" coords="493,153,520,141,577,109,626,79,628,83,579,114,523,146,495,158"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="569,156,752,197"/>
<area shape="poly" title=" " alt="" coords="522,174,554,174,554,179,522,179"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="819,164,914,189"/>
<area shape="poly" title=" " alt="" coords="752,174,804,174,804,179,752,179"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="982,164,1072,189"/>
<area shape="poly" title=" " alt="" coords="915,174,966,174,966,179,915,179"/>
<area shape="poly" title=" " alt="" coords="514,91,589,73,591,78,515,96"/>
<area shape="poly" title=" " alt="" coords="515,113,627,123,752,142,811,156,809,162,751,147,627,129,515,118"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="602,321,719,347"/>
<area shape="poly" title=" " alt="" coords="499,294,587,315,586,320,498,299"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="800,345,934,371"/>
<area shape="poly" title=" " alt="" coords="720,338,785,346,784,351,719,343"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="816,296,918,321"/>
<area shape="poly" title=" " alt="" coords="719,324,800,314,801,319,720,329"/>
<area shape="poly" title=" " alt="" coords="491,218,564,199,565,204,492,223"/>
<area shape="poly" title=" " alt="" coords="492,230,611,223,751,206,810,192,811,197,752,211,612,229,492,235"/>
<area shape="poly" title=" " alt="" coords="274,354,586,336,587,341,274,359"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="380,372,497,397"/>
<area shape="poly" title=" " alt="" coords="275,369,365,382,365,387,274,375"/>
<area shape="poly" title=" " alt="" coords="496,369,586,348,587,353,498,374"/>
<area shape="poly" title=" " alt="" coords="390,374,289,361,290,356,391,369"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_icgraph.png" border="0" usemap="#adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_icgraph" id="adarwinusb_8c_ad2382b0d9c99eeded50fdcb6f448b92d_icgraph">
<area shape="rect" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a6378ac6f6b9262ad7cba19de626cd74b" name="a6378ac6f6b9262ad7cba19de626cd74b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6378ac6f6b9262ad7cba19de626cd74b">&#9670;&#160;</a></span>device_already_in_use()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int device_already_in_use </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>device</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  456</span>{</div>
<div class="line"><span class="lineno">  457</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *elem;</div>
<div class="line"><span class="lineno">  458</span>    pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  459</span>    elem = <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a>;</div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordflow">while</span> (elem != NULL &amp;&amp; elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a> != device)</div>
<div class="line"><span class="lineno">  461</span>        elem = elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  462</span>    pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  463</span>    <span class="keywordflow">return</span> elem != NULL;</div>
<div class="line"><span class="lineno">  464</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00146">usb_connection_t::device</a>, <a class="el" href="#l00138">usb_connection_t::next</a>, <a class="el" href="#l00178">usb_connections</a>, and <a class="el" href="#l00131">usb_connections_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a6378ac6f6b9262ad7cba19de626cd74b_icgraph.png" border="0" usemap="#adarwinusb_8c_a6378ac6f6b9262ad7cba19de626cd74b_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a6378ac6f6b9262ad7cba19de626cd74b_icgraph" id="adarwinusb_8c_a6378ac6f6b9262ad7cba19de626cd74b_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,2015,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a1760782cd564351de8fb058afe311e05" name="a1760782cd564351de8fb058afe311e05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1760782cd564351de8fb058afe311e05">&#9670;&#160;</a></span>device_notification()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void device_notification </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>connexion</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">io_service_t</td>          <td class="paramname"><span class="paramname"><em>service</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">natural_t</td>          <td class="paramname"><span class="paramname"><em>messageType</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>messageArgument</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1379</span>{</div>
<div class="line"><span class="lineno"> 1380</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: device_notification (c=%p messageType=0x%08lx)\n&quot;</span>, c, messageType));</div>
<div class="line"><span class="lineno"> 1381</span> </div>
<div class="line"><span class="lineno"> 1382</span>    <span class="keywordflow">if</span> (messageType == kIOMessageServiceIsTerminated &amp;&amp; c != NULL)</div>
<div class="line"><span class="lineno"> 1383</span>    {</div>
<div class="line"><span class="lineno"> 1384</span>        c-&gt;device_present = 0;</div>
<div class="line"><span class="lineno"> 1385</span>        c-&gt;opened = 0;      <span class="comment">/* so that stop_listening() does&#39;nt try to send the control_request */</span></div>
<div class="line"><span class="lineno"> 1386</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c,-1) &gt; 0)</div>
<div class="line"><span class="lineno"> 1387</span>        {</div>
<div class="line"><span class="lineno"> 1388</span>            <span class="comment">/* In case the reading thread is waiting for data,</span></div>
<div class="line"><span class="lineno"> 1389</span><span class="comment">             * we need to raise the usb_data_available cond once.</span></div>
<div class="line"><span class="lineno"> 1390</span><span class="comment">             * since darwin_usb_read tests usb.opened, it will</span></div>
<div class="line"><span class="lineno"> 1391</span><span class="comment">             * gracefully exit during a data wait.</span></div>
<div class="line"><span class="lineno"> 1392</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 1393</span>            <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: device_notification signaling c-&gt;read_queue_data_avail_cond for c=%p\n&quot;</span>,c));</div>
<div class="line"><span class="lineno"> 1394</span>            pthread_mutex_lock (&amp;c-&gt;read_queue_mutex);</div>
<div class="line"><span class="lineno"> 1395</span>            pthread_cond_signal (&amp;c-&gt;read_queue_data_avail_cond);</div>
<div class="line"><span class="lineno"> 1396</span>                pthread_mutex_unlock (&amp;c-&gt;read_queue_mutex);</div>
<div class="line"><span class="lineno"> 1397</span>        }</div>
<div class="line"><span class="lineno"> 1398</span>    }</div>
<div class="line"><span class="lineno"> 1399</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00154">usb_connection_t::device_present</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00170">usb_connection_t::read_queue_data_avail_cond</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, and <a class="el" href="#l00106">ULOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a1760782cd564351de8fb058afe311e05_cgraph.png" border="0" usemap="#adarwinusb_8c_a1760782cd564351de8fb058afe311e05_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a1760782cd564351de8fb058afe311e05_cgraph" id="adarwinusb_8c_a1760782cd564351de8fb058afe311e05_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,135,56"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="183,31,300,56"/>
<area shape="poly" title=" " alt="" coords="135,41,167,41,167,46,135,46"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="348,5,482,31"/>
<area shape="poly" title=" " alt="" coords="300,32,332,28,333,33,301,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="364,55,466,80"/>
<area shape="poly" title=" " alt="" coords="301,49,349,56,349,61,300,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a1760782cd564351de8fb058afe311e05_icgraph.png" border="0" usemap="#adarwinusb_8c_a1760782cd564351de8fb058afe311e05_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a1760782cd564351de8fb058afe311e05_icgraph" id="adarwinusb_8c_a1760782cd564351de8fb058afe311e05_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,1991,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="ad2b23562cd53b9fee904b9ad45ab2889" name="ad2b23562cd53b9fee904b9ad45ab2889"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2b23562cd53b9fee904b9ad45ab2889">&#9670;&#160;</a></span>find_interfaces()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn find_interfaces </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>usb</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>vendor</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>product</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>accept_flags</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>input_pipe_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>output_pipe_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>pipe_info_retrieved</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1001</span>{</div>
<div class="line"><span class="lineno"> 1002</span>    IOReturn kr;</div>
<div class="line"><span class="lineno"> 1003</span>    io_iterator_t iterator;</div>
<div class="line"><span class="lineno"> 1004</span>    io_service_t usbInterface;</div>
<div class="line"><span class="lineno"> 1005</span>    HRESULT res;</div>
<div class="line"><span class="lineno"> 1006</span>    SInt32 score;</div>
<div class="line"><span class="lineno"> 1007</span>    UInt8 intfClass, intfSubClass, intfNumEndpoints;</div>
<div class="line"><span class="lineno"> 1008</span>    <span class="keywordtype">int</span> pipeRef, pass;</div>
<div class="line"><span class="lineno"> 1009</span>    IOUSBFindInterfaceRequest request;</div>
<div class="line"><span class="lineno"> 1010</span>    IOCFPlugInInterface **plugInInterface = NULL;</div>
<div class="line"><span class="lineno"> 1011</span>    UInt8 direction, number, transferType, <a class="code hl_variable" href="socket_8c.html#a23545cd41cdc93998f5b3caeb3e29936">interval</a>;</div>
<div class="line"><span class="lineno"> 1012</span>    UInt16 maxPacketSize;</div>
<div class="line"><span class="lineno"> 1013</span> </div>
<div class="line"><span class="lineno"> 1014</span>    request.bInterfaceClass = kIOUSBFindInterfaceDontCare;</div>
<div class="line"><span class="lineno"> 1015</span>    request.bInterfaceSubClass = kIOUSBFindInterfaceDontCare;</div>
<div class="line"><span class="lineno"> 1016</span>    request.bInterfaceProtocol = kIOUSBFindInterfaceDontCare;</div>
<div class="line"><span class="lineno"> 1017</span>    request.bAlternateSetting = kIOUSBFindInterfaceDontCare;</div>
<div class="line"><span class="lineno"> 1018</span> </div>
<div class="line"><span class="lineno"> 1019</span>    kr = (*di)-&gt;CreateInterfaceIterator (di, &amp;request, &amp;iterator);</div>
<div class="line"><span class="lineno"> 1020</span> </div>
<div class="line"><span class="lineno"> 1021</span>    <span class="keywordflow">while</span> ((usbInterface = IOIteratorNext (iterator)))</div>
<div class="line"><span class="lineno"> 1022</span>    {</div>
<div class="line"><span class="lineno"> 1023</span>        kr = IOCreatePlugInInterfaceForService (usbInterface, kIOUSBInterfaceUserClientTypeID, kIOCFPlugInInterfaceID, &amp;plugInInterface, &amp;score);</div>
<div class="line"><span class="lineno"> 1024</span>        kr = IOObjectRelease (usbInterface);                <span class="comment">// done with the usbInterface object now that I have the plugin</span></div>
<div class="line"><span class="lineno"> 1025</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess || !plugInInterface)</div>
<div class="line"><span class="lineno"> 1026</span>        {</div>
<div class="line"><span class="lineno"> 1027</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to create a plugin (%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1028</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1029</span>        }</div>
<div class="line"><span class="lineno"> 1030</span> </div>
<div class="line"><span class="lineno"> 1031</span>        <span class="comment">/* we have the interface plugin: we now need the interface interface */</span></div>
<div class="line"><span class="lineno"> 1032</span>        res = (*plugInInterface)-&gt;QueryInterface (plugInInterface, CFUUIDGetUUIDBytes(kIOUSBInterfaceInterfaceID), (LPVOID *) &amp;c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1033</span>        (*plugInInterface)-&gt;Release (plugInInterface);          <span class="comment">/* done with this */</span></div>
<div class="line"><span class="lineno"> 1034</span>        <span class="keywordflow">if</span> (res || c-&gt;interface == NULL)</div>
<div class="line"><span class="lineno"> 1035</span>        {</div>
<div class="line"><span class="lineno"> 1036</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: couldn&#39;t create an IOUSBInterfaceInterface (%08x)\n&quot;</span>, (<span class="keywordtype">int</span>) res));</div>
<div class="line"><span class="lineno"> 1037</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1038</span>        }</div>
<div class="line"><span class="lineno"> 1039</span> </div>
<div class="line"><span class="lineno"> 1040</span>        <span class="comment">/* get the interface class and subclass */</span></div>
<div class="line"><span class="lineno"> 1041</span>        kr = (*c-&gt;interface)-&gt;GetInterfaceClass (c-&gt;interface, &amp;intfClass);</div>
<div class="line"><span class="lineno"> 1042</span>        kr = (*c-&gt;interface)-&gt;GetInterfaceSubClass (c-&gt;interface, &amp;intfSubClass);</div>
<div class="line"><span class="lineno"> 1043</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: interface class %d, subclass %d\n&quot;</span>, intfClass, intfSubClass));</div>
<div class="line"><span class="lineno"> 1044</span> </div>
<div class="line"><span class="lineno"> 1045</span>        <span class="comment">/* Now open the interface. This will cause the pipes to be instantiated that are</span></div>
<div class="line"><span class="lineno"> 1046</span><span class="comment">         * associated with the endpoints defined in the interface descriptor.</span></div>
<div class="line"><span class="lineno"> 1047</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 1048</span>        kr = (*c-&gt;interface)-&gt;USBInterfaceOpen (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1049</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1050</span>        {</div>
<div class="line"><span class="lineno"> 1051</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to open interface (%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1052</span>            (*c-&gt;interface)-&gt;Release (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1053</span>            c-&gt;interface = NULL;</div>
<div class="line"><span class="lineno"> 1054</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1055</span>        }</div>
<div class="line"><span class="lineno"> 1056</span> </div>
<div class="line"><span class="lineno"> 1057</span>        kr = (*c-&gt;interface)-&gt;GetNumEndpoints (c-&gt;interface, &amp;intfNumEndpoints);</div>
<div class="line"><span class="lineno"> 1058</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1059</span>        {</div>
<div class="line"><span class="lineno"> 1060</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to get number of endpoints (%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1061</span>            (*c-&gt;interface)-&gt;USBInterfaceClose (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1062</span>            (*c-&gt;interface)-&gt;Release (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1063</span>            c-&gt;interface = NULL;</div>
<div class="line"><span class="lineno"> 1064</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1065</span>        }</div>
<div class="line"><span class="lineno"> 1066</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: interface has %d endpoints\n&quot;</span>, intfNumEndpoints));</div>
<div class="line"><span class="lineno"> 1067</span> </div>
<div class="line"><span class="lineno"> 1068</span>        <span class="comment">/* If device didn&#39;t answer to the connection_information request,</span></div>
<div class="line"><span class="lineno"> 1069</span><span class="comment">         * try to read a preamble sent by the device. This is sent by devices which chipsets</span></div>
<div class="line"><span class="lineno"> 1070</span><span class="comment">         * don&#39;t support the vendor control endpoint requests. Look for the first pipe on</span></div>
<div class="line"><span class="lineno"> 1071</span><span class="comment">         * which a preamble is available.</span></div>
<div class="line"><span class="lineno"> 1072</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 1073</span>        <span class="keywordflow">if</span> (!pipe_info_retrieved)</div>
<div class="line"><span class="lineno"> 1074</span>        {</div>
<div class="line"><span class="lineno"> 1075</span>            <span class="keywordtype">int</span> reqTimeout;</div>
<div class="line"><span class="lineno"> 1076</span>            <span class="keywordtype">int</span> preambleFound = 0;</div>
<div class="line"><span class="lineno"> 1077</span>            <span class="keywordflow">for</span> (reqTimeout = 100; reqTimeout &lt;= 300 &amp;&amp; !preambleFound; reqTimeout += 100)</div>
<div class="line"><span class="lineno"> 1078</span>            {</div>
<div class="line"><span class="lineno"> 1079</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: checking for pipe_info sent by device with timeout %dms\n&quot;</span>,reqTimeout));</div>
<div class="line"><span class="lineno"> 1080</span>                <span class="keywordflow">for</span> (pipeRef = 1; pipeRef &lt;= intfNumEndpoints; pipeRef++)</div>
<div class="line"><span class="lineno"> 1081</span>                {</div>
<div class="line"><span class="lineno"> 1082</span>                    kr = (*c-&gt;interface)-&gt;GetPipeProperties (c-&gt;interface, pipeRef, &amp;direction, &amp;number,</div>
<div class="line"><span class="lineno"> 1083</span>                                          &amp;transferType, &amp;maxPacketSize, &amp;<a class="code hl_variable" href="socket_8c.html#a23545cd41cdc93998f5b3caeb3e29936">interval</a>);</div>
<div class="line"><span class="lineno"> 1084</span>                    <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1085</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1086</span>                    <span class="keywordflow">if</span> (direction == kUSBIn)</div>
<div class="line"><span class="lineno"> 1087</span>                    {</div>
<div class="line"><span class="lineno"> 1088</span>                        UInt32 <a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = <span class="keyword">sizeof</span>(c-&gt;read_buffer)-1;</div>
<div class="line"><span class="lineno"> 1089</span>                        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: trying pipe %d type=%d\n&quot;</span>, pipeRef, (<span class="keywordtype">int</span>)transferType));</div>
<div class="line"><span class="lineno"> 1090</span>                        <span class="keywordflow">if</span> (transferType == kUSBBulk)</div>
<div class="line"><span class="lineno"> 1091</span>                            kr = (*c-&gt;interface)-&gt;ReadPipeTO (c-&gt;interface, pipeRef, &amp;c-&gt;read_buffer, &amp;<a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, reqTimeout, 250);</div>
<div class="line"><span class="lineno"> 1092</span>                        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1093</span>                            kr = (*c-&gt;interface)-&gt;ReadPipe (c-&gt;interface, pipeRef, &amp;c-&gt;read_buffer, &amp;<a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div>
<div class="line"><span class="lineno"> 1094</span> </div>
<div class="line"><span class="lineno"> 1095</span>                        <span class="keywordflow">if</span> (kr == kIOReturnSuccess &amp;&amp; <a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &gt;= 8)</div>
<div class="line"><span class="lineno"> 1096</span>                        {</div>
<div class="line"><span class="lineno"> 1097</span>                            <span class="comment">/* got something! */</span></div>
<div class="line"><span class="lineno"> 1098</span>                            LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: got %d bytes there!\n&quot;</span>, (<span class="keywordtype">int</span>)<a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>));</div>
<div class="line"><span class="lineno"> 1099</span>                            CHECK(PI_DBG_DEV, PI_DBG_LVL_DEBUG, <a class="code hl_function" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9">pi_dumpdata</a>(c-&gt;read_buffer, <a class="code hl_variable" href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>));</div>
<div class="line"><span class="lineno"> 1100</span>                            <span class="keywordflow">if</span> (!memcmp(c-&gt;read_buffer, <span class="stringliteral">&quot;VNDR10&quot;</span>, 6))</div>
<div class="line"><span class="lineno"> 1101</span>                            {</div>
<div class="line"><span class="lineno"> 1102</span>                                <span class="comment">/* VNDR version 1.0 */</span></div>
<div class="line"><span class="lineno"> 1103</span>                                <a class="code hl_struct" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a> ci;</div>
<div class="line"><span class="lineno"> 1104</span>                                memcpy(&amp;ci, &amp;c-&gt;read_buffer[6], <span class="keyword">sizeof</span>(ci));</div>
<div class="line"><span class="lineno"> 1105</span>                                <a class="code hl_function" href="#a0cc85622030ec13870fc90026ace908b">decode_generic_connection_information</a>(&amp;ci, &amp;port_number, &amp;input_pipe_number, &amp;output_pipe_number);</div>
<div class="line"><span class="lineno"> 1106</span>                                preambleFound = 1;</div>
<div class="line"><span class="lineno"> 1107</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1108</span>                            }</div>
<div class="line"><span class="lineno"> 1109</span>                        }</div>
<div class="line"><span class="lineno"> 1110</span>                    }</div>
<div class="line"><span class="lineno"> 1111</span>                }</div>
<div class="line"><span class="lineno"> 1112</span>            }</div>
<div class="line"><span class="lineno"> 1113</span>        }</div>
<div class="line"><span class="lineno"> 1114</span> </div>
<div class="line"><span class="lineno"> 1115</span>        <span class="comment">/* Locate the pipes we&#39;re going to use for reading and writing.</span></div>
<div class="line"><span class="lineno"> 1116</span><span class="comment">         * We have four chances to find the right pipes:</span></div>
<div class="line"><span class="lineno"> 1117</span><span class="comment">         * 1. If we got a hint from the device with input/output pipes, we try this one first.</span></div>
<div class="line"><span class="lineno"> 1118</span><span class="comment">         * 2. If we didn&#39;t get both pipes, try using the port number hint. There is at least one recent</span></div>
<div class="line"><span class="lineno"> 1119</span><span class="comment">         *    device (LifeDrive) on which the port_number hint is actually an endpoint pair index.</span></div>
<div class="line"><span class="lineno"> 1120</span><span class="comment">         *    The code below tries to cope with that.</span></div>
<div class="line"><span class="lineno"> 1121</span><span class="comment">         * 3. If we&#39;re still missing one or two pipes, give a second try looking for pipes with a</span></div>
<div class="line"><span class="lineno"> 1122</span><span class="comment">         *    64 bytes transfer size</span></div>
<div class="line"><span class="lineno"> 1123</span><span class="comment">         * 4. Finally of this failed, forget about the transfer size and take the first ones that</span></div>
<div class="line"><span class="lineno"> 1124</span><span class="comment">         *    come (i.e. Tungsten W has a 64 bytes IN pipe and a 32 bytes OUT pipe).</span></div>
<div class="line"><span class="lineno"> 1125</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 1126</span>        <span class="keywordflow">for</span> (pass=1; pass &lt;= 4 &amp;&amp; (c-&gt;in_pipe_ref==0 || c-&gt;out_pipe_ref==0); pass++)</div>
<div class="line"><span class="lineno"> 1127</span>        {</div>
<div class="line"><span class="lineno"> 1128</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: pass %d looking for pipes, port_number=0x%02x, input_pipe_number=0x%02x, output_pipe_number=0x%02x\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1129</span>                pass, port_number, input_pipe_number, output_pipe_number));</div>
<div class="line"><span class="lineno"> 1130</span>            c-&gt;in_pipe_ref = 0;</div>
<div class="line"><span class="lineno"> 1131</span>            c-&gt;out_pipe_ref = 0;</div>
<div class="line"><span class="lineno"> 1132</span> </div>
<div class="line"><span class="lineno"> 1133</span>            <span class="keywordtype">int</span> input_pipes_seen = 0;</div>
<div class="line"><span class="lineno"> 1134</span>            <span class="keywordtype">int</span> output_pipes_seen = 0;</div>
<div class="line"><span class="lineno"> 1135</span>            </div>
<div class="line"><span class="lineno"> 1136</span>            <span class="keywordflow">for</span> (pipeRef = 1; pipeRef &lt;= intfNumEndpoints; pipeRef++)</div>
<div class="line"><span class="lineno"> 1137</span>            {</div>
<div class="line"><span class="lineno"> 1138</span>                kr = (*c-&gt;interface)-&gt;GetPipeProperties (c-&gt;interface, pipeRef, &amp;direction, &amp;number,</div>
<div class="line"><span class="lineno"> 1139</span>                                      &amp;transferType, &amp;maxPacketSize, &amp;<a class="code hl_variable" href="socket_8c.html#a23545cd41cdc93998f5b3caeb3e29936">interval</a>);</div>
<div class="line"><span class="lineno"> 1140</span>                <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1141</span>                {</div>
<div class="line"><span class="lineno"> 1142</span>                    LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: unable to get properties of pipe %d (kr=0x%08x)\n&quot;</span>, pipeRef, kr));</div>
<div class="line"><span class="lineno"> 1143</span>                }</div>
<div class="line"><span class="lineno"> 1144</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1145</span>                {</div>
<div class="line"><span class="lineno"> 1146</span>                    <span class="keywordtype">int</span> pair_index = (direction == kUSBIn) ? ++input_pipes_seen : ++output_pipes_seen;</div>
<div class="line"><span class="lineno"> 1147</span>                    </div>
<div class="line"><span class="lineno"> 1148</span>                    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG,</div>
<div class="line"><span class="lineno"> 1149</span>                        <span class="stringliteral">&quot;darwinusb: pipe %d: direction=0x%02x, number=0x%02x, transferType=0x%02x, maxPacketSize=%d, interval=0x%02x, pair_index=%d\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1150</span>                        pipeRef,(<span class="keywordtype">int</span>)direction,(<span class="keywordtype">int</span>)number,(<span class="keywordtype">int</span>)transferType,(<span class="keywordtype">int</span>)maxPacketSize,(<span class="keywordtype">int</span>)<a class="code hl_variable" href="socket_8c.html#a23545cd41cdc93998f5b3caeb3e29936">interval</a>,pair_index));</div>
<div class="line"><span class="lineno"> 1151</span>                    <span class="keywordflow">if</span> (c-&gt;in_pipe_ref == 0 &amp;&amp;</div>
<div class="line"><span class="lineno"> 1152</span>                        direction == kUSBIn &amp;&amp;</div>
<div class="line"><span class="lineno"> 1153</span>                        transferType == kUSBBulk)</div>
<div class="line"><span class="lineno"> 1154</span>                    {</div>
<div class="line"><span class="lineno"> 1155</span>                        <span class="keywordflow">if</span> ((pass == 1 &amp;&amp; input_pipe_number != 0xff &amp;&amp; number == input_pipe_number) ||</div>
<div class="line"><span class="lineno"> 1156</span>                            (pass == 1 &amp;&amp; port_number == 0xff &amp;&amp; input_pipe_number == 0xff &amp;&amp; (accept_flags &amp; <a class="code hl_define" href="#aa9b65d1aae65a8421de1524846821b5c">FLAG_USE_FIRST_PAIR</a>)) ||</div>
<div class="line"><span class="lineno"> 1157</span>                            (pass == 2 &amp;&amp; port_number != 0xff &amp;&amp; number == port_number) ||</div>
<div class="line"><span class="lineno"> 1158</span>                            (pass == 3 &amp;&amp; ((port_number != 0xff &amp;&amp; pair_index == port_number) || (port_number == 0xff &amp;&amp; (maxPacketSize == 64 || maxPacketSize == 512)))) ||</div>
<div class="line"><span class="lineno"> 1159</span>                             pass == 4)</div>
<div class="line"><span class="lineno"> 1160</span>                            c-&gt;in_pipe_ref = pipeRef;</div>
<div class="line"><span class="lineno"> 1161</span>                            c-&gt;in_pipe_bulk_size = maxPacketSize;</div>
<div class="line"><span class="lineno"> 1162</span>                    }</div>
<div class="line"><span class="lineno"> 1163</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;out_pipe_ref == 0 &amp;&amp;</div>
<div class="line"><span class="lineno"> 1164</span>                             direction == kUSBOut &amp;&amp;</div>
<div class="line"><span class="lineno"> 1165</span>                             transferType == kUSBBulk)</div>
<div class="line"><span class="lineno"> 1166</span>                    {</div>
<div class="line"><span class="lineno"> 1167</span>                        <span class="keywordflow">if</span> ((pass == 1 &amp;&amp; output_pipe_number != 0xff &amp;&amp; number == output_pipe_number) ||</div>
<div class="line"><span class="lineno"> 1168</span>                            (pass == 1 &amp;&amp; port_number == 0xff &amp;&amp; input_pipe_number == 0xff &amp;&amp; (accept_flags &amp; <a class="code hl_define" href="#aa9b65d1aae65a8421de1524846821b5c">FLAG_USE_FIRST_PAIR</a>)) ||</div>
<div class="line"><span class="lineno"> 1169</span>                            (pass == 2 &amp;&amp; port_number != 0xff &amp;&amp; number == port_number) ||</div>
<div class="line"><span class="lineno"> 1170</span>                            (pass == 3 &amp;&amp; ((port_number != 0xff &amp;&amp; pair_index == port_number) || (port_number == 0xff &amp;&amp; (maxPacketSize == 64 || maxPacketSize == 512)))) ||</div>
<div class="line"><span class="lineno"> 1171</span>                             pass == 4)</div>
<div class="line"><span class="lineno"> 1172</span>                        {</div>
<div class="line"><span class="lineno"> 1173</span>                            c-&gt;out_pipe_ref = pipeRef;</div>
<div class="line"><span class="lineno"> 1174</span>                            c-&gt;out_pipe_bulk_size = maxPacketSize;</div>
<div class="line"><span class="lineno"> 1175</span>                        }</div>
<div class="line"><span class="lineno"> 1176</span>                    }</div>
<div class="line"><span class="lineno"> 1177</span>                }</div>
<div class="line"><span class="lineno"> 1178</span>            }</div>
<div class="line"><span class="lineno"> 1179</span>        }</div>
<div class="line"><span class="lineno"> 1180</span> </div>
<div class="line"><span class="lineno"> 1181</span>        <span class="keywordflow">if</span> (c-&gt;in_pipe_ref &amp;&amp; c-&gt;out_pipe_ref)</div>
<div class="line"><span class="lineno"> 1182</span>            <span class="keywordflow">return</span> kIOReturnSuccess;</div>
<div class="line"><span class="lineno"> 1183</span> </div>
<div class="line"><span class="lineno"> 1184</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: couldn&#39;t find any suitable pipes pair on this interface\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1185</span>        (*c-&gt;interface)-&gt;USBInterfaceClose (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1186</span>        (*c-&gt;interface)-&gt;Release (c-&gt;interface);</div>
<div class="line"><span class="lineno"> 1187</span>        c-&gt;interface = NULL;</div>
<div class="line"><span class="lineno"> 1188</span>        c-&gt;in_pipe_ref = 0;</div>
<div class="line"><span class="lineno"> 1189</span>        c-&gt;out_pipe_ref = 0;</div>
<div class="line"><span class="lineno"> 1190</span>    }</div>
<div class="line"><span class="lineno"> 1191</span> </div>
<div class="line"><span class="lineno"> 1192</span>    <span class="keywordflow">return</span> c-&gt;interface==NULL ? -1 : kIOReturnSuccess;</div>
<div class="line"><span class="lineno"> 1193</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a0cc85622030ec13870fc90026ace908b"><div class="ttname"><a href="#a0cc85622030ec13870fc90026ace908b">decode_generic_connection_information</a></div><div class="ttdeci">static IOReturn decode_generic_connection_information(palm_ext_connection_info *ci, int *port_number, int *input_pipe, int *output_pipe)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1279</div></div>
<div class="ttc" id="asocket_8c_html_a23545cd41cdc93998f5b3caeb3e29936"><div class="ttname"><a href="socket_8c.html#a23545cd41cdc93998f5b3caeb3e29936">interval</a></div><div class="ttdeci">static unsigned int interval</div><div class="ttdef"><b>Definition</b> socket.c:90</div></div>
<div class="ttc" id="avalidate_8cc_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="validate_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition</b> validate.cc:81</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01279">decode_generic_connection_information()</a>, <a class="el" href="#l00303">FLAG_USE_FIRST_PAIR</a>, <a class="el" href="#l00157">usb_connection_t::in_pipe_bulk_size</a>, <a class="el" href="#l00156">usb_connection_t::in_pipe_ref</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00090">interval</a>, <a class="el" href="#l00159">usb_connection_t::out_pipe_bulk_size</a>, <a class="el" href="#l00158">usb_connection_t::out_pipe_ref</a>, <a class="el" href="#l00222">pi_dumpdata()</a>, <a class="el" href="#l00175">usb_connection_t::read_buffer</a>, and <a class="el" href="#l00081">size</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_cgraph.png" border="0" usemap="#adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_cgraph" alt=""/></div>
<map name="adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_cgraph" id="adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_cgraph">
<area shape="rect" title=" " alt="" coords="5,42,112,68"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="160,5,342,46"/>
<area shape="poly" title=" " alt="" coords="112,44,144,39,144,45,113,50"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="390,42,485,68"/>
<area shape="poly" title=" " alt="" coords="112,54,160,55,342,55,375,54,375,60,342,60,160,60,112,59"/>
<area shape="poly" title=" " alt="" coords="343,37,375,43,374,48,342,43"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="533,42,624,68"/>
<area shape="poly" title=" " alt="" coords="486,52,518,52,518,58,486,58"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_icgraph.png" border="0" usemap="#adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_icgraph" id="adarwinusb_8c_ad2b23562cd53b9fee904b9ad45ab2889_icgraph">
<area shape="rect" title=" " alt="" coords="1861,242,1968,268"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a75b8e770479707f2ca65619e5e15248b" name="a75b8e770479707f2ca65619e5e15248b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75b8e770479707f2ca65619e5e15248b">&#9670;&#160;</a></span>klsi_set_portspeed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn klsi_set_portspeed </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>speed</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1343</span>{</div>
<div class="line"><span class="lineno"> 1344</span>    <span class="comment">/* set the comms speed for a KLSI serial adapter (PalmConnect USB) */</span></div>
<div class="line"><span class="lineno"> 1345</span>    kern_return_t kr;</div>
<div class="line"><span class="lineno"> 1346</span>    <a class="code hl_struct" href="structklsi__port__settings.html">klsi_port_settings</a> settings = {5, <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee">KLSI_BAUD_9600</a>, 8, <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a8863fcb9d84604cda7e117867913e0ca">KLSI_PARITY_NONE</a>, <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04ab8b0ef7f93ef78624ee9d66d49e22a00">KLSI_STOPBITS_0</a>};</div>
<div class="line"><span class="lineno"> 1347</span>    <span class="keywordflow">switch</span> (speed)</div>
<div class="line"><span class="lineno"> 1348</span>    {</div>
<div class="line"><span class="lineno"> 1349</span>        <span class="keywordflow">case</span> 230400:    settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1e3e23a464c54cce5310290d7f29456a">KLSI_BAUD_230400</a>;  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1350</span>        <span class="keywordflow">case</span> 115200:    settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a076ec32aea4c2e01539fc73558a15891">KLSI_BAUD_115200</a>;  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1351</span>        <span class="keywordflow">case</span> 57600: settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a18fed32dda949048d957fc0f49e04440">KLSI_BAUD_57600</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1352</span>        <span class="keywordflow">case</span> 38400: settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a1b6f7d66fc4e1efd6781c432d5f9dcd8">KLSI_BAUD_38400</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1353</span>        <span class="keywordflow">case</span> 28800: settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a328e2127669a58ff4e112bbb3ab864cb">KLSI_BAUD_28800</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1354</span>        <span class="keywordflow">case</span> 19200: settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a40f6269bd4d99d19b800de585f9f6cfc">KLSI_BAUD_19200</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1355</span>        <span class="keywordflow">case</span> 14400: settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a2b6787a1da4c068b034a4e856a43fa7b">KLSI_BAUD_14400</a>;   <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1356</span>        <span class="keywordflow">case</span> 9600:  settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a4c1432264650cf58dd2014c67ee3b3ee">KLSI_BAUD_9600</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1357</span>        <span class="keywordflow">case</span> 7200:  settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a36ec211a4e0312f9dfd407d63ecea6f1">KLSI_BAUD_7200</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1358</span>        <span class="keywordflow">case</span> 4800:  settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a2bdfc73ce92385ec82cffd38bfdaff5f">KLSI_BAUD_4800</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1359</span>        <span class="keywordflow">case</span> 2400:  settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a16e3dfefa720d7220b15c12d5add78f1">KLSI_BAUD_2400</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1360</span>        <span class="keywordflow">case</span> 1200:  settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04af61b788b19f464cb32a31cc81281e84a">KLSI_BAUD_1200</a>;    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1361</span>        <span class="keywordflow">case</span> 600:   settings.BaudRateIndex = <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a32e07540a17f4f7807975c081e21590a">KLSI_BAUD_600</a>;     <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1362</span>        <span class="keywordflow">default</span>:                            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1363</span>    }</div>
<div class="line"><span class="lineno"> 1364</span> </div>
<div class="line"><span class="lineno"> 1365</span>    kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a>(dev, 0x40, <a class="code hl_define" href="#a35995b1ba5040d5eca3ae5dd04224e32">KLSI_SET_COMM_DESCRIPTOR</a>, 0, 0, &amp;settings, 5);</div>
<div class="line"><span class="lineno"> 1366</span>    <span class="keywordflow">if</span> (kr == kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1367</span>    {</div>
<div class="line"><span class="lineno"> 1368</span>        kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a>(dev, 0x40, <a class="code hl_define" href="#a35995b1ba5040d5eca3ae5dd04224e32">KLSI_SET_COMM_DESCRIPTOR</a>, 0, 0, &amp;settings, 5);</div>
<div class="line"><span class="lineno"> 1369</span>        <span class="keywordflow">if</span> (kr == kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1370</span>            kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a>(dev, 0x40, <a class="code hl_define" href="#aa26baa08ed15a296e2778f7a543970ca">KLSI_SET_FLOWCONTROL</a>, (speed &gt; 9600) ? <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a32850f550b684286e88c6fdc2fb78cd4">KLSI_FLOW_USE_RTS</a> : 0, 0, NULL, 0);</div>
<div class="line"><span class="lineno"> 1371</span> </div>
<div class="line"><span class="lineno"> 1372</span>        <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a>(dev, 0x40, <a class="code hl_define" href="#ab8c8d9b723564b59e131f14ca660a6ef">KLSI_SET_HANDSHAKE_LINES</a>, <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a660bd7f0609bab7dcf9a493837037c34">KLSI_SETHS_DTR</a> | <a class="code hl_enumvalue" href="#abc6126af1d45847bc59afa0aa3216b04a25dbd1bfba15ccb0f5c82c93ccf3f3b2">KLSI_SETHS_RTS</a>, 0, NULL, 0);</div>
<div class="line"><span class="lineno"> 1373</span>    }</div>
<div class="line"><span class="lineno"> 1374</span>    <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno"> 1375</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a35995b1ba5040d5eca3ae5dd04224e32"><div class="ttname"><a href="#a35995b1ba5040d5eca3ae5dd04224e32">KLSI_SET_COMM_DESCRIPTOR</a></div><div class="ttdeci">#define KLSI_SET_COMM_DESCRIPTOR</div><div class="ttdef"><b>Definition</b> darwinusb.c:271</div></div>
<div class="ttc" id="adarwinusb_8c_html_aa26baa08ed15a296e2778f7a543970ca"><div class="ttname"><a href="#aa26baa08ed15a296e2778f7a543970ca">KLSI_SET_FLOWCONTROL</a></div><div class="ttdeci">#define KLSI_SET_FLOWCONTROL</div><div class="ttdef"><b>Definition</b> darwinusb.c:275</div></div>
<div class="ttc" id="adarwinusb_8c_html_ab8c8d9b723564b59e131f14ca660a6ef"><div class="ttname"><a href="#ab8c8d9b723564b59e131f14ca660a6ef">KLSI_SET_HANDSHAKE_LINES</a></div><div class="ttdeci">#define KLSI_SET_HANDSHAKE_LINES</div><div class="ttdef"><b>Definition</b> darwinusb.c:273</div></div>
<div class="ttc" id="astructklsi__port__settings_html"><div class="ttname"><a href="structklsi__port__settings.html">klsi_port_settings</a></div><div class="ttdef"><b>Definition</b> darwinusb.c:278</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01196">control_request()</a>, <a class="el" href="#l00232">KLSI_BAUD_115200</a>, <a class="el" href="#l00242">KLSI_BAUD_1200</a>, <a class="el" href="#l00237">KLSI_BAUD_14400</a>, <a class="el" href="#l00236">KLSI_BAUD_19200</a>, <a class="el" href="#l00244">KLSI_BAUD_230400</a>, <a class="el" href="#l00241">KLSI_BAUD_2400</a>, <a class="el" href="#l00235">KLSI_BAUD_28800</a>, <a class="el" href="#l00234">KLSI_BAUD_38400</a>, <a class="el" href="#l00240">KLSI_BAUD_4800</a>, <a class="el" href="#l00233">KLSI_BAUD_57600</a>, <a class="el" href="#l00243">KLSI_BAUD_600</a>, <a class="el" href="#l00239">KLSI_BAUD_7200</a>, <a class="el" href="#l00238">KLSI_BAUD_9600</a>, <a class="el" href="#l00265">KLSI_FLOW_USE_RTS</a>, <a class="el" href="#l00246">KLSI_PARITY_NONE</a>, <a class="el" href="#l00271">KLSI_SET_COMM_DESCRIPTOR</a>, <a class="el" href="#l00275">KLSI_SET_FLOWCONTROL</a>, <a class="el" href="#l00273">KLSI_SET_HANDSHAKE_LINES</a>, <a class="el" href="#l00262">KLSI_SETHS_DTR</a>, <a class="el" href="#l00261">KLSI_SETHS_RTS</a>, and <a class="el" href="#l00251">KLSI_STOPBITS_0</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l01930">u_changebaud()</a>, and <a class="el" href="#l01642">u_wait_for_device()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a75b8e770479707f2ca65619e5e15248b_cgraph.png" border="0" usemap="#adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_cgraph" id="adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,136,31"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="184,5,294,31"/>
<area shape="poly" title=" " alt="" coords="136,16,168,16,168,21,136,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a75b8e770479707f2ca65619e5e15248b_icgraph.png" border="0" usemap="#adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_icgraph" id="adarwinusb_8c_a75b8e770479707f2ca65619e5e15248b_icgraph">
<area shape="rect" title=" " alt="" coords="2057,242,2187,268"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="1889,192,2009,217"/>
<area shape="poly" title=" " alt="" coords="2060,240,1994,220,1996,215,2062,235"/>
<area shape="rect" href="darwinusb_8c.html#a18148cdc8c3dbba549e8a762a791bc0e" title=" " alt="" coords="1562,242,1667,268"/>
<area shape="poly" title=" " alt="" coords="2041,258,1668,258,1668,252,2041,252"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1715,293,1841,318"/>
<area shape="poly" title=" " alt="" coords="2042,271,2009,276,1842,300,1841,295,2008,271,2041,266"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1728,192,1829,217"/>
<area shape="poly" title=" " alt="" coords="1874,207,1829,207,1829,202,1874,202"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1563,192,1666,217"/>
<area shape="poly" title=" " alt="" coords="1712,207,1666,207,1666,202,1712,202"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,192,1514,217"/>
<area shape="poly" title=" " alt="" coords="1548,207,1514,207,1514,202,1548,202"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,192,1355,217"/>
<area shape="poly" title=" " alt="" coords="1388,207,1356,207,1356,202,1388,202"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1278,224,1224,244,1223,239,1277,219"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="1546,258,1245,258,1245,252,1546,252"/>
<area shape="poly" title=" " alt="" coords="1699,302,1244,262,1245,257,1699,296"/>
</map>
</div>

</div>
</div>
<a id="a21b4c9d5b57f1d4a8f6b08b170b1d29f" name="a21b4c9d5b57f1d4a8f6b08b170b1d29f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21b4c9d5b57f1d4a8f6b08b170b1d29f">&#9670;&#160;</a></span>pi_usb_impl_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pi_usb_impl_init </td>
          <td>(</td>
          <td class="paramtype">struct pi_usb_impl *</td>          <td class="paramname"><span class="paramname"><em>impl</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1951</span>{</div>
<div class="line"><span class="lineno"> 1952</span>    impl-&gt;open      = <a class="code hl_function" href="#aad2542bd9cbedf6534bc2443fea26657">u_open</a>;</div>
<div class="line"><span class="lineno"> 1953</span>    impl-&gt;close     = <a class="code hl_function" href="#ad04208dd4d06c0f62d2ba47da8269257">u_close</a>;</div>
<div class="line"><span class="lineno"> 1954</span>    impl-&gt;write     = <a class="code hl_function" href="#a62be9dca709b9fa802954d73d21ab332">u_write</a>;</div>
<div class="line"><span class="lineno"> 1955</span>    impl-&gt;read      = <a class="code hl_function" href="#a8c4b6061f971ce2de3b2f581a87f3751">u_read</a>;</div>
<div class="line"><span class="lineno"> 1956</span>    impl-&gt;flush     = <a class="code hl_function" href="#ab042613c0c2ec32c60dbc9b0c5f03b75">u_flush</a>;</div>
<div class="line"><span class="lineno"> 1957</span>    impl-&gt;poll      = <a class="code hl_function" href="#a20220d60460da3af89e8e25bec84a595">u_poll</a>;</div>
<div class="line"><span class="lineno"> 1958</span>    impl-&gt;wait_for_device   = <a class="code hl_function" href="#a392c406126a2b42d4c9279a1664111ef">u_wait_for_device</a>;</div>
<div class="line"><span class="lineno"> 1959</span>    impl-&gt;changebaud    = <a class="code hl_function" href="#a18148cdc8c3dbba549e8a762a791bc0e">u_changebaud</a>;</div>
<div class="line"><span class="lineno"> 1960</span>    impl-&gt;control_request   = NULL;   <span class="comment">/* that is, until we factor out common code */</span></div>
<div class="line"><span class="lineno"> 1961</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a18148cdc8c3dbba549e8a762a791bc0e"><div class="ttname"><a href="#a18148cdc8c3dbba549e8a762a791bc0e">u_changebaud</a></div><div class="ttdeci">static int u_changebaud(pi_socket_t *ps)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1930</div></div>
<div class="ttc" id="adarwinusb_8c_html_a20220d60460da3af89e8e25bec84a595"><div class="ttname"><a href="#a20220d60460da3af89e8e25bec84a595">u_poll</a></div><div class="ttdeci">static int u_poll(struct pi_socket *ps, int timeout)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1695</div></div>
<div class="ttc" id="adarwinusb_8c_html_a392c406126a2b42d4c9279a1664111ef"><div class="ttname"><a href="#a392c406126a2b42d4c9279a1664111ef">u_wait_for_device</a></div><div class="ttdeci">static int u_wait_for_device(struct pi_socket *ps, int *timeout)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1642</div></div>
<div class="ttc" id="adarwinusb_8c_html_a62be9dca709b9fa802954d73d21ab332"><div class="ttname"><a href="#a62be9dca709b9fa802954d73d21ab332">u_write</a></div><div class="ttdeci">static ssize_t u_write(struct pi_socket *ps, const unsigned char *buf, size_t len, int flags)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1742</div></div>
<div class="ttc" id="adarwinusb_8c_html_a8c4b6061f971ce2de3b2f581a87f3751"><div class="ttname"><a href="#a8c4b6061f971ce2de3b2f581a87f3751">u_read</a></div><div class="ttdeci">static ssize_t u_read(struct pi_socket *ps, pi_buffer_t *buf, size_t len, int flags)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1808</div></div>
<div class="ttc" id="adarwinusb_8c_html_aad2542bd9cbedf6534bc2443fea26657"><div class="ttname"><a href="#aad2542bd9cbedf6534bc2443fea26657">u_open</a></div><div class="ttdeci">static int u_open(struct pi_socket *ps, struct pi_sockaddr *addr, size_t addrlen)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1599</div></div>
<div class="ttc" id="adarwinusb_8c_html_ab042613c0c2ec32c60dbc9b0c5f03b75"><div class="ttname"><a href="#ab042613c0c2ec32c60dbc9b0c5f03b75">u_flush</a></div><div class="ttdeci">static int u_flush(pi_socket_t *ps, int flags)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1578</div></div>
<div class="ttc" id="adarwinusb_8c_html_ad04208dd4d06c0f62d2ba47da8269257"><div class="ttname"><a href="#ad04208dd4d06c0f62d2ba47da8269257">u_close</a></div><div class="ttdeci">static int u_close(struct pi_socket *ps)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1621</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01930">u_changebaud()</a>, <a class="el" href="#l01621">u_close()</a>, <a class="el" href="#l01578">u_flush()</a>, <a class="el" href="#l01599">u_open()</a>, <a class="el" href="#l01695">u_poll()</a>, <a class="el" href="#l01808">u_read()</a>, <a class="el" href="#l01642">u_wait_for_device()</a>, and <a class="el" href="#l01742">u_write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00203">pi_usb_device()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_cgraph.png" border="0" usemap="#adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_cgraph" id="adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_cgraph">
<area shape="rect" title=" " alt="" coords="5,651,120,677"/>
<area shape="rect" href="darwinusb_8c.html#a18148cdc8c3dbba549e8a762a791bc0e" title=" " alt="" coords="168,234,273,260"/>
<area shape="poly" title=" " alt="" coords="66,650,206,273,211,275,71,652"/>
<area shape="rect" href="darwinusb_8c.html#ad04208dd4d06c0f62d2ba47da8269257" title=" " alt="" coords="515,626,581,652"/>
<area shape="poly" title=" " alt="" coords="120,658,499,638,499,644,120,664"/>
<area shape="rect" href="darwinusb_8c.html#ab042613c0c2ec32c60dbc9b0c5f03b75" title=" " alt="" coords="350,676,413,702"/>
<area shape="poly" title=" " alt="" coords="121,666,334,683,334,688,120,671"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="189,524,252,550"/>
<area shape="poly" title=" " alt="" coords="75,649,114,611,166,567,181,557,184,561,169,571,118,615,78,653"/>
<area shape="rect" href="darwinusb_8c.html#a20220d60460da3af89e8e25bec84a595" title=" " alt="" coords="871,727,926,753"/>
<area shape="poly" title=" " alt="" coords="98,675,151,694,221,714,299,731,380,737,549,737,856,737,856,743,549,743,380,743,299,736,219,719,149,699,96,680"/>
<area shape="rect" href="darwinusb_8c.html#a8c4b6061f971ce2de3b2f581a87f3751" title=" " alt="" coords="190,978,250,1004"/>
<area shape="poly" title=" " alt="" coords="73,676,209,963,204,965,68,678"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="836,575,962,601"/>
<area shape="poly" title=" " alt="" coords="96,648,149,629,219,609,299,592,380,585,549,585,820,585,820,591,549,591,380,591,299,597,221,614,151,634,98,653"/>
<area shape="rect" href="darwinusb_8c.html#a62be9dca709b9fa802954d73d21ab332" title=" " alt="" coords="189,827,252,853"/>
<area shape="poly" title=" " alt="" coords="77,675,199,813,195,817,73,679"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="1041,94,1171,120"/>
<area shape="poly" title=" " alt="" coords="228,232,270,175,302,137,341,98,386,62,436,31,489,10,546,3,716,3,765,5,814,11,910,33,996,60,1062,85,1060,90,994,65,909,38,813,17,764,10,716,8,547,8,491,16,438,36,389,66,345,102,306,141,274,178,232,235"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="1273,147,1383,173"/>
<area shape="poly" title=" " alt="" coords="1163,118,1258,141,1257,146,1162,123"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="1269,651,1386,677"/>
<area shape="poly" title=" " alt="" coords="582,637,1254,659,1253,664,582,642"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="1467,651,1601,677"/>
<area shape="poly" title=" " alt="" coords="1387,661,1452,661,1452,667,1387,667"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="1484,131,1585,157"/>
<area shape="poly" title=" " alt="" coords="1330,650,1377,488,1416,371,1465,254,1489,208,1513,169,1517,172,1493,211,1469,256,1421,373,1382,490,1335,651"/>
<area shape="poly" title=" " alt="" coords="413,688,665,700,1023,712,1107,717,1142,718,1188,712,1238,699,1284,681,1286,686,1240,704,1189,717,1143,723,1106,723,1023,717,665,706,413,694"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="336,827,426,853"/>
<area shape="poly" title=" " alt="" coords="231,549,368,812,364,815,226,552"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="326,328,436,354"/>
<area shape="poly" title=" " alt="" coords="230,522,358,364,362,368,235,526"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="495,827,601,853"/>
<area shape="poly" title=" " alt="" coords="426,837,480,837,480,843,426,843"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="662,778,767,804"/>
<area shape="poly" title=" " alt="" coords="593,824,653,806,654,811,595,829"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="655,827,774,853"/>
<area shape="poly" title=" " alt="" coords="601,837,639,837,639,843,601,843"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="671,876,758,902"/>
<area shape="poly" title=" " alt="" coords="595,851,657,870,655,875,593,856"/>
<area shape="poly" title=" " alt="" coords="387,327,427,260,458,215,497,169,543,125,594,88,651,63,681,56,713,53,1107,53,1212,61,1316,79,1408,102,1481,123,1479,128,1407,107,1315,84,1212,66,1107,59,713,59,682,61,653,68,597,93,546,129,501,173,463,219,431,263,392,329"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="497,328,599,354"/>
<area shape="poly" title=" " alt="" coords="437,339,481,339,481,344,437,344"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="664,328,765,354"/>
<area shape="poly" title=" " alt="" coords="600,339,648,339,648,344,600,344"/>
<area shape="rect" href="darwinusb_8c.html#ab10d2c139ee0772df628b5e705368986" title=" " alt="" coords="842,279,955,305"/>
<area shape="poly" title=" " alt="" coords="765,325,833,307,834,312,766,330"/>
<area shape="rect" href="darwinusb_8c.html#ab97608baf2dc20e00693ea3d28b1c5fe" title=" " alt="" coords="842,328,955,354"/>
<area shape="poly" title=" " alt="" coords="765,339,827,339,827,344,765,344"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="839,178,958,204"/>
<area shape="poly" title=" " alt="" coords="723,326,762,276,789,247,820,220,842,208,845,212,824,225,793,251,766,279,727,329"/>
<area shape="rect" href="darwinusb_8c.html#a6378ac6f6b9262ad7cba19de626cd74b" title=" " alt="" coords="822,378,975,404"/>
<area shape="poly" title=" " alt="" coords="766,352,834,371,833,376,765,357"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="834,427,963,453"/>
<area shape="poly" title=" " alt="" coords="733,352,773,383,823,414,835,419,833,424,821,418,770,387,730,357"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="1053,324,1159,350"/>
<area shape="poly" title=" " alt="" coords="727,326,766,293,793,276,821,264,864,252,899,247,934,251,976,264,993,274,1002,286,1011,298,1025,310,1040,317,1037,322,1022,314,1007,302,998,289,989,278,974,269,933,256,899,252,865,257,823,269,795,281,770,297,730,330"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="856,476,941,502"/>
<area shape="poly" title=" " alt="" coords="726,353,764,406,791,437,823,463,843,473,840,478,821,468,788,441,759,410,721,356"/>
<area shape="poly" title=" " alt="" coords="930,175,1022,136,1055,123,1057,128,1024,141,932,180"/>
<area shape="poly" title=" " alt="" coords="959,184,1257,162,1258,168,959,189"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="1023,260,1189,300"/>
<area shape="poly" title=" " alt="" coords="934,202,976,220,1024,244,1039,251,1037,256,1022,249,974,225,932,207"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="1030,194,1182,235"/>
<area shape="poly" title=" " alt="" coords="959,195,1015,201,1015,207,958,200"/>
<area shape="poly" title=" " alt="" coords="1161,257,1187,244,1244,212,1293,180,1296,184,1247,216,1190,249,1163,261"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="1237,260,1419,300"/>
<area shape="poly" title=" " alt="" coords="1189,277,1221,277,1221,283,1189,283"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="1486,267,1582,293"/>
<area shape="poly" title=" " alt="" coords="1419,277,1471,277,1471,283,1419,283"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="1649,267,1740,293"/>
<area shape="poly" title=" " alt="" coords="1582,277,1634,277,1634,283,1582,283"/>
<area shape="poly" title=" " alt="" coords="1181,193,1257,175,1258,180,1183,199"/>
<area shape="poly" title=" " alt="" coords="1182,216,1295,227,1420,245,1478,260,1477,265,1418,251,1294,232,1182,222"/>
<area shape="poly" title=" " alt="" coords="944,424,997,413,1060,407,1127,413,1160,421,1190,435,1218,454,1242,478,1280,533,1306,590,1322,636,1317,638,1301,592,1275,536,1238,481,1214,458,1187,440,1158,426,1126,418,1061,413,998,418,945,429"/>
<area shape="poly" title=" " alt="" coords="1158,321,1231,302,1232,307,1159,326"/>
<area shape="poly" title=" " alt="" coords="1159,333,1279,327,1419,309,1477,295,1479,300,1419,315,1279,332,1160,339"/>
<area shape="poly" title=" " alt="" coords="941,476,1023,461,1070,453,1109,446,1146,446,1190,462,1215,478,1238,498,1275,546,1302,595,1320,636,1315,638,1297,597,1271,549,1234,502,1212,482,1187,466,1145,451,1109,451,1071,459,1024,467,942,481"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="1048,476,1164,502"/>
<area shape="poly" title=" " alt="" coords="942,494,1032,495,1032,501,942,499"/>
<area shape="poly" title=" " alt="" coords="1166,500,1190,511,1228,540,1262,574,1312,637,1308,640,1258,578,1225,544,1187,516,1163,504"/>
<area shape="poly" title=" " alt="" coords="1047,484,957,484,957,479,1047,478"/>
<area shape="poly" title=" " alt="" coords="927,745,977,757,1042,767,1116,768,1152,764,1188,756,1220,743,1251,725,1300,686,1304,690,1254,729,1223,747,1189,761,1153,770,1116,774,1042,772,976,762,926,751"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="1030,676,1182,702"/>
<area shape="poly" title=" " alt="" coords="926,731,1035,704,1036,709,927,736"/>
<area shape="poly" title=" " alt="" coords="1182,678,1254,670,1254,675,1183,683"/>
<area shape="poly" title=" " alt="" coords="251,988,547,988,900,988,986,988,1054,981,1085,973,1117,960,1150,940,1187,914,1213,890,1237,862,1274,800,1301,740,1317,691,1322,693,1306,742,1279,803,1241,865,1217,893,1190,918,1153,945,1119,964,1087,978,1055,986,986,993,900,993,547,993,251,993"/>
<area shape="poly" title=" " alt="" coords="234,975,354,861,357,865,238,979"/>
<area shape="rect" href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4" title=" " alt="" coords="321,1079,441,1105"/>
<area shape="poly" title=" " alt="" coords="241,1002,322,1058,342,1069,339,1074,320,1062,238,1006"/>
<area shape="rect" href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238" title=" " alt="" coords="489,1054,607,1080"/>
<area shape="poly" title=" " alt="" coords="252,995,475,1047,474,1052,250,1000"/>
<area shape="poly" title=" " alt="" coords="441,1080,474,1075,474,1081,442,1085"/>
<area shape="poly" title=" " alt="" coords="918,573,947,547,973,513,991,467,999,425,999,386,996,349,993,311,994,271,1002,229,1021,181,1043,151,1070,127,1073,131,1047,155,1026,184,1007,230,999,272,998,311,1001,348,1005,386,1004,426,997,468,978,516,951,551,922,577"/>
<area shape="poly" title=" " alt="" coords="928,599,1066,667,1063,672,926,604"/>
<area shape="rect" href="utils_8c.html#a4559cac87d5ac7bbcb747ccf727888fb" title=" " alt="" coords="1026,575,1186,601"/>
<area shape="poly" title=" " alt="" coords="962,585,1011,585,1011,591,962,591"/>
<area shape="rect" href="utils_8c.html#ae9c540cf47354917fa685d6b010d94f7" title=" " alt="" coords="1026,526,1186,552"/>
<area shape="poly" title=" " alt="" coords="955,572,1034,553,1035,558,957,577"/>
<area shape="poly" title=" " alt="" coords="248,851,301,876,374,904,459,928,503,935,547,937,900,937,934,935,967,929,1032,908,1094,876,1150,838,1200,796,1244,755,1305,687,1309,691,1248,759,1204,800,1153,842,1096,881,1034,913,969,935,935,941,900,943,547,943,502,940,458,933,372,910,299,881,246,856"/>
<area shape="poly" title=" " alt="" coords="253,837,321,837,321,843,253,843"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_icgraph.png" border="0" usemap="#adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_icgraph" id="adarwinusb_8c_a21b4c9d5b57f1d4a8f6b08b170b1d29f_icgraph">
<area shape="rect" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a9a37658b034e10d52a5affda2c28a26d" name="a9a37658b034e10d52a5affda2c28a26d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a37658b034e10d52a5affda2c28a26d">&#9670;&#160;</a></span>prime_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int prime_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>connexion</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1494</span>{</div>
<div class="line"><span class="lineno"> 1495</span>    <span class="comment">/* increment refcount */</span></div>
<div class="line"><span class="lineno"> 1496</span>    <span class="keywordflow">if</span> (pthread_mutex_lock(&amp;c-&gt;ref_count_mutex) != 0)</div>
<div class="line"><span class="lineno"> 1497</span>    {</div>
<div class="line"><span class="lineno"> 1498</span>        <span class="comment">/* c became invalid? */</span></div>
<div class="line"><span class="lineno"> 1499</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb:  prime_read(%p): can&#39;t lock c-&gt;ref_count_mutex (structure freed?)\n&quot;</span>, c));</div>
<div class="line"><span class="lineno"> 1500</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1501</span>    }</div>
<div class="line"><span class="lineno"> 1502</span>    c-&gt;ref_count++;</div>
<div class="line"><span class="lineno"> 1503</span>    pthread_mutex_unlock(&amp;c-&gt;ref_count_mutex);</div>
<div class="line"><span class="lineno"> 1504</span> </div>
<div class="line"><span class="lineno"> 1505</span>    <span class="keywordflow">if</span> (c-&gt;opened)</div>
<div class="line"><span class="lineno"> 1506</span>    {</div>
<div class="line"><span class="lineno"> 1507</span>        <span class="comment">/* select a correct read size (always use a multiple of the USB packet size) */</span></div>
<div class="line"><span class="lineno"> 1508</span>        <span class="keywordflow">if</span> (c-&gt;vendorID == <a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; c-&gt;productID == <a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno"> 1509</span>        {</div>
<div class="line"><span class="lineno"> 1510</span>            <span class="comment">/* with PalmConnect USB, always use 64 bytes */</span></div>
<div class="line"><span class="lineno"> 1511</span>            c-&gt;last_read_ahead_size = 64;</div>
<div class="line"><span class="lineno"> 1512</span>        }</div>
<div class="line"><span class="lineno"> 1513</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1514</span>        {</div>
<div class="line"><span class="lineno"> 1515</span>            c-&gt;last_read_ahead_size = c-&gt;read_ahead_size &amp; ~(c-&gt;in_pipe_bulk_size-1);</div>
<div class="line"><span class="lineno"> 1516</span>            <span class="keywordflow">if</span> (c-&gt;last_read_ahead_size &lt;= 0)</div>
<div class="line"><span class="lineno"> 1517</span>                c-&gt;last_read_ahead_size = c-&gt;auto_read_size;</div>
<div class="line"><span class="lineno"> 1518</span>            <span class="keywordflow">if</span> (c-&gt;last_read_ahead_size &gt; <a class="code hl_define" href="#af0de01b4bd1f5311a37a36b33f27e39a">MAX_AUTO_READ_SIZE</a>)</div>
<div class="line"><span class="lineno"> 1519</span>                c-&gt;last_read_ahead_size = <a class="code hl_define" href="#af0de01b4bd1f5311a37a36b33f27e39a">MAX_AUTO_READ_SIZE</a>;</div>
<div class="line"><span class="lineno"> 1520</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;last_read_ahead_size &lt; c-&gt;in_pipe_bulk_size)</div>
<div class="line"><span class="lineno"> 1521</span>                c-&gt;last_read_ahead_size = c-&gt;in_pipe_bulk_size;         <span class="comment">// USB packet size</span></div>
<div class="line"><span class="lineno"> 1522</span>        }</div>
<div class="line"><span class="lineno"> 1523</span> </div>
<div class="line"><span class="lineno"> 1524</span>        <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: prime_read(%p) for %d bytes\n&quot;</span>, c, c-&gt;last_read_ahead_size));</div>
<div class="line"><span class="lineno"> 1525</span> </div>
<div class="line"><span class="lineno"> 1526</span>        IOReturn kr = (*c-&gt;interface)-&gt;ReadPipeAsyncTO (c-&gt;interface, c-&gt;in_pipe_ref,</div>
<div class="line"><span class="lineno"> 1527</span>                c-&gt;read_buffer, c-&gt;last_read_ahead_size, 5000, 5000, (IOAsyncCallback1)&amp;<a class="code hl_function" href="#a657fc918c5800dab2a0fbdf7e4a97d73">read_completion</a>, (<span class="keywordtype">void</span> *)c);</div>
<div class="line"><span class="lineno"> 1528</span> </div>
<div class="line"><span class="lineno"> 1529</span>        <span class="keywordflow">if</span> (kr == kIOUSBPipeStalled || kr == kIOUSBTransactionTimeout || kr == kIOUSBDataToggleErr)</div>
<div class="line"><span class="lineno"> 1530</span>        {</div>
<div class="line"><span class="lineno"> 1531</span>            <span class="comment">// this code may be removed later as we are now using ReadPipeAsyncTO which is not</span></div>
<div class="line"><span class="lineno"> 1532</span>            <span class="comment">// supposed to return them (it calls the completion callback instead)</span></div>
<div class="line"><span class="lineno"> 1533</span>            <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: stalled -- clearing stall and re-priming\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1534</span>            (*c-&gt;interface)-&gt;ClearPipeStall (c-&gt;interface, c-&gt;in_pipe_ref);</div>
<div class="line"><span class="lineno"> 1535</span>            kr = (*c-&gt;interface)-&gt;ReadPipeAsyncTO (c-&gt;interface, c-&gt;in_pipe_ref,</div>
<div class="line"><span class="lineno"> 1536</span>                    c-&gt;read_buffer, c-&gt;last_read_ahead_size, 5000, 5000, (IOAsyncCallback1)&amp;<a class="code hl_function" href="#a657fc918c5800dab2a0fbdf7e4a97d73">read_completion</a>, (<span class="keywordtype">void</span> *)c);</div>
<div class="line"><span class="lineno"> 1537</span>        }</div>
<div class="line"><span class="lineno"> 1538</span>        <span class="keywordflow">if</span> (kr == kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1539</span>        {</div>
<div class="line"><span class="lineno"> 1540</span>            c-&gt;read_pending = 1;</div>
<div class="line"><span class="lineno"> 1541</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1542</span>        }</div>
<div class="line"><span class="lineno"> 1543</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb:  prime_read(%p): ReadPipeAsync returned error 0x%08x\n&quot;</span>, c, kr));</div>
<div class="line"><span class="lineno"> 1544</span>    }</div>
<div class="line"><span class="lineno"> 1545</span> </div>
<div class="line"><span class="lineno"> 1546</span>    <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1547</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1548</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a657fc918c5800dab2a0fbdf7e4a97d73"><div class="ttname"><a href="#a657fc918c5800dab2a0fbdf7e4a97d73">read_completion</a></div><div class="ttdeci">static void read_completion(usb_connection_t *connexion, IOReturn result, void *arg0)</div><div class="ttdef"><b>Definition</b> darwinusb.c:1402</div></div>
<div class="ttc" id="adarwinusb_8c_html_af0de01b4bd1f5311a37a36b33f27e39a"><div class="ttname"><a href="#af0de01b4bd1f5311a37a36b33f27e39a">MAX_AUTO_READ_SIZE</a></div><div class="ttdeci">#define MAX_AUTO_READ_SIZE</div><div class="ttdef"><b>Definition</b> darwinusb.c:112</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00162">usb_connection_t::auto_read_size</a>, <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00157">usb_connection_t::in_pipe_bulk_size</a>, <a class="el" href="#l00156">usb_connection_t::in_pipe_ref</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00164">usb_connection_t::last_read_ahead_size</a>, <a class="el" href="#l00112">MAX_AUTO_READ_SIZE</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00163">usb_connection_t::read_ahead_size</a>, <a class="el" href="#l00175">usb_connection_t::read_buffer</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l00143">usb_connection_t::ref_count</a>, <a class="el" href="#l00142">usb_connection_t::ref_count_mutex</a>, <a class="el" href="#l00106">ULOG</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>, and <a class="el" href="#l01402">read_completion()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_cgraph.png" border="0" usemap="#adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_cgraph" id="adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,91,82"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="303,31,420,56"/>
<area shape="poly" title=" " alt="" coords="87,53,138,41,215,35,288,36,288,41,216,40,139,46,89,58"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="139,56,255,82"/>
<area shape="poly" title=" " alt="" coords="91,74,123,75,123,80,91,80"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="468,5,603,31"/>
<area shape="poly" title=" " alt="" coords="421,32,453,28,453,33,421,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="485,55,586,80"/>
<area shape="poly" title=" " alt="" coords="421,49,470,56,469,61,421,54"/>
<area shape="poly" title=" " alt="" coords="138,63,106,63,106,57,138,57"/>
<area shape="poly" title=" " alt="" coords="255,57,287,52,288,58,256,63"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_icgraph.png" border="0" usemap="#adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_icgraph" id="adarwinusb_8c_a9a37658b034e10d52a5affda2c28a26d_icgraph">
<area shape="rect" title=" " alt="" coords="1876,292,1962,317"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1720,242,1821,268"/>
<area shape="poly" title=" " alt="" coords="1863,289,1811,271,1812,266,1864,284"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="1712,292,1828,317"/>
<area shape="poly" title=" " alt="" coords="1861,316,1829,316,1829,310,1861,310"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1704,258,1664,258,1664,252,1704,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="1844,293,1876,293,1876,299,1844,298"/>
</map>
</div>

</div>
</div>
<a id="a657fc918c5800dab2a0fbdf7e4a97d73" name="a657fc918c5800dab2a0fbdf7e4a97d73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a657fc918c5800dab2a0fbdf7e4a97d73">&#9670;&#160;</a></span>read_completion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void read_completion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>connexion</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IOReturn</td>          <td class="paramname"><span class="paramname"><em>result</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg0</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1403</span>{</div>
<div class="line"><span class="lineno"> 1404</span>    <span class="keywordtype">size_t</span> bytes_read = (size_t) arg0;</div>
<div class="line"><span class="lineno"> 1405</span> </div>
<div class="line"><span class="lineno"> 1406</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: read_completion(c=%p, result=0x%08lx, bytes_read=%d)\n&quot;</span>, c, (<span class="keywordtype">long</span>)result, bytes_read));</div>
<div class="line"><span class="lineno"> 1407</span> </div>
<div class="line"><span class="lineno"> 1408</span>    <span class="keywordflow">if</span> (!c-&gt;opened)</div>
<div class="line"><span class="lineno"> 1409</span>    {</div>
<div class="line"><span class="lineno"> 1410</span>            <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1411</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1412</span>    }</div>
<div class="line"><span class="lineno"> 1413</span> </div>
<div class="line"><span class="lineno"> 1414</span>    <span class="keywordflow">if</span> (result != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1415</span>    {</div>
<div class="line"><span class="lineno"> 1416</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_WARN, <span class="stringliteral">&quot;darwinusb: async read completion(%p) received error code 0x%08x\n&quot;</span>, c, result));</div>
<div class="line"><span class="lineno"> 1417</span>    }</div>
<div class="line"><span class="lineno"> 1418</span> </div>
<div class="line"><span class="lineno"> 1419</span>    <span class="keywordflow">if</span> (bytes_read)</div>
<div class="line"><span class="lineno"> 1420</span>    {</div>
<div class="line"><span class="lineno"> 1421</span>        <span class="keywordflow">if</span> (c-&gt;vendorID == <a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; c-&gt;productID == <a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno"> 1422</span>        {</div>
<div class="line"><span class="lineno"> 1423</span>            <span class="comment">/* decode PalmConnect USB frame */</span></div>
<div class="line"><span class="lineno"> 1424</span>            <span class="keywordflow">if</span> (bytes_read &lt; 2)</div>
<div class="line"><span class="lineno"> 1425</span>                bytes_read = 0;</div>
<div class="line"><span class="lineno"> 1426</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1427</span>            {</div>
<div class="line"><span class="lineno"> 1428</span>                <span class="keywordtype">int</span> data_size = (int)c-&gt;read_buffer[0] | ((<span class="keywordtype">int</span>)c-&gt;read_buffer[1] &lt;&lt; 8);</div>
<div class="line"><span class="lineno"> 1429</span>                <span class="keywordflow">if</span> ((data_size + 2) &gt; bytes_read)</div>
<div class="line"><span class="lineno"> 1430</span>                {</div>
<div class="line"><span class="lineno"> 1431</span>                    LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: invalid PalmConnect packet (%d bytes, says %d content bytes)\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1432</span>                        bytes_read, data_size));</div>
<div class="line"><span class="lineno"> 1433</span>                    bytes_read = 0;</div>
<div class="line"><span class="lineno"> 1434</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1435</span>                    memmove(&amp;c-&gt;read_buffer[0], &amp;c-&gt;read_buffer[2], data_size);</div>
<div class="line"><span class="lineno"> 1436</span>                    bytes_read = data_size;</div>
<div class="line"><span class="lineno"> 1437</span>                }</div>
<div class="line"><span class="lineno"> 1438</span>            }</div>
<div class="line"><span class="lineno"> 1439</span>        }</div>
<div class="line"><span class="lineno"> 1440</span>        <span class="keywordflow">if</span> (bytes_read &gt; 0)</div>
<div class="line"><span class="lineno"> 1441</span>        {</div>
<div class="line"><span class="lineno"> 1442</span>            pthread_mutex_lock(&amp;c-&gt;read_queue_mutex);</div>
<div class="line"><span class="lineno"> 1443</span>            <span class="keywordflow">if</span> (c-&gt;read_queue == NULL)</div>
<div class="line"><span class="lineno"> 1444</span>            {</div>
<div class="line"><span class="lineno"> 1445</span>                c-&gt;read_queue_size = ((bytes_read + 0xfffe) &amp; ~0xffff) - 1;     <span class="comment">/* 64k chunks */</span></div>
<div class="line"><span class="lineno"> 1446</span>                c-&gt;read_queue = (<span class="keywordtype">char</span> *) malloc (c-&gt;read_queue_size);</div>
<div class="line"><span class="lineno"> 1447</span>                c-&gt;read_queue_used = 0;</div>
<div class="line"><span class="lineno"> 1448</span>            }</div>
<div class="line"><span class="lineno"> 1449</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c-&gt;read_queue_used + bytes_read) &gt; c-&gt;read_queue_size)</div>
<div class="line"><span class="lineno"> 1450</span>            {</div>
<div class="line"><span class="lineno"> 1451</span>                c-&gt;read_queue_size += ((bytes_read + 0xfffe) &amp; ~0xffff) - 1;</div>
<div class="line"><span class="lineno"> 1452</span>                c-&gt;read_queue = (<span class="keywordtype">char</span> *) realloc (c-&gt;read_queue, c-&gt;read_queue_size);</div>
<div class="line"><span class="lineno"> 1453</span>            }</div>
<div class="line"><span class="lineno"> 1454</span>            <span class="keywordflow">if</span> (c-&gt;read_queue)</div>
<div class="line"><span class="lineno"> 1455</span>            {</div>
<div class="line"><span class="lineno"> 1456</span>                memcpy(c-&gt;read_queue + c-&gt;read_queue_used, c-&gt;read_buffer, bytes_read);</div>
<div class="line"><span class="lineno"> 1457</span>                c-&gt;read_queue_used += bytes_read;</div>
<div class="line"><span class="lineno"> 1458</span>                <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: signaling c-&gt;read_queue_data_avail_cond for c=%p\n&quot;</span>,c));</div>
<div class="line"><span class="lineno"> 1459</span>                pthread_cond_signal(&amp;c-&gt;read_queue_data_avail_cond);</div>
<div class="line"><span class="lineno"> 1460</span>            }</div>
<div class="line"><span class="lineno"> 1461</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1462</span>            {</div>
<div class="line"><span class="lineno"> 1463</span>                c-&gt;read_queue_used = 0;</div>
<div class="line"><span class="lineno"> 1464</span>                c-&gt;read_queue_size = 0;</div>
<div class="line"><span class="lineno"> 1465</span>            }</div>
<div class="line"><span class="lineno"> 1466</span>            pthread_mutex_unlock(&amp;c-&gt;read_queue_mutex);</div>
<div class="line"><span class="lineno"> 1467</span> </div>
<div class="line"><span class="lineno"> 1468</span>            <span class="keywordflow">if</span> (c-&gt;total_bytes_read == 0)</div>
<div class="line"><span class="lineno"> 1469</span>            {</div>
<div class="line"><span class="lineno"> 1470</span>                <span class="comment">/* the connection is now considered live */</span></div>
<div class="line"><span class="lineno"> 1471</span>                pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1472</span>                pthread_cond_signal(&amp;<a class="code hl_variable" href="#a8236dfde083ec56b0a613afbecf88237">usb_connection_added_cond</a>);</div>
<div class="line"><span class="lineno"> 1473</span>                pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1474</span>            }</div>
<div class="line"><span class="lineno"> 1475</span>            c-&gt;total_bytes_read += (<span class="keywordtype">unsigned</span> long)bytes_read;</div>
<div class="line"><span class="lineno"> 1476</span>        }</div>
<div class="line"><span class="lineno"> 1477</span>    }</div>
<div class="line"><span class="lineno"> 1478</span> </div>
<div class="line"><span class="lineno"> 1479</span>    <span class="keywordflow">if</span> (result != kIOReturnAborted &amp;&amp; c-&gt;opened &amp;&amp; <a class="code hl_variable" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a>)</div>
<div class="line"><span class="lineno"> 1480</span>    {</div>
<div class="line"><span class="lineno"> 1481</span>        <span class="keywordflow">if</span> (result != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1482</span>        {</div>
<div class="line"><span class="lineno"> 1483</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: clearing input pipe stall\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1484</span>            (*c-&gt;interface)-&gt;ClearPipeStallBothEnds (c-&gt;interface, c-&gt;in_pipe_ref);</div>
<div class="line"><span class="lineno"> 1485</span>        }</div>
<div class="line"><span class="lineno"> 1486</span>        <a class="code hl_function" href="#a9a37658b034e10d52a5affda2c28a26d">prime_read</a>(c);</div>
<div class="line"><span class="lineno"> 1487</span>    }</div>
<div class="line"><span class="lineno"> 1488</span> </div>
<div class="line"><span class="lineno"> 1489</span>    <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1490</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a8236dfde083ec56b0a613afbecf88237"><div class="ttname"><a href="#a8236dfde083ec56b0a613afbecf88237">usb_connection_added_cond</a></div><div class="ttdeci">static pthread_cond_t usb_connection_added_cond</div><div class="ttdef"><b>Definition</b> darwinusb.c:132</div></div>
<div class="ttc" id="adarwinusb_8c_html_aa8f71bd48f1b7d294f04994511f77eeb"><div class="ttname"><a href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a></div><div class="ttdeci">static CFRunLoopRef usb_run_loop</div><div class="ttdef"><b>Definition</b> darwinusb.c:127</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00156">usb_connection_t::in_pipe_ref</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l01493">prime_read()</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00175">usb_connection_t::read_buffer</a>, <a class="el" href="#l00171">usb_connection_t::read_queue</a>, <a class="el" href="#l00170">usb_connection_t::read_queue_data_avail_cond</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, <a class="el" href="#l00172">usb_connection_t::read_queue_size</a>, <a class="el" href="#l00173">usb_connection_t::read_queue_used</a>, <a class="el" href="#l00166">usb_connection_t::total_bytes_read</a>, <a class="el" href="#l00106">ULOG</a>, <a class="el" href="#l00132">usb_connection_added_cond</a>, <a class="el" href="#l00131">usb_connections_mutex</a>, <a class="el" href="#l00127">usb_run_loop</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01493">prime_read()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_cgraph.png" border="0" usemap="#adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_cgraph" id="adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,122,82"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="303,31,420,56"/>
<area shape="poly" title=" " alt="" coords="110,53,169,41,230,37,287,37,287,42,230,42,170,46,111,58"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="170,56,255,82"/>
<area shape="poly" title=" " alt="" coords="122,75,154,75,154,80,122,80"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="468,5,603,31"/>
<area shape="poly" title=" " alt="" coords="421,32,453,28,453,33,421,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="485,55,586,80"/>
<area shape="poly" title=" " alt="" coords="421,49,470,56,469,61,421,54"/>
<area shape="poly" title=" " alt="" coords="169,63,137,62,138,57,169,58"/>
<area shape="poly" title=" " alt="" coords="255,59,287,53,288,59,256,64"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_icgraph.png" border="0" usemap="#adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_icgraph" id="adarwinusb_8c_a657fc918c5800dab2a0fbdf7e4a97d73_icgraph">
<area shape="rect" title=" " alt="" coords="1995,242,2111,268"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="1861,242,1947,268"/>
<area shape="poly" title=" " alt="" coords="1979,267,1947,266,1947,261,1979,261"/>
<area shape="poly" title=" " alt="" coords="1962,244,1994,244,1994,249,1962,249"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a1fdb9881cd44d8dfa115018ef8a8a07a" name="a1fdb9881cd44d8dfa115018ef8a8a07a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fdb9881cd44d8dfa115018ef8a8a07a">&#9670;&#160;</a></span>read_generic_connection_information()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn read_generic_connection_information </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>port_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>input_pipe_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>output_pipe_number</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1327</span>{</div>
<div class="line"><span class="lineno"> 1328</span>    kern_return_t  kr;</div>
<div class="line"><span class="lineno"> 1329</span>    <a class="code hl_struct" href="structpalm__ext__connection__info.html">palm_ext_connection_info</a> ci;</div>
<div class="line"><span class="lineno"> 1330</span> </div>
<div class="line"><span class="lineno"> 1331</span>    memset(&amp;ci, 0, <span class="keyword">sizeof</span>(ci));</div>
<div class="line"><span class="lineno"> 1332</span>    kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a> (dev, 0xc2, <a class="code hl_define" href="#a22b08ff484c0cfd3cc9536dd3aee44db">PALM_GET_EXT_CONNECTION_INFORMATION</a>, 0, 0, &amp;ci, <span class="keyword">sizeof</span>(ci));</div>
<div class="line"><span class="lineno"> 1333</span>    <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1334</span>    {</div>
<div class="line"><span class="lineno"> 1335</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: PALM_GET_EXT_CONNECTION_INFORMATION failed (err=%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1336</span>        <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno"> 1337</span>    }</div>
<div class="line"><span class="lineno"> 1338</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#a0cc85622030ec13870fc90026ace908b">decode_generic_connection_information</a>(&amp;ci, port_number, input_pipe, output_pipe);</div>
<div class="line"><span class="lineno"> 1339</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a22b08ff484c0cfd3cc9536dd3aee44db"><div class="ttname"><a href="#a22b08ff484c0cfd3cc9536dd3aee44db">PALM_GET_EXT_CONNECTION_INFORMATION</a></div><div class="ttdeci">#define PALM_GET_EXT_CONNECTION_INFORMATION</div><div class="ttdef"><b>Definition</b> darwinusb.c:186</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01196">control_request()</a>, <a class="el" href="#l01279">decode_generic_connection_information()</a>, and <a class="el" href="#l00186">PALM_GET_EXT_CONNECTION_INFORMATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_cgraph.png" border="0" usemap="#adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_cgraph" id="adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_cgraph">
<area shape="rect" title=" " alt="" coords="5,27,171,68"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="255,5,365,31"/>
<area shape="poly" title=" " alt="" coords="171,34,239,25,240,30,171,39"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="219,55,401,96"/>
<area shape="poly" title=" " alt="" coords="171,55,203,59,203,65,171,61"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="449,63,544,88"/>
<area shape="poly" title=" " alt="" coords="402,73,433,73,433,78,402,78"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="592,63,683,88"/>
<area shape="poly" title=" " alt="" coords="545,73,577,73,577,78,545,78"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_icgraph.png" border="0" usemap="#adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_icgraph" id="adarwinusb_8c_a1fdb9881cd44d8dfa115018ef8a8a07a_icgraph">
<area shape="rect" title=" " alt="" coords="2029,235,2194,275"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="1861,242,1981,268"/>
<area shape="poly" title=" " alt="" coords="2013,258,1981,258,1981,252,2013,252"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a90eff23f2e0b0132dbb82d4cbfeb4cc0" name="a90eff23f2e0b0132dbb82d4cbfeb4cc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90eff23f2e0b0132dbb82d4cbfeb4cc0">&#9670;&#160;</a></span>read_visor_connection_information()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IOReturn read_visor_connection_information </td>
          <td>(</td>
          <td class="paramtype">IOUSBDeviceInterface **</td>          <td class="paramname"><span class="paramname"><em>dev</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>port_number</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>input_pipe</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>output_pipe</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1225</span>{</div>
<div class="line"><span class="lineno"> 1226</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno"> 1227</span>    kern_return_t kr;</div>
<div class="line"><span class="lineno"> 1228</span>    <a class="code hl_struct" href="structvisor__connection__info.html">visor_connection_info</a> ci;</div>
<div class="line"><span class="lineno"> 1229</span> </div>
<div class="line"><span class="lineno"> 1230</span>    memset(&amp;ci, 0, <span class="keyword">sizeof</span>(ci));</div>
<div class="line"><span class="lineno"> 1231</span>    kr = <a class="code hl_function" href="#a6bf0b49b7f893ca4dd2b2a7739c59aec">control_request</a> (dev, 0xc2, <a class="code hl_define" href="#ad3b8ec3afa8751af3cb8d549ab49cdec">VISOR_GET_CONNECTION_INFORMATION</a>, 0, 0, &amp;ci, <span class="keyword">sizeof</span>(ci));</div>
<div class="line"><span class="lineno"> 1232</span>    <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1233</span>    {</div>
<div class="line"><span class="lineno"> 1234</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: VISOR_GET_CONNECTION_INFORMATION failed (err=%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1235</span>    }</div>
<div class="line"><span class="lineno"> 1236</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1237</span>    {</div>
<div class="line"><span class="lineno"> 1238</span>        CHECK(PI_DBG_DEV, PI_DBG_LVL_DEBUG, <a class="code hl_function" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9">pi_dumpdata</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)&amp;ci, <span class="keyword">sizeof</span>(ci)));</div>
<div class="line"><span class="lineno"> 1239</span>        ci.num_ports = CFSwapInt16LittleToHost(ci.num_ports);       <span class="comment">/* number of ports is little-endian */</span></div>
<div class="line"><span class="lineno"> 1240</span>        <span class="keywordflow">if</span> (ci.num_ports &gt; 8)</div>
<div class="line"><span class="lineno"> 1241</span>            ci.num_ports = 8;</div>
<div class="line"><span class="lineno"> 1242</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: VISOR_GET_CONNECTION_INFORMATION, num_ports=%d\n&quot;</span>, ci.num_ports));</div>
<div class="line"><span class="lineno"> 1243</span>        kr = kIOReturnNotReady;</div>
<div class="line"><span class="lineno"> 1244</span>        <span class="keywordflow">for</span> (i=0; i &lt; ci.num_ports; i++)</div>
<div class="line"><span class="lineno"> 1245</span>        {</div>
<div class="line"><span class="lineno"> 1246</span>            <span class="keywordtype">char</span> *function_str;</div>
<div class="line"><span class="lineno"> 1247</span>            <span class="keywordflow">switch</span> (ci.connections[i].port_function_id)</div>
<div class="line"><span class="lineno"> 1248</span>            {</div>
<div class="line"><span class="lineno"> 1249</span>                <span class="keywordflow">case</span> <a class="code hl_define" href="#a0987f64d971059f38d9c02f205de0605">VISOR_FUNCTION_GENERIC</a>:</div>
<div class="line"><span class="lineno"> 1250</span>                    function_str = <span class="stringliteral">&quot;GENERIC&quot;</span>;</div>
<div class="line"><span class="lineno"> 1251</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1252</span>                <span class="keywordflow">case</span> <a class="code hl_define" href="#adde5c16f3a4a6496d40f0ec545da7056">VISOR_FUNCTION_DEBUGGER</a>:</div>
<div class="line"><span class="lineno"> 1253</span>                    function_str = <span class="stringliteral">&quot;DEBUGGER&quot;</span>;</div>
<div class="line"><span class="lineno"> 1254</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1255</span>                <span class="keywordflow">case</span> <a class="code hl_define" href="#ad438829a5b519c892325847ed3d7daa4">VISOR_FUNCTION_HOTSYNC</a>:</div>
<div class="line"><span class="lineno"> 1256</span>                    function_str = <span class="stringliteral">&quot;HOTSYNC&quot;</span>;</div>
<div class="line"><span class="lineno"> 1257</span>                    <span class="keywordflow">if</span> (port_number)</div>
<div class="line"><span class="lineno"> 1258</span>                        *port_number = ci.connections[i].port;</div>
<div class="line"><span class="lineno"> 1259</span>                    kr = kIOReturnSuccess;</div>
<div class="line"><span class="lineno"> 1260</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1261</span>                <span class="keywordflow">case</span> <a class="code hl_define" href="#a4b54f2a9722be80f664e5ec9433a64ae">VISOR_FUNCTION_CONSOLE</a>:</div>
<div class="line"><span class="lineno"> 1262</span>                    function_str = <span class="stringliteral">&quot;CONSOLE&quot;</span>;</div>
<div class="line"><span class="lineno"> 1263</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1264</span>                <span class="keywordflow">case</span> <a class="code hl_define" href="#a727e8ebd40a8aab9603d264c3ddaf193">VISOR_FUNCTION_REMOTE_FILE_SYS</a>:</div>
<div class="line"><span class="lineno"> 1265</span>                    function_str = <span class="stringliteral">&quot;REMOTE_FILE_SYSTEM&quot;</span>;</div>
<div class="line"><span class="lineno"> 1266</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1267</span>                <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno"> 1268</span>                    function_str = <span class="stringliteral">&quot;UNKNOWN&quot;</span>;</div>
<div class="line"><span class="lineno"> 1269</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1270</span>            }</div>
<div class="line"><span class="lineno"> 1271</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;\t[%d] port_function_id=0x%02x (%s)\n&quot;</span>, i, ci.connections[i].port_function_id, function_str));</div>
<div class="line"><span class="lineno"> 1272</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;\t[%d] port=%d\n&quot;</span>, i, ci.connections[i].port));</div>
<div class="line"><span class="lineno"> 1273</span>        }</div>
<div class="line"><span class="lineno"> 1274</span>    }</div>
<div class="line"><span class="lineno"> 1275</span>    <span class="keywordflow">return</span> kr;</div>
<div class="line"><span class="lineno"> 1276</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a0987f64d971059f38d9c02f205de0605"><div class="ttname"><a href="#a0987f64d971059f38d9c02f205de0605">VISOR_FUNCTION_GENERIC</a></div><div class="ttdeci">#define VISOR_FUNCTION_GENERIC</div><div class="ttdef"><b>Definition</b> darwinusb.c:206</div></div>
<div class="ttc" id="adarwinusb_8c_html_a4b54f2a9722be80f664e5ec9433a64ae"><div class="ttname"><a href="#a4b54f2a9722be80f664e5ec9433a64ae">VISOR_FUNCTION_CONSOLE</a></div><div class="ttdeci">#define VISOR_FUNCTION_CONSOLE</div><div class="ttdef"><b>Definition</b> darwinusb.c:209</div></div>
<div class="ttc" id="adarwinusb_8c_html_a727e8ebd40a8aab9603d264c3ddaf193"><div class="ttname"><a href="#a727e8ebd40a8aab9603d264c3ddaf193">VISOR_FUNCTION_REMOTE_FILE_SYS</a></div><div class="ttdeci">#define VISOR_FUNCTION_REMOTE_FILE_SYS</div><div class="ttdef"><b>Definition</b> darwinusb.c:210</div></div>
<div class="ttc" id="adarwinusb_8c_html_ad3b8ec3afa8751af3cb8d549ab49cdec"><div class="ttname"><a href="#ad3b8ec3afa8751af3cb8d549ab49cdec">VISOR_GET_CONNECTION_INFORMATION</a></div><div class="ttdeci">#define VISOR_GET_CONNECTION_INFORMATION</div><div class="ttdef"><b>Definition</b> darwinusb.c:185</div></div>
<div class="ttc" id="adarwinusb_8c_html_ad438829a5b519c892325847ed3d7daa4"><div class="ttname"><a href="#ad438829a5b519c892325847ed3d7daa4">VISOR_FUNCTION_HOTSYNC</a></div><div class="ttdeci">#define VISOR_FUNCTION_HOTSYNC</div><div class="ttdef"><b>Definition</b> darwinusb.c:208</div></div>
<div class="ttc" id="adarwinusb_8c_html_adde5c16f3a4a6496d40f0ec545da7056"><div class="ttname"><a href="#adde5c16f3a4a6496d40f0ec545da7056">VISOR_FUNCTION_DEBUGGER</a></div><div class="ttdeci">#define VISOR_FUNCTION_DEBUGGER</div><div class="ttdef"><b>Definition</b> darwinusb.c:207</div></div>
<div class="ttc" id="astructvisor__connection__info_html"><div class="ttname"><a href="structvisor__connection__info.html">visor_connection_info</a></div><div class="ttdef"><b>Definition</b> darwinusb.c:192</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01196">control_request()</a>, <a class="el" href="#l00222">pi_dumpdata()</a>, <a class="el" href="#l00209">VISOR_FUNCTION_CONSOLE</a>, <a class="el" href="#l00207">VISOR_FUNCTION_DEBUGGER</a>, <a class="el" href="#l00206">VISOR_FUNCTION_GENERIC</a>, <a class="el" href="#l00208">VISOR_FUNCTION_HOTSYNC</a>, <a class="el" href="#l00210">VISOR_FUNCTION_REMOTE_FILE_SYS</a>, and <a class="el" href="#l00185">VISOR_GET_CONNECTION_INFORMATION</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00878">configure_device()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_cgraph.png" border="0" usemap="#adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_cgraph" id="adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_cgraph">
<area shape="rect" title=" " alt="" coords="5,23,157,64"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="205,5,315,31"/>
<area shape="poly" title=" " alt="" coords="157,30,189,25,190,31,157,35"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="212,55,308,80"/>
<area shape="poly" title=" " alt="" coords="157,51,197,56,196,62,157,56"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="363,55,453,80"/>
<area shape="poly" title=" " alt="" coords="308,65,347,65,347,70,308,70"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_icgraph.png" border="0" usemap="#adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_icgraph" id="adarwinusb_8c_a90eff23f2e0b0132dbb82d4cbfeb4cc0_icgraph">
<area shape="rect" title=" " alt="" coords="2029,235,2180,275"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="1861,242,1981,268"/>
<area shape="poly" title=" " alt="" coords="2013,258,1981,258,1981,252,2013,252"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1712,242,1813,268"/>
<area shape="poly" title=" " alt="" coords="1846,258,1814,258,1814,252,1846,252"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="poly" title=" " alt="" coords="1696,258,1664,258,1664,252,1696,252"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a173addd105f622a77d8797cad4a33a68" name="a173addd105f622a77d8797cad4a33a68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a173addd105f622a77d8797cad4a33a68">&#9670;&#160;</a></span>remove_connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int remove_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>c</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  429</span>{</div>
<div class="line"><span class="lineno">  430</span>    <span class="comment">/* remove the connection from the linked list if it exists</span></div>
<div class="line"><span class="lineno">  431</span><span class="comment">     * and return != 0. Otherwise return 0. Don&#39;t free the</span></div>
<div class="line"><span class="lineno">  432</span><span class="comment">     * connection structure or variables.</span></div>
<div class="line"><span class="lineno">  433</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  434</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *previous = NULL, *elem;</div>
<div class="line"><span class="lineno">  435</span>    pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  436</span>    elem = <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a>;</div>
<div class="line"><span class="lineno">  437</span>    <span class="keywordflow">while</span> (elem &amp;&amp; elem != c)</div>
<div class="line"><span class="lineno">  438</span>    {</div>
<div class="line"><span class="lineno">  439</span>        previous = elem;</div>
<div class="line"><span class="lineno">  440</span>        elem = elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  441</span>    }</div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">if</span> (elem)</div>
<div class="line"><span class="lineno">  443</span>    {</div>
<div class="line"><span class="lineno">  444</span>        <span class="keywordflow">if</span> (previous)</div>
<div class="line"><span class="lineno">  445</span>            previous-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a> = elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  446</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  447</span>            <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a> = elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  448</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: removed connection %p from linked list\n&quot;</span>, c));</div>
<div class="line"><span class="lineno">  449</span>    }</div>
<div class="line"><span class="lineno">  450</span>    pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  451</span>    <span class="keywordflow">return</span> elem != NULL;</div>
<div class="line"><span class="lineno">  452</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00138">usb_connection_t::next</a>, <a class="el" href="#l00178">usb_connections</a>, and <a class="el" href="#l00131">usb_connections_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00492">change_refcount()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a173addd105f622a77d8797cad4a33a68_icgraph.png" border="0" usemap="#adarwinusb_8c_a173addd105f622a77d8797cad4a33a68_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a173addd105f622a77d8797cad4a33a68_icgraph" id="adarwinusb_8c_a173addd105f622a77d8797cad4a33a68_icgraph">
<area shape="rect" title=" " alt="" coords="2258,192,2392,217"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="2093,192,2210,217"/>
<area shape="poly" title=" " alt="" coords="2242,207,2210,207,2210,202,2242,202"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="1892,42,2045,68"/>
<area shape="poly" title=" " alt="" coords="2132,180,2095,129,2071,103,2043,81,2023,71,2025,66,2046,77,2074,100,2099,126,2136,176"/>
<area shape="rect" href="darwinusb_8c.html#a20220d60460da3af89e8e25bec84a595" title=" " alt="" coords="1758,40,1814,65"/>
<area shape="poly" title=" " alt="" coords="2140,177,2127,142,2108,101,2080,62,2063,45,2043,32,2015,20,1984,13,1952,12,1920,15,1861,27,1815,43,1814,38,1860,22,1920,9,1952,7,1984,8,2016,15,2046,27,2066,41,2084,58,2112,98,2132,140,2145,175"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="1904,92,2033,117"/>
<area shape="poly" title=" " alt="" coords="2122,184,2086,156,2043,131,2018,120,2020,115,2046,126,2089,152,2125,179"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="1926,141,2011,166"/>
<area shape="poly" title=" " alt="" coords="2087,189,2011,168,2012,163,2088,184"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="1728,190,1844,216"/>
<area shape="poly" title=" " alt="" coords="2077,207,1845,206,1845,201,2077,201"/>
<area shape="rect" href="darwinusb_8c.html#ad04208dd4d06c0f62d2ba47da8269257" title=" " alt="" coords="1433,242,1500,268"/>
<area shape="poly" title=" " alt="" coords="2078,213,1845,231,1500,255,1500,250,1844,226,2077,208"/>
<area shape="rect" href="darwinusb_8c.html#ab042613c0c2ec32c60dbc9b0c5f03b75" title=" " alt="" coords="1292,293,1355,318"/>
<area shape="poly" title=" " alt="" coords="2109,227,2048,252,1969,278,1879,300,1833,306,1788,308,1628,308,1356,308,1356,303,1628,303,1787,303,1833,301,1878,294,1967,273,2046,247,2107,222"/>
<area shape="rect" href="darwinusb_8c.html#a8c4b6061f971ce2de3b2f581a87f3751" title=" " alt="" coords="1599,344,1659,369"/>
<area shape="poly" title=" " alt="" coords="2137,232,2101,282,2075,307,2046,327,1994,348,1940,362,1884,370,1829,374,1731,372,1659,364,1660,359,1731,366,1829,369,1883,365,1939,357,1993,343,2043,322,2072,303,2097,279,2133,229"/>
<area shape="rect" href="darwinusb_8c.html#a62be9dca709b9fa802954d73d21ab332" title=" " alt="" coords="1597,394,1660,420"/>
<area shape="poly" title=" " alt="" coords="2144,233,2130,267,2110,306,2082,344,2046,375,1996,399,1943,415,1888,425,1834,429,1734,425,1661,416,1661,411,1734,420,1833,423,1887,419,1942,410,1994,394,2043,370,2078,340,2105,303,2126,265,2139,231"/>
<area shape="poly" title=" " alt="" coords="1877,56,1814,55,1814,50,1877,51"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1403,97,1530,122"/>
<area shape="poly" title=" " alt="" coords="1887,74,1845,80,1674,98,1530,109,1530,104,1674,93,1844,75,1886,68"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1743,53,1676,53,1591,57,1497,67,1404,87,1345,108,1294,142,1264,168,1238,196,1200,244,1195,240,1234,192,1261,164,1290,138,1343,103,1403,82,1496,62,1591,52,1676,48,1743,48"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
<area shape="poly" title=" " alt="" coords="1401,130,1347,149,1293,175,1242,210,1204,244,1200,240,1239,206,1291,170,1345,144,1400,125"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1736,141,1837,166"/>
<area shape="poly" title=" " alt="" coords="1904,124,1837,143,1836,138,1903,119"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1578,166,1680,192"/>
<area shape="poly" title=" " alt="" coords="1721,167,1681,173,1680,168,1720,162"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1411,173,1522,198"/>
<area shape="poly" title=" " alt="" coords="1562,184,1522,186,1522,181,1562,179"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,185,1355,210"/>
<area shape="poly" title=" " alt="" coords="1396,194,1356,198,1356,192,1396,189"/>
<area shape="poly" title=" " alt="" coords="1279,219,1221,244,1219,239,1277,214"/>
<area shape="poly" title=" " alt="" coords="1910,156,1837,156,1837,151,1910,151"/>
<area shape="poly" title=" " alt="" coords="1928,175,1846,198,1844,193,1927,170"/>
<area shape="poly" title=" " alt="" coords="1826,182,1925,155,1926,160,1828,187"/>
<area shape="poly" title=" " alt="" coords="1418,258,1244,258,1244,252,1418,252"/>
<area shape="poly" title=" " alt="" coords="1277,291,1223,271,1224,266,1278,286"/>
<area shape="poly" title=" " alt="" coords="1583,363,1524,366,1450,364,1369,354,1291,334,1263,320,1238,303,1199,270,1203,266,1241,299,1266,316,1293,328,1370,349,1450,359,1524,360,1583,358"/>
<area shape="poly" title=" " alt="" coords="1582,411,1521,409,1447,402,1367,386,1328,373,1291,357,1260,338,1233,314,1196,270,1200,267,1237,310,1263,334,1293,353,1330,368,1369,381,1448,397,1522,404,1582,406"/>
</map>
</div>

</div>
</div>
<a id="a7a9d99aa7696e0e755b80cdd81c0709d" name="a7a9d99aa7696e0e755b80cdd81c0709d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a9d99aa7696e0e755b80cdd81c0709d">&#9670;&#160;</a></span>start_listening()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int start_listening </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  525</span>{</div>
<div class="line"><span class="lineno">  526</span>    mach_port_t masterPort;</div>
<div class="line"><span class="lineno">  527</span>    CFMutableDictionaryRef matchingDict;</div>
<div class="line"><span class="lineno">  528</span>    CFRunLoopSourceRef runLoopSource;</div>
<div class="line"><span class="lineno">  529</span>    kern_return_t kr;</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: start_listening for connections\n&quot;</span>));</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>    <span class="comment">/* first create a master_port for my task */</span></div>
<div class="line"><span class="lineno">  534</span>    kr = IOMasterPort (MACH_PORT_NULL, &amp;masterPort);</div>
<div class="line"><span class="lineno">  535</span>    <span class="keywordflow">if</span> (kr || !masterPort)</div>
<div class="line"><span class="lineno">  536</span>    {</div>
<div class="line"><span class="lineno">  537</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: couldn&#39;t create a master IOKit Port(%08x)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  538</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#afbbd2078dc4e461e1fa9a3b085fe1bb5">PI_ERR_GENERIC_SYSTEM</a>;</div>
<div class="line"><span class="lineno">  539</span>    }</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span>    <span class="comment">/* Set up the matching criteria for the devices we&#39;re interested in</span></div>
<div class="line"><span class="lineno">  542</span><span class="comment">     * Interested in instances of class IOUSBDevice and its subclasses</span></div>
<div class="line"><span class="lineno">  543</span><span class="comment">     * Since we are supporting many USB devices, we just get notifications</span></div>
<div class="line"><span class="lineno">  544</span><span class="comment">     * for all USB devices and sort out the ones that we want later.</span></div>
<div class="line"><span class="lineno">  545</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  546</span>    matchingDict = IOServiceMatching (kIOUSBDeviceClassName);</div>
<div class="line"><span class="lineno">  547</span>    <span class="keywordflow">if</span> (!matchingDict)</div>
<div class="line"><span class="lineno">  548</span>    {</div>
<div class="line"><span class="lineno">  549</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: can&#39;t create a USB matching dictionary\n&quot;</span>));</div>
<div class="line"><span class="lineno">  550</span>        mach_port_deallocate (mach_task_self(), masterPort);</div>
<div class="line"><span class="lineno">  551</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#afbbd2078dc4e461e1fa9a3b085fe1bb5">PI_ERR_GENERIC_SYSTEM</a>;</div>
<div class="line"><span class="lineno">  552</span>    }</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>    <span class="comment">/* Create a notification port and add its run loop event source to our run loop</span></div>
<div class="line"><span class="lineno">  555</span><span class="comment">     * This is how async notifications get set up.</span></div>
<div class="line"><span class="lineno">  556</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  557</span>    <a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a> = IONotificationPortCreate (masterPort);</div>
<div class="line"><span class="lineno">  558</span>    runLoopSource = IONotificationPortGetRunLoopSource (<a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a>);</div>
<div class="line"><span class="lineno">  559</span>    CFRunLoopAddSource(CFRunLoopGetCurrent(), runLoopSource, kCFRunLoopDefaultMode);</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="comment">/* Set up a notifications to be called when a raw device is first matched by I/O Kit */</span></div>
<div class="line"><span class="lineno">  562</span>    kr = IOServiceAddMatchingNotification (</div>
<div class="line"><span class="lineno">  563</span>            <a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a>,</div>
<div class="line"><span class="lineno">  564</span>            kIOFirstMatchNotification,</div>
<div class="line"><span class="lineno">  565</span>            matchingDict,</div>
<div class="line"><span class="lineno">  566</span>            <a class="code hl_function" href="#ad2382b0d9c99eeded50fdcb6f448b92d">device_added</a>,</div>
<div class="line"><span class="lineno">  567</span>            NULL,</div>
<div class="line"><span class="lineno">  568</span>            &amp;<a class="code hl_variable" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a>);</div>
<div class="line"><span class="lineno">  569</span> </div>
<div class="line"><span class="lineno">  570</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: added service matching notification (kr=0x%08lx)\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span>    <span class="comment">/* Iterate once to get already-present devices and arm the notification */</span></div>
<div class="line"><span class="lineno">  573</span>    <a class="code hl_function" href="#ad2382b0d9c99eeded50fdcb6f448b92d">device_added</a> (NULL, <a class="code hl_variable" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a>);</div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">/* Now done with the master_port */</span></div>
<div class="line"><span class="lineno">  576</span>    mach_port_deallocate (mach_task_self(), masterPort);</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  579</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_ad2382b0d9c99eeded50fdcb6f448b92d"><div class="ttname"><a href="#ad2382b0d9c99eeded50fdcb6f448b92d">device_added</a></div><div class="ttdeci">static void device_added(void *refCon, io_iterator_t iterator)</div><div class="ttdef"><b>Definition</b> darwinusb.c:714</div></div>
<div class="ttc" id="adarwinusb_8c_html_af9b66f16119c60eefb658bfc4ac4b617"><div class="ttname"><a href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a></div><div class="ttdeci">static io_iterator_t usb_device_added_iter</div><div class="ttdef"><b>Definition</b> darwinusb.c:124</div></div>
<div class="ttc" id="anamespacepisock_html_afbbd2078dc4e461e1fa9a3b085fe1bb5"><div class="ttname"><a href="namespacepisock.html#afbbd2078dc4e461e1fa9a3b085fe1bb5">pisock.PI_ERR_GENERIC_SYSTEM</a></div><div class="ttdeci">PI_ERR_GENERIC_SYSTEM</div><div class="ttdef"><b>Definition</b> pisock.py:65</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00714">device_added()</a>, <a class="el" href="#l00124">usb_device_added_iter</a>, and <a class="el" href="#l00123">usb_notify_port</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00627">usb_thread_run()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_cgraph.png" border="0" usemap="#adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_cgraph" id="adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_cgraph">
<area shape="rect" title=" " alt="" coords="5,169,108,195"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="156,169,257,195"/>
<area shape="poly" title=" " alt="" coords="108,179,140,179,140,185,108,185"/>
<area shape="rect" href="darwinusb_8c.html#ab10d2c139ee0772df628b5e705368986" title=" " alt="" coords="326,20,438,45"/>
<area shape="poly" title=" " alt="" coords="212,167,246,113,272,82,303,54,310,50,313,55,307,59,276,85,250,116,217,170"/>
<area shape="rect" href="darwinusb_8c.html#ab97608baf2dc20e00693ea3d28b1c5fe" title=" " alt="" coords="326,69,438,95"/>
<area shape="poly" title=" " alt="" coords="219,167,256,136,304,104,314,99,317,103,306,108,259,140,223,171"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="322,118,441,144"/>
<area shape="poly" title=" " alt="" coords="253,166,319,146,321,151,254,171"/>
<area shape="rect" href="darwinusb_8c.html#a6378ac6f6b9262ad7cba19de626cd74b" title=" " alt="" coords="305,220,458,245"/>
<area shape="poly" title=" " alt="" coords="254,193,321,212,319,218,253,198"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="524,270,654,296"/>
<area shape="poly" title=" " alt="" coords="221,193,257,226,280,242,306,255,357,271,410,280,509,285,509,291,409,286,356,276,304,260,278,247,254,230,218,197"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="536,221,642,247"/>
<area shape="poly" title=" " alt="" coords="258,183,351,191,459,205,521,216,520,221,458,210,351,197,257,188"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="339,346,424,372"/>
<area shape="poly" title=" " alt="" coords="219,194,256,243,307,300,349,335,346,339,303,304,251,246,215,197"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="756,46,866,72"/>
<area shape="poly" title=" " alt="" coords="439,116,457,105,472,86,478,65,486,44,505,26,538,12,573,5,609,3,645,5,712,19,767,38,766,43,711,24,644,11,609,8,573,10,540,17,508,31,491,47,484,67,477,88,460,109,442,120"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="524,41,654,67"/>
<area shape="poly" title=" " alt="" coords="430,115,457,105,481,91,505,77,523,70,525,75,508,82,484,96,459,110,432,120"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="506,156,672,197"/>
<area shape="poly" title=" " alt="" coords="442,142,492,153,490,158,441,147"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="513,91,665,132"/>
<area shape="poly" title=" " alt="" coords="441,123,498,117,498,123,442,128"/>
<area shape="poly" title=" " alt="" coords="654,53,740,55,740,60,654,58"/>
<area shape="poly" title=" " alt="" coords="644,153,670,141,727,109,776,79,779,83,730,114,673,146,646,158"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="720,156,902,197"/>
<area shape="poly" title=" " alt="" coords="672,174,704,174,704,179,672,179"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="970,164,1065,189"/>
<area shape="poly" title=" " alt="" coords="902,174,954,174,954,179,902,179"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="1132,164,1223,189"/>
<area shape="poly" title=" " alt="" coords="1065,174,1117,174,1117,179,1065,179"/>
<area shape="poly" title=" " alt="" coords="665,91,740,73,741,78,666,96"/>
<area shape="poly" title=" " alt="" coords="665,113,778,123,903,142,961,156,960,162,901,147,777,129,665,118"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="752,321,870,347"/>
<area shape="poly" title=" " alt="" coords="649,294,738,315,737,320,648,299"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="950,345,1084,371"/>
<area shape="poly" title=" " alt="" coords="870,338,935,346,935,351,870,343"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="966,296,1068,321"/>
<area shape="poly" title=" " alt="" coords="870,324,951,314,951,319,870,329"/>
<area shape="poly" title=" " alt="" coords="641,218,714,199,715,204,642,223"/>
<area shape="poly" title=" " alt="" coords="642,230,762,223,902,206,960,192,962,197,902,211,762,229,643,235"/>
<area shape="poly" title=" " alt="" coords="425,354,737,336,737,341,425,359"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="531,372,647,397"/>
<area shape="poly" title=" " alt="" coords="425,369,516,382,515,387,425,375"/>
<area shape="poly" title=" " alt="" coords="647,369,736,348,737,353,648,374"/>
<area shape="poly" title=" " alt="" coords="541,374,440,361,440,356,542,369"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_icgraph.png" border="0" usemap="#adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_icgraph" id="adarwinusb_8c_a7a9d99aa7696e0e755b80cdd81c0709d_icgraph">
<area shape="rect" title=" " alt="" coords="1562,242,1664,268"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="poly" title=" " alt="" coords="1546,258,1514,258,1514,252,1546,252"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a7974faab5165fb2b558c2f0f08e921ae" name="a7974faab5165fb2b558c2f0f08e921ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7974faab5165fb2b558c2f0f08e921ae">&#9670;&#160;</a></span>stop_listening()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stop_listening </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structusb__connection__t.html">usb_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>c</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  583</span>{</div>
<div class="line"><span class="lineno">  584</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: stop_listening for connection %p\n&quot;</span>,c));</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a> = 0;</div>
<div class="line"><span class="lineno">  587</span>    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#acc95a38d797cbd26598763dd6411e223">in_pipe_ref</a> = 0;</div>
<div class="line"><span class="lineno">  588</span>    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a68cda814b13e4e7b07f76f0291771bca">out_pipe_ref</a> = 0;</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a>)</div>
<div class="line"><span class="lineno">  591</span>    {</div>
<div class="line"><span class="lineno">  592</span>        <span class="comment">/* we do this because if the connection abruptly ends before pilot-link notices,</span></div>
<div class="line"><span class="lineno">  593</span><span class="comment">         * we want to avoid pi_close() trying to do a dlp_EndOfSync()</span></div>
<div class="line"><span class="lineno">  594</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  595</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a>-&gt;state = PI_SOCK_CLOSE;</div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a>-&gt;device != NULL &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a>-&gt;device-&gt;data != NULL)</div>
<div class="line"><span class="lineno">  597</span>            ((pi_usb_data_t *)c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a>-&gt;device-&gt;data)-&gt;ref = NULL;</div>
<div class="line"><span class="lineno">  598</span>    }</div>
<div class="line"><span class="lineno">  599</span>    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a> = NULL;</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7757bb115635620bd26cd7a1d42d66ba">device_notification</a>)</div>
<div class="line"><span class="lineno">  602</span>    {</div>
<div class="line"><span class="lineno">  603</span>        IOObjectRelease (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7757bb115635620bd26cd7a1d42d66ba">device_notification</a>);</div>
<div class="line"><span class="lineno">  604</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7757bb115635620bd26cd7a1d42d66ba">device_notification</a> = 0;</div>
<div class="line"><span class="lineno">  605</span>    }</div>
<div class="line"><span class="lineno">  606</span> </div>
<div class="line"><span class="lineno">  607</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)</div>
<div class="line"><span class="lineno">  608</span>    {</div>
<div class="line"><span class="lineno">  609</span>        (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)-&gt;USBInterfaceClose (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>);</div>
<div class="line"><span class="lineno">  610</span>        (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)-&gt;Release(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>);</div>
<div class="line"><span class="lineno">  611</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a> = NULL;</div>
<div class="line"><span class="lineno">  612</span>    }</div>
<div class="line"><span class="lineno">  613</span> </div>
<div class="line"><span class="lineno">  614</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>)</div>
<div class="line"><span class="lineno">  615</span>    {</div>
<div class="line"><span class="lineno">  616</span>        (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>)-&gt;USBDeviceClose (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>);</div>
<div class="line"><span class="lineno">  617</span>        (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>)-&gt;Release(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>);</div>
<div class="line"><span class="lineno">  618</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a> = NULL;</div>
<div class="line"><span class="lineno">  619</span>    }</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>    pthread_mutex_destroy(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno">  622</span>    pthread_mutex_destroy(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>);</div>
<div class="line"><span class="lineno">  623</span>    free(c);</div>
<div class="line"><span class="lineno">  624</span>}</div>
<div class="ttc" id="astructusb__connection__t_html_a7757bb115635620bd26cd7a1d42d66ba"><div class="ttname"><a href="structusb__connection__t.html#a7757bb115635620bd26cd7a1d42d66ba">usb_connection_t::device_notification</a></div><div class="ttdeci">io_object_t device_notification</div><div class="ttdef"><b>Definition</b> darwinusb.c:147</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00146">usb_connection_t::device</a>, <a class="el" href="#l00147">usb_connection_t::device_notification</a>, <a class="el" href="#l00156">usb_connection_t::in_pipe_ref</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00158">usb_connection_t::out_pipe_ref</a>, <a class="el" href="#l00139">usb_connection_t::ps</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, and <a class="el" href="#l00142">usb_connection_t::ref_count_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00492">change_refcount()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a7974faab5165fb2b558c2f0f08e921ae_icgraph.png" border="0" usemap="#adarwinusb_8c_a7974faab5165fb2b558c2f0f08e921ae_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a7974faab5165fb2b558c2f0f08e921ae_icgraph" id="adarwinusb_8c_a7974faab5165fb2b558c2f0f08e921ae_icgraph">
<area shape="rect" title=" " alt="" coords="2258,556,2359,582"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="2093,429,2210,455"/>
<area shape="poly" title=" " alt="" coords="2278,548,2167,457,2170,453,2281,544"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="1411,605,1522,631"/>
<area shape="poly" title=" " alt="" coords="2268,591,2211,616,2138,642,2055,663,2012,669,1970,671,1785,671,1712,668,1640,658,1519,634,1520,629,1641,653,1713,662,1785,666,1970,666,2012,664,2054,658,2136,637,2209,611,2266,586"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="1892,404,2045,430"/>
<area shape="poly" title=" " alt="" coords="2076,435,2044,430,2045,425,2077,429"/>
<area shape="rect" href="darwinusb_8c.html#a20220d60460da3af89e8e25bec84a595" title=" " alt="" coords="1758,353,1814,379"/>
<area shape="poly" title=" " alt="" coords="2113,424,2080,407,2044,394,1980,380,1916,373,1814,368,1814,363,1917,367,1981,375,2045,389,2082,402,2116,419"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="1904,605,2033,631"/>
<area shape="poly" title=" " alt="" coords="2140,470,2104,533,2078,567,2046,596,2027,607,2024,602,2043,592,2074,564,2100,530,2136,468"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="1926,556,2011,582"/>
<area shape="poly" title=" " alt="" coords="2129,468,2092,504,2046,539,2009,558,2007,553,2043,535,2089,500,2126,464"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="1728,556,1844,582"/>
<area shape="poly" title=" " alt="" coords="2107,464,2046,489,1932,528,1834,558,1833,553,1930,523,2044,484,2105,459"/>
<area shape="rect" href="darwinusb_8c.html#ad04208dd4d06c0f62d2ba47da8269257" title=" " alt="" coords="1433,455,1500,480"/>
<area shape="poly" title=" " alt="" coords="2077,448,1500,469,1500,464,2077,442"/>
<area shape="rect" href="darwinusb_8c.html#ab042613c0c2ec32c60dbc9b0c5f03b75" title=" " alt="" coords="1292,201,1355,227"/>
<area shape="poly" title=" " alt="" coords="2137,416,2102,349,2075,314,2043,284,1979,245,1924,225,1864,218,1787,217,1628,217,1356,217,1356,212,1628,212,1788,212,1864,212,1925,220,1982,240,2046,280,2079,311,2106,347,2142,414"/>
<area shape="rect" href="darwinusb_8c.html#a8c4b6061f971ce2de3b2f581a87f3751" title=" " alt="" coords="1599,252,1659,278"/>
<area shape="poly" title=" " alt="" coords="2132,418,2096,370,2071,346,2043,327,1993,304,1939,288,1884,276,1830,269,1731,263,1659,265,1659,260,1731,258,1830,263,1885,271,1940,283,1995,299,2046,323,2075,342,2100,366,2137,414"/>
<area shape="rect" href="darwinusb_8c.html#a62be9dca709b9fa802954d73d21ab332" title=" " alt="" coords="1597,303,1660,328"/>
<area shape="poly" title=" " alt="" coords="2125,421,2089,390,2044,365,1992,347,1937,334,1829,319,1732,315,1661,316,1661,311,1732,309,1829,314,1938,329,1993,342,2046,360,2092,386,2129,417"/>
<area shape="poly" title=" " alt="" coords="1904,402,1813,376,1815,371,1905,397"/>
<area shape="rect" href="darwinusb_8c.html#a392c406126a2b42d4c9279a1664111ef" title=" " alt="" coords="1403,404,1530,430"/>
<area shape="poly" title=" " alt="" coords="1877,420,1530,420,1530,414,1877,414"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,353,1244,379"/>
<area shape="poly" title=" " alt="" coords="1743,369,1245,369,1245,364,1743,364"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,353,1082,379"/>
<area shape="poly" title=" " alt="" coords="1114,369,1082,369,1082,364,1114,364"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,353,929,379"/>
<area shape="poly" title=" " alt="" coords="962,369,930,369,930,364,962,364"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,256,772,282"/>
<area shape="poly" title=" " alt="" coords="847,347,759,284,762,280,850,342"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,403,783,428"/>
<area shape="poly" title=" " alt="" coords="828,387,780,405,779,400,826,382"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,231,640,256"/>
<area shape="poly" title=" " alt="" coords="694,264,640,255,640,249,695,259"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,280,637,306"/>
<area shape="poly" title=" " alt="" coords="694,279,637,288,637,283,694,273"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,329,637,355"/>
<area shape="poly" title=" " alt="" coords="705,292,652,321,627,331,625,326,650,316,703,288"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,132,633,158"/>
<area shape="poly" title=" " alt="" coords="720,245,689,207,649,171,630,161,633,156,652,167,693,203,724,241"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,181,625,207"/>
<area shape="poly" title=" " alt="" coords="704,250,650,221,624,210,626,205,652,216,707,245"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,322,476,362"/>
<area shape="poly" title=" " alt="" coords="523,345,477,345,477,340,523,340"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,203,436,228"/>
<area shape="poly" title=" " alt="" coords="538,166,525,171,477,194,438,208,436,203,475,189,523,166,536,161"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,252,450,278"/>
<area shape="poly" title=" " alt="" coords="530,168,526,171,511,188,503,206,495,225,478,243,452,257,450,252,475,239,490,222,498,204,506,186,523,167,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,5,435,31"/>
<area shape="poly" title=" " alt="" coords="564,122,525,82,475,44,435,28,437,23,478,40,528,78,567,118"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,55,424,80"/>
<area shape="poly" title=" " alt="" coords="547,127,475,94,424,77,426,72,477,89,549,122"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,104,424,130"/>
<area shape="poly" title=" " alt="" coords="526,138,424,123,425,118,527,133"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,153,424,179"/>
<area shape="poly" title=" " alt="" coords="527,154,425,166,424,161,526,149"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,228,273,254"/>
<area shape="poly" title=" " alt="" coords="333,258,273,250,274,245,334,253"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,277,275,303"/>
<area shape="poly" title=" " alt="" coords="334,277,276,286,275,280,333,272"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,253,127,279"/>
<area shape="poly" title=" " alt="" coords="162,254,128,259,127,254,161,248"/>
<area shape="poly" title=" " alt="" coords="159,283,126,278,127,273,160,278"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,5,250,31"/>
<area shape="poly" title=" " alt="" coords="348,21,250,21,250,16,348,16"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,477,651,503"/>
<area shape="poly" title=" " alt="" coords="707,439,652,469,627,479,625,474,650,464,704,434"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,379,612,404"/>
<area shape="poly" title=" " alt="" coords="683,409,612,398,613,393,684,404"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,428,612,454"/>
<area shape="poly" title=" " alt="" coords="684,428,613,439,612,434,683,422"/>
<area shape="poly" title=" " alt="" coords="1388,405,1244,379,1245,374,1388,400"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="1736,605,1837,631"/>
<area shape="poly" title=" " alt="" coords="1888,621,1837,621,1837,616,1888,616"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="1578,605,1680,631"/>
<area shape="poly" title=" " alt="" coords="1720,621,1680,621,1680,616,1720,616"/>
<area shape="poly" title=" " alt="" coords="1562,621,1522,621,1522,616,1562,616"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,555,1355,580"/>
<area shape="poly" title=" " alt="" coords="1413,602,1355,581,1357,576,1415,597"/>
<area shape="poly" title=" " alt="" coords="1303,543,1195,381,1199,378,1307,540"/>
<area shape="poly" title=" " alt="" coords="1912,587,1837,607,1836,602,1910,582"/>
<area shape="poly" title=" " alt="" coords="1910,580,1845,580,1845,575,1910,575"/>
<area shape="poly" title=" " alt="" coords="1860,557,1926,558,1925,564,1860,563"/>
<area shape="poly" title=" " alt="" coords="1418,453,1224,382,1226,377,1420,448"/>
<area shape="poly" title=" " alt="" coords="1301,240,1294,248,1202,354,1197,351,1290,244,1297,236"/>
<area shape="poly" title=" " alt="" coords="1584,273,1452,293,1372,309,1293,329,1219,355,1218,350,1291,324,1371,304,1451,288,1583,268"/>
<area shape="poly" title=" " alt="" coords="1582,321,1452,332,1292,350,1245,358,1244,353,1292,345,1451,327,1581,316"/>
</map>
</div>

</div>
</div>
<a id="a18148cdc8c3dbba549e8a762a791bc0e" name="a18148cdc8c3dbba549e8a762a791bc0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18148cdc8c3dbba549e8a762a791bc0e">&#9670;&#160;</a></span>u_changebaud()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_changebaud </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1931</span>{</div>
<div class="line"><span class="lineno"> 1932</span>    <span class="comment">/* Change the baud rate. This is only useful for serial-to-USB adapters,</span></div>
<div class="line"><span class="lineno"> 1933</span><span class="comment">     * as these adapters need to know which rate we use to talk to the device.</span></div>
<div class="line"><span class="lineno"> 1934</span><span class="comment">     * We currently only support the PalmConnect USB adapter.</span></div>
<div class="line"><span class="lineno"> 1935</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno"> 1936</span>    pi_usb_data_t *data = (pi_usb_data_t *)ps-&gt;device-&gt;data;</div>
<div class="line"><span class="lineno"> 1937</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = data-&gt;ref;</div>
<div class="line"><span class="lineno"> 1938</span>    <span class="keywordflow">if</span> (c == NULL)</div>
<div class="line"><span class="lineno"> 1939</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1940</span> </div>
<div class="line"><span class="lineno"> 1941</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_changebaud(ps=%p, c=%p, rate=%d)\n&quot;</span>, ps, c, data-&gt;rate));</div>
<div class="line"><span class="lineno"> 1942</span> </div>
<div class="line"><span class="lineno"> 1943</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aafae79b6a22926854b79c987d784db2d">vendorID</a> == <a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a43b0eb165838e76a61358dc70072e62b">productID</a> == <a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno"> 1944</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="#a75b8e770479707f2ca65619e5e15248b">klsi_set_portspeed</a>(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>, data-&gt;rate);</div>
<div class="line"><span class="lineno"> 1945</span> </div>
<div class="line"><span class="lineno"> 1946</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1947</span>}</div>
<div class="ttc" id="anamespacepisock_html_a7daabad696d8aaead5c479df2850eb92"><div class="ttname"><a href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">pisock.PI_ERR_SOCK_DISCONNECTED</a></div><div class="ttdeci">PI_ERR_SOCK_DISCONNECTED</div><div class="ttdef"><b>Definition</b> pisock.py:46</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00146">usb_connection_t::device</a>, <a class="el" href="#l01342">klsi_set_portspeed()</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_cgraph.png" border="0" usemap="#adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_cgraph" id="adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,111,31"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="159,5,289,31"/>
<area shape="poly" title=" " alt="" coords="111,16,143,16,143,21,111,21"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="337,5,447,31"/>
<area shape="poly" title=" " alt="" coords="289,16,321,16,321,21,289,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_icgraph.png" border="0" usemap="#adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_icgraph" id="adarwinusb_8c_a18148cdc8c3dbba549e8a762a791bc0e_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1397,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1244,258,1244,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="ad04208dd4d06c0f62d2ba47da8269257" name="ad04208dd4d06c0f62d2ba47da8269257"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad04208dd4d06c0f62d2ba47da8269257">&#9670;&#160;</a></span>u_close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1622</span>{</div>
<div class="line"><span class="lineno"> 1623</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref;</div>
<div class="line"><span class="lineno"> 1624</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_close(ps=%p c=%p\n&quot;</span>,ps,c));</div>
<div class="line"><span class="lineno"> 1625</span>    <span class="keywordflow">if</span> (c &amp;&amp; <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, 1) &gt; 0) </div>
<div class="line"><span class="lineno"> 1626</span>    {</div>
<div class="line"><span class="lineno"> 1627</span>        <span class="comment">// @@@ TODO: for KLSI, we should set total_bytes_read to 0 so that next time we receive data,</span></div>
<div class="line"><span class="lineno"> 1628</span>        <span class="comment">// @@@ a new connection is declared `live&#39;</span></div>
<div class="line"><span class="lineno"> 1629</span>        <span class="comment">//if (c-&gt;vendorID == VENDOR_PALMONE &amp;&amp; c-&gt;productID == PRODUCT_PALMCONNECT_USB)</span></div>
<div class="line"><span class="lineno"> 1630</span>        <span class="comment">//  control_request(c-&gt;device, 0x40, KLSI_SET_HANDSHAKE_LINES, KLSI_SETHS_RTS, 0, NULL, 0);</span></div>
<div class="line"><span class="lineno"> 1631</span> </div>
<div class="line"><span class="lineno"> 1632</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a> = 0;      <span class="comment">/* set opened to 0 so that other threads don&#39;t try to acquire this connection, as it is on the way out */</span></div>
<div class="line"><span class="lineno"> 1633</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a715fe784af3cb29d86252c388dce4be3">total_bytes_read</a> = 0;</div>
<div class="line"><span class="lineno"> 1634</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a4dfdddaa87057cdc153853a82827b85c">total_bytes_written</a> = 0;</div>
<div class="line"><span class="lineno"> 1635</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a69437af107eea378fe9b96e041cfadd2">ps</a> = NULL;</div>
<div class="line"><span class="lineno"> 1636</span>        <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -2); <span class="comment">/* decrement current refcount + disconnect */</span></div>
<div class="line"><span class="lineno"> 1637</span>    }</div>
<div class="line"><span class="lineno"> 1638</span>    <span class="keywordflow">return</span> close(ps-&gt;sd);</div>
<div class="line"><span class="lineno"> 1639</span>}</div>
<div class="ttc" id="astructusb__connection__t_html_a4dfdddaa87057cdc153853a82827b85c"><div class="ttname"><a href="structusb__connection__t.html#a4dfdddaa87057cdc153853a82827b85c">usb_connection_t::total_bytes_written</a></div><div class="ttdeci">unsigned long total_bytes_written</div><div class="ttdef"><b>Definition</b> darwinusb.c:167</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00139">usb_connection_t::ps</a>, <a class="el" href="#l00166">usb_connection_t::total_bytes_read</a>, <a class="el" href="#l00167">usb_connection_t::total_bytes_written</a>, and <a class="el" href="#l00106">ULOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_cgraph.png" border="0" usemap="#adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_cgraph" alt=""/></div>
<map name="adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_cgraph" id="adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,72,56"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="120,31,237,56"/>
<area shape="poly" title=" " alt="" coords="72,41,104,41,104,46,72,46"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="285,5,419,31"/>
<area shape="poly" title=" " alt="" coords="237,32,269,28,270,33,238,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="302,55,403,80"/>
<area shape="poly" title=" " alt="" coords="238,49,286,56,286,61,237,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_icgraph.png" border="0" usemap="#adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_icgraph" id="adarwinusb_8c_ad04208dd4d06c0f62d2ba47da8269257_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1358,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1244,258,1244,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="ab042613c0c2ec32c60dbc9b0c5f03b75" name="ab042613c0c2ec32c60dbc9b0c5f03b75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab042613c0c2ec32c60dbc9b0c5f03b75">&#9670;&#160;</a></span>u_flush()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_flush </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1579</span>{</div>
<div class="line"><span class="lineno"> 1580</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref;</div>
<div class="line"><span class="lineno"> 1581</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, +1) &lt;= 0)</div>
<div class="line"><span class="lineno"> 1582</span>        <span class="keywordflow">return</span> PI_ERR_SOCK_DISCONNECTED;</div>
<div class="line"><span class="lineno"> 1583</span>    <span class="keywordflow">if</span> (!c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a>)</div>
<div class="line"><span class="lineno"> 1584</span>    {</div>
<div class="line"><span class="lineno"> 1585</span>        <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1586</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1587</span>    }</div>
<div class="line"><span class="lineno"> 1588</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> &amp; PI_FLUSH_INPUT)</div>
<div class="line"><span class="lineno"> 1589</span>    {</div>
<div class="line"><span class="lineno"> 1590</span>        pthread_mutex_lock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1591</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> = 0;</div>
<div class="line"><span class="lineno"> 1592</span>        pthread_mutex_unlock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1593</span>    }</div>
<div class="line"><span class="lineno"> 1594</span>    <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1595</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1596</span>}</div>
<div class="ttc" id="astructusb__connection__t_html_a7f79224b1601f5c6cc6a0f7828ab919d"><div class="ttname"><a href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">usb_connection_t::read_queue_used</a></div><div class="ttdeci">size_t read_queue_used</div><div class="ttdef"><b>Definition</b> darwinusb.c:173</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00311">flags</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, and <a class="el" href="#l00173">usb_connection_t::read_queue_used</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_cgraph.png" border="0" usemap="#adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_cgraph" alt=""/></div>
<map name="adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_cgraph" id="adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,69,56"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="117,31,234,56"/>
<area shape="poly" title=" " alt="" coords="69,41,101,41,101,46,69,46"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="282,5,416,31"/>
<area shape="poly" title=" " alt="" coords="234,32,266,28,267,33,235,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="298,55,400,80"/>
<area shape="poly" title=" " alt="" coords="235,49,283,56,283,61,234,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_icgraph.png" border="0" usemap="#adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_icgraph" id="adarwinusb_8c_ab042613c0c2ec32c60dbc9b0c5f03b75_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="aad2542bd9cbedf6534bc2443fea26657" name="aad2542bd9cbedf6534bc2443fea26657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad2542bd9cbedf6534bc2443fea26657">&#9670;&#160;</a></span>u_open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pi_sockaddr *</td>          <td class="paramname"><span class="paramname"><em>addr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>addrlen</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1600</span>{</div>
<div class="line"><span class="lineno"> 1601</span>    pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno"> 1602</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a> == 0)</div>
<div class="line"><span class="lineno"> 1603</span>    {</div>
<div class="line"><span class="lineno"> 1604</span>        <span class="comment">/* thread doesn&#39;t exist yet: create it and wait for</span></div>
<div class="line"><span class="lineno"> 1605</span><span class="comment">         * the init phase to be either successful or failed</span></div>
<div class="line"><span class="lineno"> 1606</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno"> 1607</span>        pthread_create(&amp;<a class="code hl_variable" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a>, NULL, <a class="code hl_function" href="#ae063014a517d3d5d8b74a3b7348349f3">usb_thread_run</a>, NULL);</div>
<div class="line"><span class="lineno"> 1608</span>        pthread_cond_wait(&amp;<a class="code hl_variable" href="#aba17cac29b694d3e604d4b608228c8c1">usb_thread_ready_cond</a>, &amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno"> 1609</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno"> 1610</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a> != 0)</div>
<div class="line"><span class="lineno"> 1611</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1612</span> </div>
<div class="line"><span class="lineno"> 1613</span>        errno = EINVAL;</div>
<div class="line"><span class="lineno"> 1614</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="socket_8c.html#a415df518818c6813556c5607b29e833e">pi_set_error</a>(ps-&gt;sd, PI_ERR_GENERIC_SYSTEM);</div>
<div class="line"><span class="lineno"> 1615</span>    }</div>
<div class="line"><span class="lineno"> 1616</span>    pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno"> 1617</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1618</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a4622ae4614d20e142779408a7f8c7825"><div class="ttname"><a href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a></div><div class="ttdeci">static pthread_t usb_thread</div><div class="ttdef"><b>Definition</b> darwinusb.c:133</div></div>
<div class="ttc" id="adarwinusb_8c_html_a4f2c71376203c7c3c34d2adc0d1c8acd"><div class="ttname"><a href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a></div><div class="ttdeci">static pthread_mutex_t usb_thread_ready_mutex</div><div class="ttdef"><b>Definition</b> darwinusb.c:129</div></div>
<div class="ttc" id="adarwinusb_8c_html_aba17cac29b694d3e604d4b608228c8c1"><div class="ttname"><a href="#aba17cac29b694d3e604d4b608228c8c1">usb_thread_ready_cond</a></div><div class="ttdeci">static pthread_cond_t usb_thread_ready_cond</div><div class="ttdef"><b>Definition</b> darwinusb.c:130</div></div>
<div class="ttc" id="adarwinusb_8c_html_ae063014a517d3d5d8b74a3b7348349f3"><div class="ttname"><a href="#ae063014a517d3d5d8b74a3b7348349f3">usb_thread_run</a></div><div class="ttdeci">static void * usb_thread_run(void *foo)</div><div class="ttdef"><b>Definition</b> darwinusb.c:627</div></div>
<div class="ttc" id="asocket_8c_html_a415df518818c6813556c5607b29e833e"><div class="ttname"><a href="socket_8c.html#a415df518818c6813556c5607b29e833e">pi_set_error</a></div><div class="ttdeci">int pi_set_error(int pi_sd, int error_code)</div><div class="ttdef"><b>Definition</b> socket.c:1625</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l01625">pi_set_error()</a>, <a class="el" href="#l00133">usb_thread</a>, <a class="el" href="#l00130">usb_thread_ready_cond</a>, <a class="el" href="#l00129">usb_thread_ready_mutex</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_cgraph.png" border="0" usemap="#adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_cgraph" alt=""/></div>
<map name="adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_cgraph" id="adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_cgraph">
<area shape="rect" title=" " alt="" coords="5,233,69,259"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="127,196,216,222"/>
<area shape="poly" title=" " alt="" coords="69,235,111,223,113,228,70,240"/>
<area shape="rect" href="darwinusb_8c.html#ae063014a517d3d5d8b74a3b7348349f3" title=" " alt="" coords="117,257,227,283"/>
<area shape="poly" title=" " alt="" coords="70,249,102,255,101,260,69,254"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="275,172,380,198"/>
<area shape="poly" title=" " alt="" coords="217,199,260,193,260,198,217,205"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="435,159,541,184"/>
<area shape="poly" title=" " alt="" coords="380,178,420,174,420,180,381,183"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="428,208,548,234"/>
<area shape="poly" title=" " alt="" coords="381,194,414,201,412,207,380,199"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="444,109,532,135"/>
<area shape="poly" title=" " alt="" coords="362,169,438,139,440,144,364,174"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="276,257,379,283"/>
<area shape="poly" title=" " alt="" coords="228,268,261,268,261,273,228,273"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="1257,411,1358,436"/>
<area shape="poly" title=" " alt="" coords="187,281,231,325,301,380,344,406,389,427,437,442,487,448,881,448,1078,440,1241,427,1242,433,1078,446,881,453,487,453,436,447,387,432,341,411,298,384,228,329,183,285"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="437,257,539,283"/>
<area shape="poly" title=" " alt="" coords="379,268,422,268,422,273,379,273"/>
<area shape="rect" href="darwinusb_8c.html#ab10d2c139ee0772df628b5e705368986" title=" " alt="" coords="616,129,728,155"/>
<area shape="poly" title=" " alt="" coords="530,255,546,244,562,225,569,205,577,184,594,164,601,159,604,164,597,168,581,187,574,207,566,227,549,248,533,259"/>
<area shape="rect" href="darwinusb_8c.html#ab97608baf2dc20e00693ea3d28b1c5fe" title=" " alt="" coords="616,179,728,204"/>
<area shape="poly" title=" " alt="" coords="524,254,546,244,570,228,594,213,607,208,609,212,597,218,573,233,549,248,526,259"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="613,228,732,254"/>
<area shape="poly" title=" " alt="" coords="539,260,597,250,598,255,539,265"/>
<area shape="rect" href="darwinusb_8c.html#a6378ac6f6b9262ad7cba19de626cd74b" title=" " alt="" coords="596,335,749,360"/>
<area shape="poly" title=" " alt="" coords="514,281,597,321,611,327,610,332,595,326,512,286"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="815,387,944,412"/>
<area shape="poly" title=" " alt="" coords="500,282,539,327,566,351,597,370,647,388,700,398,752,403,799,403,799,408,752,408,699,404,646,393,595,375,563,356,535,331,496,285"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="826,5,933,31"/>
<area shape="poly" title=" " alt="" coords="532,255,546,244,558,228,564,213,569,181,573,148,581,132,594,115,617,95,644,77,700,51,758,33,810,22,811,28,759,38,702,56,646,82,621,99,598,119,585,134,578,150,574,182,570,214,562,231,550,248,535,259"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="630,285,715,311"/>
<area shape="poly" title=" " alt="" coords="539,275,615,287,614,292,539,280"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="1046,135,1157,160"/>
<area shape="poly" title=" " alt="" coords="722,225,796,206,1030,158,1031,163,798,211,723,230"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="814,120,945,146"/>
<area shape="poly" title=" " alt="" coords="727,225,748,215,762,202,771,190,780,176,795,163,819,150,822,154,799,167,784,180,775,193,766,206,750,219,729,230"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="797,55,962,96"/>
<area shape="poly" title=" " alt="" coords="731,226,747,215,759,202,765,189,771,162,776,134,783,120,795,106,798,103,801,107,799,109,788,123,781,136,776,163,770,191,763,205,751,219,734,230"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="804,220,955,261"/>
<area shape="poly" title=" " alt="" coords="732,238,789,238,789,244,732,244"/>
<area shape="poly" title=" " alt="" coords="945,134,1031,140,1030,146,945,140"/>
<area shape="poly" title=" " alt="" coords="945,94,1046,127,1045,132,944,99"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="1010,55,1193,96"/>
<area shape="poly" title=" " alt="" coords="963,73,995,73,995,78,963,78"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="1260,63,1356,88"/>
<area shape="poly" title=" " alt="" coords="1193,73,1245,73,1245,78,1193,78"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="1423,63,1513,88"/>
<area shape="poly" title=" " alt="" coords="1356,73,1407,73,1407,78,1356,78"/>
<area shape="poly" title=" " alt="" coords="929,217,1054,164,1056,169,931,222"/>
<area shape="poly" title=" " alt="" coords="955,232,1070,213,1132,195,1191,170,1243,136,1283,98,1286,102,1246,140,1194,175,1134,200,1071,218,956,238"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="1043,361,1160,387"/>
<area shape="poly" title=" " alt="" coords="945,389,1027,380,1028,385,945,395"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="1241,361,1375,387"/>
<area shape="poly" title=" " alt="" coords="1161,372,1226,372,1226,377,1161,377"/>
<area shape="poly" title=" " alt="" coords="1159,385,1243,405,1241,410,1158,390"/>
<area shape="poly" title=" " alt="" coords="933,29,1006,48,1005,53,932,34"/>
<area shape="poly" title=" " alt="" coords="933,17,1053,23,1193,41,1252,55,1251,60,1192,46,1052,29,933,22"/>
<area shape="poly" title=" " alt="" coords="716,304,797,321,1028,360,1027,365,797,326,715,310"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="822,285,938,311"/>
<area shape="poly" title=" " alt="" coords="716,303,806,304,806,309,716,308"/>
<area shape="poly" title=" " alt="" coords="921,309,1048,353,1046,358,919,314"/>
<area shape="poly" title=" " alt="" coords="821,293,731,293,731,287,821,287"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_icgraph.png" border="0" usemap="#adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_icgraph" alt=""/></div>
<map name="adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_icgraph" id="adarwinusb_8c_aad2542bd9cbedf6534bc2443fea26657_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a20220d60460da3af89e8e25bec84a595" name="a20220d60460da3af89e8e25bec84a595"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20220d60460da3af89e8e25bec84a595">&#9670;&#160;</a></span>u_poll()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_poll </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1696</span>{</div>
<div class="line"><span class="lineno"> 1697</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = <a class="code hl_function" href="#a7ae745d90757c279ff496b669e7dfff4">connection_for_socket</a>(ps);</div>
<div class="line"><span class="lineno"> 1698</span>    <span class="keywordflow">if</span> (c == NULL)</div>
<div class="line"><span class="lineno"> 1699</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1700</span> </div>
<div class="line"><span class="lineno"> 1701</span>    <span class="keyword">struct </span>timespec to;</div>
<div class="line"><span class="lineno"> 1702</span> </div>
<div class="line"><span class="lineno"> 1703</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_poll(ps=%p c=%p, timeout=%d)\n&quot;</span>,ps,c,timeout));</div>
<div class="line"><span class="lineno"> 1704</span> </div>
<div class="line"><span class="lineno"> 1705</span>    <span class="keywordflow">if</span> (timeout)</div>
<div class="line"><span class="lineno"> 1706</span>    {</div>
<div class="line"><span class="lineno"> 1707</span>        to.tv_sec = timeout / 1000;</div>
<div class="line"><span class="lineno"> 1708</span>        to.tv_nsec = (timeout % 1000) * 1000 * 1000;</div>
<div class="line"><span class="lineno"> 1709</span>    }</div>
<div class="line"><span class="lineno"> 1710</span> </div>
<div class="line"><span class="lineno"> 1711</span>    pthread_mutex_lock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1712</span>    <span class="keywordtype">int</span> available = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>;</div>
<div class="line"><span class="lineno"> 1713</span>    <span class="keywordflow">if</span> (!available)</div>
<div class="line"><span class="lineno"> 1714</span>    {</div>
<div class="line"><span class="lineno"> 1715</span>        <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_poll -&gt; waiting data to be available for c=%p\n&quot;</span>,c));</div>
<div class="line"><span class="lineno"> 1716</span>        <span class="keywordflow">if</span> (timeout)</div>
<div class="line"><span class="lineno"> 1717</span>        {</div>
<div class="line"><span class="lineno"> 1718</span>            <span class="keywordflow">if</span> (pthread_cond_timedwait_relative_np(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">read_queue_data_avail_cond</a>, &amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>, &amp;to) == ETIMEDOUT)</div>
<div class="line"><span class="lineno"> 1719</span>            {</div>
<div class="line"><span class="lineno"> 1720</span>                <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_poll -&gt; data wait timed out\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1721</span>                available = <a class="code hl_variable" href="namespacepisock.html#af8730febc9f5867a626c03aa405e6677">PI_ERR_SOCK_TIMEOUT</a>;</div>
<div class="line"><span class="lineno"> 1722</span>            }</div>
<div class="line"><span class="lineno"> 1723</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1724</span>                available = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>;</div>
<div class="line"><span class="lineno"> 1725</span>        }</div>
<div class="line"><span class="lineno"> 1726</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1727</span>        {</div>
<div class="line"><span class="lineno"> 1728</span>            <span class="comment">/* wait forever for some data to arrive */</span></div>
<div class="line"><span class="lineno"> 1729</span>            pthread_cond_wait(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">read_queue_data_avail_cond</a>, &amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1730</span>            available = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>;</div>
<div class="line"><span class="lineno"> 1731</span>        }</div>
<div class="line"><span class="lineno"> 1732</span>    }</div>
<div class="line"><span class="lineno"> 1733</span>    pthread_mutex_unlock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1734</span>    <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1735</span> </div>
<div class="line"><span class="lineno"> 1736</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_poll -&gt; end, c=%p, result=%d\n&quot;</span>,c,available));</div>
<div class="line"><span class="lineno"> 1737</span> </div>
<div class="line"><span class="lineno"> 1738</span>    <span class="keywordflow">return</span> available;</div>
<div class="line"><span class="lineno"> 1739</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a7ae745d90757c279ff496b669e7dfff4"><div class="ttname"><a href="#a7ae745d90757c279ff496b669e7dfff4">connection_for_socket</a></div><div class="ttdeci">static usb_connection_t * connection_for_socket(pi_socket_t *ps)</div><div class="ttdef"><b>Definition</b> darwinusb.c:467</div></div>
<div class="ttc" id="anamespacepisock_html_af8730febc9f5867a626c03aa405e6677"><div class="ttname"><a href="namespacepisock.html#af8730febc9f5867a626c03aa405e6677">pisock.PI_ERR_SOCK_TIMEOUT</a></div><div class="ttdeci">PI_ERR_SOCK_TIMEOUT</div><div class="ttdef"><b>Definition</b> pisock.py:48</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00467">connection_for_socket()</a>, <a class="el" href="#l00170">usb_connection_t::read_queue_data_avail_cond</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, <a class="el" href="#l00173">usb_connection_t::read_queue_used</a>, and <a class="el" href="#l00106">ULOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a20220d60460da3af89e8e25bec84a595_cgraph.png" border="0" usemap="#adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_cgraph" id="adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,61,56"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="309,31,426,56"/>
<area shape="poly" title=" " alt="" coords="61,41,294,41,294,46,61,46"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="109,56,261,82"/>
<area shape="poly" title=" " alt="" coords="61,45,94,51,93,56,61,51"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="474,5,609,31"/>
<area shape="poly" title=" " alt="" coords="427,32,459,28,459,33,427,38"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="491,55,592,80"/>
<area shape="poly" title=" " alt="" coords="427,49,476,56,475,61,427,54"/>
<area shape="poly" title=" " alt="" coords="261,56,293,51,294,56,262,61"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a20220d60460da3af89e8e25bec84a595_icgraph.png" border="0" usemap="#adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_icgraph" id="adarwinusb_8c_a20220d60460da3af89e8e25bec84a595_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1347,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a8c4b6061f971ce2de3b2f581a87f3751" name="a8c4b6061f971ce2de3b2f581a87f3751"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c4b6061f971ce2de3b2f581a87f3751">&#9670;&#160;</a></span>u_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t u_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pi_buffer_t *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1809</span>{</div>
<div class="line"><span class="lineno"> 1810</span>    <span class="keywordtype">int</span> timeout = ((<span class="keyword">struct </span>pi_usb_data *)ps-&gt;device-&gt;data)-&gt;timeout;</div>
<div class="line"><span class="lineno"> 1811</span>    <span class="keywordtype">int</span> timed_out = 0;</div>
<div class="line"><span class="lineno"> 1812</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref;</div>
<div class="line"><span class="lineno"> 1813</span> </div>
<div class="line"><span class="lineno"> 1814</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c,+1)&lt;=0 || !c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a>)</div>
<div class="line"><span class="lineno"> 1815</span>    {</div>
<div class="line"><span class="lineno"> 1816</span>        <span class="comment">/* make sure we report broken connections */</span></div>
<div class="line"><span class="lineno"> 1817</span>        <span class="keywordflow">if</span> (ps-&gt;state == PI_SOCK_CONN_ACCEPT || ps-&gt;state == PI_SOCK_CONN_INIT)</div>
<div class="line"><span class="lineno"> 1818</span>            ps-&gt;state = PI_SOCK_CONN_BREAK;</div>
<div class="line"><span class="lineno"> 1819</span>        <span class="keywordflow">if</span> (c != NULL)</div>
<div class="line"><span class="lineno"> 1820</span>            <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1821</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1822</span>    }</div>
<div class="line"><span class="lineno"> 1823</span> </div>
<div class="line"><span class="lineno"> 1824</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238">pi_buffer_expect</a> (<a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, len) == NULL)</div>
<div class="line"><span class="lineno"> 1825</span>    {</div>
<div class="line"><span class="lineno"> 1826</span>        errno = ENOMEM;</div>
<div class="line"><span class="lineno"> 1827</span>        <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1828</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="socket_8c.html#a415df518818c6813556c5607b29e833e">pi_set_error</a>(ps-&gt;sd, PI_ERR_GENERIC_MEMORY);</div>
<div class="line"><span class="lineno"> 1829</span>    }</div>
<div class="line"><span class="lineno"> 1830</span> </div>
<div class="line"><span class="lineno"> 1831</span><span class="preprocessor">#ifdef DEBUG_USB</span></div>
<div class="line"><span class="lineno"> 1832</span>    <span class="keyword">struct </span>timeval startTime, endTime;</div>
<div class="line"><span class="lineno"> 1833</span>    gettimeofday(&amp;startTime, NULL);</div>
<div class="line"><span class="lineno"> 1834</span>    LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_read(ps=%p, c=%p, len=%d, timeout=%d, flags=%d)\n&quot;</span>, ps, c, (<span class="keywordtype">int</span>)len, timeout, <a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>));</div>
<div class="line"><span class="lineno"> 1835</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1836</span> </div>
<div class="line"><span class="lineno"> 1837</span>    pthread_mutex_lock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1838</span> </div>
<div class="line"><span class="lineno"> 1839</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> == PI_MSG_PEEK &amp;&amp; len &gt; 256)</div>
<div class="line"><span class="lineno"> 1840</span>        len = 256;</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> &lt; len)</div>
<div class="line"><span class="lineno"> 1843</span>    {</div>
<div class="line"><span class="lineno"> 1844</span>        <span class="keyword">struct </span>timeval now;</div>
<div class="line"><span class="lineno"> 1845</span>        <span class="keyword">struct </span>timespec when;</div>
<div class="line"><span class="lineno"> 1846</span>        gettimeofday(&amp;now, NULL);</div>
<div class="line"><span class="lineno"> 1847</span>        when.tv_sec = now.tv_sec + timeout / 1000;</div>
<div class="line"><span class="lineno"> 1848</span>        when.tv_nsec = now.tv_usec + (timeout % 1000) * 1000 * 1000;</div>
<div class="line"><span class="lineno"> 1849</span>        <span class="keywordflow">if</span> (when.tv_nsec &gt;= 1000000000)</div>
<div class="line"><span class="lineno"> 1850</span>        {</div>
<div class="line"><span class="lineno"> 1851</span>            when.tv_nsec -= 1000000000;</div>
<div class="line"><span class="lineno"> 1852</span>            when.tv_sec++;</div>
<div class="line"><span class="lineno"> 1853</span>        }</div>
<div class="line"><span class="lineno"> 1854</span>        <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno"> 1855</span>        {</div>
<div class="line"><span class="lineno"> 1856</span>            <span class="comment">/* next prime_read() will use a bigger read request */</span></div>
<div class="line"><span class="lineno"> 1857</span>            c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7bc061e9a7a9b9f830744ba42263018f">read_ahead_size</a> = len - c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> - c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a08a27442bb3f743caf8a5ffd00503acc">last_read_ahead_size</a>;</div>
<div class="line"><span class="lineno"> 1858</span>            <span class="keywordflow">if</span> (timeout)</div>
<div class="line"><span class="lineno"> 1859</span>            {</div>
<div class="line"><span class="lineno"> 1860</span>                <span class="keywordflow">if</span> (pthread_cond_timedwait(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">read_queue_data_avail_cond</a>, &amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>, &amp;when) == ETIMEDOUT)</div>
<div class="line"><span class="lineno"> 1861</span>                {</div>
<div class="line"><span class="lineno"> 1862</span>                    timed_out = 1;</div>
<div class="line"><span class="lineno"> 1863</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1864</span>                }</div>
<div class="line"><span class="lineno"> 1865</span>            }</div>
<div class="line"><span class="lineno"> 1866</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1867</span>                pthread_cond_wait(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a94f77f42cff14e8e1a1ef7d78a4d2716">read_queue_data_avail_cond</a>, &amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1868</span>        }</div>
<div class="line"><span class="lineno"> 1869</span>        <span class="keywordflow">while</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a> &amp;&amp; (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> &lt; len || (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> == PI_MSG_PEEK &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> &gt;= 256)));</div>
<div class="line"><span class="lineno"> 1870</span> </div>
<div class="line"><span class="lineno"> 1871</span>        c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7bc061e9a7a9b9f830744ba42263018f">read_ahead_size</a> = 0;</div>
<div class="line"><span class="lineno"> 1872</span>    }</div>
<div class="line"><span class="lineno"> 1873</span> </div>
<div class="line"><span class="lineno"> 1874</span>    <span class="keywordflow">if</span> (!c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a>)</div>
<div class="line"><span class="lineno"> 1875</span>    {</div>
<div class="line"><span class="lineno"> 1876</span>        <span class="comment">/* make sure we report broken connections */</span></div>
<div class="line"><span class="lineno"> 1877</span>        <span class="keywordflow">if</span> (ps-&gt;state == PI_SOCK_CONN_ACCEPT || ps-&gt;state == PI_SOCK_CONN_INIT)</div>
<div class="line"><span class="lineno"> 1878</span>            ps-&gt;state = PI_SOCK_CONN_BREAK;</div>
<div class="line"><span class="lineno"> 1879</span>        len = <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1880</span>    }</div>
<div class="line"><span class="lineno"> 1881</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1882</span>    {</div>
<div class="line"><span class="lineno"> 1883</span>        <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> &lt; len)</div>
<div class="line"><span class="lineno"> 1884</span>            len = c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>;</div>
<div class="line"><span class="lineno"> 1885</span> </div>
<div class="line"><span class="lineno"> 1886</span>        <span class="keywordflow">if</span> (len)</div>
<div class="line"><span class="lineno"> 1887</span>        {</div>
<div class="line"><span class="lineno"> 1888</span>            <a class="code hl_function" href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4">pi_buffer_append</a> (<a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">read_queue</a>, len);</div>
<div class="line"><span class="lineno"> 1889</span> </div>
<div class="line"><span class="lineno"> 1890</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a> != PI_MSG_PEEK)</div>
<div class="line"><span class="lineno"> 1891</span>            {</div>
<div class="line"><span class="lineno"> 1892</span>                c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> -= len;</div>
<div class="line"><span class="lineno"> 1893</span>                <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> &gt; 0)</div>
<div class="line"><span class="lineno"> 1894</span>                    memmove(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">read_queue</a>, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">read_queue</a> + len, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>);</div>
<div class="line"><span class="lineno"> 1895</span>                <span class="keywordflow">if</span> ((c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a54eb6f23b568cb0c8415692c053fcbd3">read_queue_size</a> - c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>) &gt; (16L * 65535L))</div>
<div class="line"><span class="lineno"> 1896</span>                {</div>
<div class="line"><span class="lineno"> 1897</span>                    <span class="comment">/* if we have more than 1M free in the read queue, we&#39;d better</span></div>
<div class="line"><span class="lineno"> 1898</span><span class="comment">                     * shrink the buffer</span></div>
<div class="line"><span class="lineno"> 1899</span><span class="comment">                     */</span></div>
<div class="line"><span class="lineno"> 1900</span>                    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a54eb6f23b568cb0c8415692c053fcbd3">read_queue_size</a> = ((c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a> + 0xfffe) &amp; ~0xffff) - 1;</div>
<div class="line"><span class="lineno"> 1901</span>                    c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">read_queue</a> = (<span class="keywordtype">char</span> *) realloc (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">read_queue</a>, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a54eb6f23b568cb0c8415692c053fcbd3">read_queue_size</a>);</div>
<div class="line"><span class="lineno"> 1902</span>                }</div>
<div class="line"><span class="lineno"> 1903</span>            }</div>
<div class="line"><span class="lineno"> 1904</span>        }</div>
<div class="line"><span class="lineno"> 1905</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (timed_out)</div>
<div class="line"><span class="lineno"> 1906</span>            len = <a class="code hl_variable" href="namespacepisock.html#af8730febc9f5867a626c03aa405e6677">PI_ERR_SOCK_TIMEOUT</a>;</div>
<div class="line"><span class="lineno"> 1907</span>    }</div>
<div class="line"><span class="lineno"> 1908</span> </div>
<div class="line"><span class="lineno"> 1909</span><span class="preprocessor">#ifdef DEBUG_USB</span></div>
<div class="line"><span class="lineno"> 1910</span>    <span class="keywordtype">double</span> a,b;</div>
<div class="line"><span class="lineno"> 1911</span>    gettimeofday(&amp;endTime, NULL);</div>
<div class="line"><span class="lineno"> 1912</span>    a = (double)startTime.tv_sec + (<span class="keywordtype">double</span>)startTime.tv_usec / (double)1000000;</div>
<div class="line"><span class="lineno"> 1913</span>    b = (double)endTime.tv_sec + (<span class="keywordtype">double</span>)endTime.tv_usec / (double)1000000;</div>
<div class="line"><span class="lineno"> 1914</span>    <span class="keywordflow">if</span> (len &gt;= 0) {</div>
<div class="line"><span class="lineno"> 1915</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: -&gt; u_read complete (bytes_read=%d, remaining bytes in queue=%d) in %.06fs\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1916</span>             len, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a7f79224b1601f5c6cc6a0f7828ab919d">read_queue_used</a>,b-a));</div>
<div class="line"><span class="lineno"> 1917</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1918</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: -&gt; u_read end with error (err=%d) in %.06fs\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 1919</span>             len,b-a));</div>
<div class="line"><span class="lineno"> 1920</span>    }</div>
<div class="line"><span class="lineno"> 1921</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1922</span> </div>
<div class="line"><span class="lineno"> 1923</span>    pthread_mutex_unlock(&amp;c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ada025c31273ecb90a17a5a5750201d12">read_queue_mutex</a>);</div>
<div class="line"><span class="lineno"> 1924</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1) &lt;= 0)</div>
<div class="line"><span class="lineno"> 1925</span>        len = <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1926</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno"> 1927</span>}</div>
<div class="ttc" id="api-buffer_8c_html_aacd28fae920c743be86733c6ab3c1238"><div class="ttname"><a href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238">pi_buffer_expect</a></div><div class="ttdeci">pi_buffer_t * pi_buffer_expect(pi_buffer_t *buf, size_t expect)</div><div class="ttdef"><b>Definition</b> pi-buffer.c:53</div></div>
<div class="ttc" id="api-buffer_8c_html_aed67e3ff08313fa288837c0d685adaa4"><div class="ttname"><a href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4">pi_buffer_append</a></div><div class="ttdeci">pi_buffer_t * pi_buffer_append(pi_buffer_t *buf, const void *data, size_t len)</div><div class="ttdef"><b>Definition</b> pi-buffer.c:74</div></div>
<div class="ttc" id="apitcl_8c_html_a0dea8f1af961c5e9eb4425acd7c95409"><div class="ttname"><a href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a></div><div class="ttdeci">char buf[0xffff]</div><div class="ttdef"><b>Definition</b> pitcl.c:34</div></div>
<div class="ttc" id="astructusb__connection__t_html_a08a27442bb3f743caf8a5ffd00503acc"><div class="ttname"><a href="structusb__connection__t.html#a08a27442bb3f743caf8a5ffd00503acc">usb_connection_t::last_read_ahead_size</a></div><div class="ttdeci">int last_read_ahead_size</div><div class="ttdef"><b>Definition</b> darwinusb.c:164</div></div>
<div class="ttc" id="astructusb__connection__t_html_a54eb6f23b568cb0c8415692c053fcbd3"><div class="ttname"><a href="structusb__connection__t.html#a54eb6f23b568cb0c8415692c053fcbd3">usb_connection_t::read_queue_size</a></div><div class="ttdeci">size_t read_queue_size</div><div class="ttdef"><b>Definition</b> darwinusb.c:172</div></div>
<div class="ttc" id="astructusb__connection__t_html_a7bc061e9a7a9b9f830744ba42263018f"><div class="ttname"><a href="structusb__connection__t.html#a7bc061e9a7a9b9f830744ba42263018f">usb_connection_t::read_ahead_size</a></div><div class="ttdeci">int read_ahead_size</div><div class="ttdef"><b>Definition</b> darwinusb.c:163</div></div>
<div class="ttc" id="astructusb__connection__t_html_ac24adc6c75afb8395779097fc4e40c9f"><div class="ttname"><a href="structusb__connection__t.html#ac24adc6c75afb8395779097fc4e40c9f">usb_connection_t::read_queue</a></div><div class="ttdeci">char * read_queue</div><div class="ttdef"><b>Definition</b> darwinusb.c:171</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00034">buf</a>, <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00311">flags</a>, <a class="el" href="#l00164">usb_connection_t::last_read_ahead_size</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00074">pi_buffer_append()</a>, <a class="el" href="#l00053">pi_buffer_expect()</a>, <a class="el" href="#l01625">pi_set_error()</a>, <a class="el" href="#l00163">usb_connection_t::read_ahead_size</a>, <a class="el" href="#l00171">usb_connection_t::read_queue</a>, <a class="el" href="#l00170">usb_connection_t::read_queue_data_avail_cond</a>, <a class="el" href="#l00169">usb_connection_t::read_queue_mutex</a>, <a class="el" href="#l00172">usb_connection_t::read_queue_size</a>, and <a class="el" href="#l00173">usb_connection_t::read_queue_used</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_cgraph.png" border="0" usemap="#adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_cgraph" id="adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_cgraph">
<area shape="rect" title=" " alt="" coords="5,104,66,130"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="115,29,232,55"/>
<area shape="poly" title=" " alt="" coords="53,101,112,64,122,59,124,64,115,68,56,106"/>
<area shape="rect" href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4" title=" " alt="" coords="114,79,234,104"/>
<area shape="poly" title=" " alt="" coords="66,109,98,103,99,108,67,114"/>
<area shape="rect" href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238" title=" " alt="" coords="290,129,408,155"/>
<area shape="poly" title=" " alt="" coords="66,117,275,134,275,139,66,122"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="129,180,218,206"/>
<area shape="poly" title=" " alt="" coords="61,128,115,159,136,170,133,175,112,163,59,133"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="282,5,416,31"/>
<area shape="poly" title=" " alt="" coords="233,31,266,27,267,32,234,37"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="298,55,400,80"/>
<area shape="poly" title=" " alt="" coords="234,48,284,55,283,61,233,53"/>
<area shape="poly" title=" " alt="" coords="222,102,288,122,287,127,220,108"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="296,180,402,206"/>
<area shape="poly" title=" " alt="" coords="219,190,281,190,281,196,219,196"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="471,131,577,156"/>
<area shape="poly" title=" " alt="" coords="397,177,460,159,462,164,398,182"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="464,180,584,206"/>
<area shape="poly" title=" " alt="" coords="402,190,448,190,448,196,402,196"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="480,229,568,255"/>
<area shape="poly" title=" " alt="" coords="398,204,466,223,464,228,397,209"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_icgraph.png" border="0" usemap="#adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_icgraph" id="adarwinusb_8c_a8c4b6061f971ce2de3b2f581a87f3751_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1352,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1244,258,1244,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a392c406126a2b42d4c9279a1664111ef" name="a392c406126a2b42d4c9279a1664111ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a392c406126a2b42d4c9279a1664111ef">&#9670;&#160;</a></span>u_wait_for_device()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int u_wait_for_device </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1643</span>{</div>
<div class="line"><span class="lineno"> 1644</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = <a class="code hl_function" href="#a7ae745d90757c279ff496b669e7dfff4">connection_for_socket</a>(ps);</div>
<div class="line"><span class="lineno"> 1645</span>    <span class="keyword">struct </span>timespec to, to_expiration;</div>
<div class="line"><span class="lineno"> 1646</span> </div>
<div class="line"><span class="lineno"> 1647</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_wait_for_device(ps=%p c=%p, timeout=%d)\n&quot;</span>,ps,c,timeout ? *timeout : 0));</div>
<div class="line"><span class="lineno"> 1648</span> </div>
<div class="line"><span class="lineno"> 1649</span>    <span class="keywordflow">if</span> (timeout &amp;&amp; *timeout)</div>
<div class="line"><span class="lineno"> 1650</span>    {</div>
<div class="line"><span class="lineno"> 1651</span>        <a class="code hl_function" href="utils_8c.html#a4559cac87d5ac7bbcb747ccf727888fb">pi_timeout_to_timespec</a>(*timeout, &amp;to_expiration);</div>
<div class="line"><span class="lineno"> 1652</span>        to.tv_sec = *timeout / 1000;</div>
<div class="line"><span class="lineno"> 1653</span>        to.tv_nsec = (*timeout % 1000) * 1000 * 1000;</div>
<div class="line"><span class="lineno"> 1654</span>    }</div>
<div class="line"><span class="lineno"> 1655</span> </div>
<div class="line"><span class="lineno"> 1656</span>    <span class="keywordflow">if</span> (c == NULL)</div>
<div class="line"><span class="lineno"> 1657</span>    {</div>
<div class="line"><span class="lineno"> 1658</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_wait_for_device -&gt; waiting for a connection to come up\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1659</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1660</span>        <span class="keywordflow">if</span> (timeout &amp;&amp; *timeout)</div>
<div class="line"><span class="lineno"> 1661</span>        {</div>
<div class="line"><span class="lineno"> 1662</span>            <span class="keywordflow">if</span> (pthread_cond_timedwait_relative_np(&amp;<a class="code hl_variable" href="#a8236dfde083ec56b0a613afbecf88237">usb_connection_added_cond</a>, &amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>, &amp;to) == ETIMEDOUT)</div>
<div class="line"><span class="lineno"> 1663</span><span class="comment">//          if (pthread_cond_timedwait(&amp;usb_connection_added_cond, &amp;usb_connections_mutex, &amp;when) == ETIMEDOUT)</span></div>
<div class="line"><span class="lineno"> 1664</span>            {</div>
<div class="line"><span class="lineno"> 1665</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_wait_for_device -&gt; connection wait timed out\n&quot;</span>));</div>
<div class="line"><span class="lineno"> 1666</span>                pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1667</span>                <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#af8730febc9f5867a626c03aa405e6677">PI_ERR_SOCK_TIMEOUT</a>;</div>
<div class="line"><span class="lineno"> 1668</span>            }</div>
<div class="line"><span class="lineno"> 1669</span>        }</div>
<div class="line"><span class="lineno"> 1670</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1671</span>            pthread_cond_wait(&amp;<a class="code hl_variable" href="#a8236dfde083ec56b0a613afbecf88237">usb_connection_added_cond</a>, &amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1672</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno"> 1673</span> </div>
<div class="line"><span class="lineno"> 1674</span>        c = <a class="code hl_function" href="#a7ae745d90757c279ff496b669e7dfff4">connection_for_socket</a>(ps);</div>
<div class="line"><span class="lineno"> 1675</span> </div>
<div class="line"><span class="lineno"> 1676</span>        <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_wait_for_device -&gt; end of wait, c=%p\n&quot;</span>,c));</div>
<div class="line"><span class="lineno"> 1677</span>        <span class="keywordflow">if</span> (c &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aafae79b6a22926854b79c987d784db2d">vendorID</a>==<a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a43b0eb165838e76a61358dc70072e62b">productID</a>==<a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno"> 1678</span>        {</div>
<div class="line"><span class="lineno"> 1679</span>            <span class="comment">/* when working with a PalmConnect USB, make sure we use the right speed </span></div>
<div class="line"><span class="lineno"> 1680</span><span class="comment">             * then let the adapter send us data</span></div>
<div class="line"><span class="lineno"> 1681</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno"> 1682</span>            <a class="code hl_function" href="#a75b8e770479707f2ca65619e5e15248b">klsi_set_portspeed</a>(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a15cef2af78c20d8458a10dca6fd3fc47">device</a>, ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;rate);</div>
<div class="line"><span class="lineno"> 1683</span>        }</div>
<div class="line"><span class="lineno"> 1684</span> </div>
<div class="line"><span class="lineno"> 1685</span>        <span class="keywordflow">if</span> (timeout &amp;&amp; *timeout)</div>
<div class="line"><span class="lineno"> 1686</span>        {</div>
<div class="line"><span class="lineno"> 1687</span>            <span class="comment">/* if there was a timeout, compute the remaining timeout time */</span></div>
<div class="line"><span class="lineno"> 1688</span>            *timeout = <a class="code hl_function" href="utils_8c.html#ae9c540cf47354917fa685d6b010d94f7">pi_timespec_to_timeout</a>(&amp;to_expiration);</div>
<div class="line"><span class="lineno"> 1689</span>        }</div>
<div class="line"><span class="lineno"> 1690</span>    }</div>
<div class="line"><span class="lineno"> 1691</span>    <span class="keywordflow">return</span> (c != NULL);</div>
<div class="line"><span class="lineno"> 1692</span>}</div>
<div class="ttc" id="autils_8c_html_a4559cac87d5ac7bbcb747ccf727888fb"><div class="ttname"><a href="utils_8c.html#a4559cac87d5ac7bbcb747ccf727888fb">pi_timeout_to_timespec</a></div><div class="ttdeci">void pi_timeout_to_timespec(int timeout, struct timespec *ts)</div><div class="ttdef"><b>Definition</b> utils.c:372</div></div>
<div class="ttc" id="autils_8c_html_ae9c540cf47354917fa685d6b010d94f7"><div class="ttname"><a href="utils_8c.html#ae9c540cf47354917fa685d6b010d94f7">pi_timespec_to_timeout</a></div><div class="ttdeci">int pi_timespec_to_timeout(const struct timespec *ts)</div><div class="ttdef"><b>Definition</b> utils.c:385</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00467">connection_for_socket()</a>, <a class="el" href="#l00146">usb_connection_t::device</a>, <a class="el" href="#l01342">klsi_set_portspeed()</a>, <a class="el" href="#l00372">pi_timeout_to_timespec()</a>, <a class="el" href="#l00385">pi_timespec_to_timeout()</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00106">ULOG</a>, <a class="el" href="#l00132">usb_connection_added_cond</a>, <a class="el" href="#l00131">usb_connections_mutex</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a392c406126a2b42d4c9279a1664111ef_cgraph.png" border="0" usemap="#adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_cgraph" id="adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_cgraph">
<area shape="rect" title=" " alt="" coords="5,104,132,130"/>
<area shape="rect" href="darwinusb_8c.html#a7ae745d90757c279ff496b669e7dfff4" title=" " alt="" coords="183,29,336,55"/>
<area shape="poly" title=" " alt="" coords="95,101,179,64,195,58,197,63,181,69,97,106"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="194,79,324,104"/>
<area shape="poly" title=" " alt="" coords="132,106,179,99,179,105,132,111"/>
<area shape="rect" href="utils_8c.html#a4559cac87d5ac7bbcb747ccf727888fb" title=" " alt="" coords="180,128,339,154"/>
<area shape="poly" title=" " alt="" coords="132,122,165,126,164,132,132,127"/>
<area shape="rect" href="utils_8c.html#ae9c540cf47354917fa685d6b010d94f7" title=" " alt="" coords="180,177,339,203"/>
<area shape="poly" title=" " alt="" coords="98,128,181,164,197,170,196,175,179,169,96,133"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="387,29,504,55"/>
<area shape="poly" title=" " alt="" coords="336,40,371,40,371,45,336,45"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="552,5,687,31"/>
<area shape="poly" title=" " alt="" coords="505,31,537,27,537,32,505,37"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="569,55,670,80"/>
<area shape="poly" title=" " alt="" coords="505,48,554,55,553,61,505,53"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="390,79,501,104"/>
<area shape="poly" title=" " alt="" coords="325,89,375,89,375,94,325,94"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a392c406126a2b42d4c9279a1664111ef_icgraph.png" border="0" usemap="#adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_icgraph" id="adarwinusb_8c_a392c406126a2b42d4c9279a1664111ef_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1418,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1277,258,1245,258,1245,252,1277,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="a62be9dca709b9fa802954d73d21ab332" name="a62be9dca709b9fa802954d73d21ab332"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62be9dca709b9fa802954d73d21ab332">&#9670;&#160;</a></span>u_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t u_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="socket_8c.html#aa2d1d1b59340099588ea7bc15508745b">pi_socket</a> *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno"> 1743</span>{</div>
<div class="line"><span class="lineno"> 1744</span>    IOReturn kr;</div>
<div class="line"><span class="lineno"> 1745</span>    <span class="keywordtype">size_t</span>  transferred_bytes = 0,</div>
<div class="line"><span class="lineno"> 1746</span>        data_size;</div>
<div class="line"><span class="lineno"> 1747</span>    <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *c = ((pi_usb_data_t *)ps-&gt;device-&gt;data)-&gt;ref;</div>
<div class="line"><span class="lineno"> 1748</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c,+1)&lt;=0 || !c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#af2606797deda70b5effbc50b2648d699">opened</a>)</div>
<div class="line"><span class="lineno"> 1749</span>    {</div>
<div class="line"><span class="lineno"> 1750</span>        <span class="comment">/* make sure we report broken connections */</span></div>
<div class="line"><span class="lineno"> 1751</span>        <span class="keywordflow">if</span> (ps-&gt;state == PI_SOCK_CONN_ACCEPT || ps-&gt;state == PI_SOCK_CONN_INIT)</div>
<div class="line"><span class="lineno"> 1752</span>            ps-&gt;state = PI_SOCK_CONN_BREAK;</div>
<div class="line"><span class="lineno"> 1753</span>        <a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1);</div>
<div class="line"><span class="lineno"> 1754</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacepisock.html#a7daabad696d8aaead5c479df2850eb92">PI_ERR_SOCK_DISCONNECTED</a>;</div>
<div class="line"><span class="lineno"> 1755</span>    }</div>
<div class="line"><span class="lineno"> 1756</span> </div>
<div class="line"><span class="lineno"> 1757</span>    <a class="code hl_define" href="#aadb790394ac125bbdc67225d17df07a2">ULOG</a>((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: u_write(ps=%p, c=%p, len=%d, flags=%d)\n&quot;</span>,ps,c,(<span class="keywordtype">int</span>)len,<a class="code hl_variable" href="#a1cbb17ede73ea044a04a129bf4d86976">flags</a>));</div>
<div class="line"><span class="lineno"> 1758</span> </div>
<div class="line"><span class="lineno"> 1759</span>    <span class="keywordflow">if</span> (c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aafae79b6a22926854b79c987d784db2d">vendorID</a> == <a class="code hl_define" href="#a0ae1af091a8c549c6dd222f1348dc4bd">VENDOR_PALMONE</a> &amp;&amp; c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a43b0eb165838e76a61358dc70072e62b">productID</a> == <a class="code hl_define" href="#a601606e0ac4526dd03b88b1b864d046f">PRODUCT_PALMCONNECT_USB</a>)</div>
<div class="line"><span class="lineno"> 1760</span>    {</div>
<div class="line"><span class="lineno"> 1761</span>        <span class="comment">/* format packets for the PalmConnect USB adapter */</span></div>
<div class="line"><span class="lineno"> 1762</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *packet = malloc(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a3da177f255bf2bb5168996f60d7ca46f">out_pipe_bulk_size</a>);</div>
<div class="line"><span class="lineno"> 1763</span>        <span class="keywordflow">if</span> (packet == NULL)</div>
<div class="line"><span class="lineno"> 1764</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="socket_8c.html#a415df518818c6813556c5607b29e833e">pi_set_error</a>(ps-&gt;sd, PI_ERR_GENERIC_MEMORY);</div>
<div class="line"><span class="lineno"> 1765</span> </div>
<div class="line"><span class="lineno"> 1766</span>        <span class="keywordflow">while</span> (len &gt; 0)</div>
<div class="line"><span class="lineno"> 1767</span>        {</div>
<div class="line"><span class="lineno"> 1768</span>            data_size = len;</div>
<div class="line"><span class="lineno"> 1769</span>            <span class="keywordflow">if</span> (data_size &gt; (<span class="keywordtype">size_t</span>)(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a3da177f255bf2bb5168996f60d7ca46f">out_pipe_bulk_size</a> - 2))</div>
<div class="line"><span class="lineno"> 1770</span>                data_size = (size_t)(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a3da177f255bf2bb5168996f60d7ca46f">out_pipe_bulk_size</a> - 2);</div>
<div class="line"><span class="lineno"> 1771</span>            packet[0] = data_size;</div>
<div class="line"><span class="lineno"> 1772</span>            packet[1] = data_size &gt;&gt; 8;</div>
<div class="line"><span class="lineno"> 1773</span>            memcpy(&amp;packet[2], &amp;<a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>[transferred_bytes], data_size);</div>
<div class="line"><span class="lineno"> 1774</span> </div>
<div class="line"><span class="lineno"> 1775</span>            kr = (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)-&gt;WritePipeTO(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a68cda814b13e4e7b07f76f0291771bca">out_pipe_ref</a>, packet, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a3da177f255bf2bb5168996f60d7ca46f">out_pipe_bulk_size</a>, 5000, 5000);</div>
<div class="line"><span class="lineno"> 1776</span>            <span class="keywordflow">if</span> (kr != kIOReturnSuccess) {</div>
<div class="line"><span class="lineno"> 1777</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: darwin_usb_write(): WritePipe returned kr=0x%08lx\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1778</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1779</span>            }</div>
<div class="line"><span class="lineno"> 1780</span> </div>
<div class="line"><span class="lineno"> 1781</span>            c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a4dfdddaa87057cdc153853a82827b85c">total_bytes_written</a> += (<span class="keywordtype">unsigned</span> long)data_size;</div>
<div class="line"><span class="lineno"> 1782</span>            transferred_bytes += data_size;</div>
<div class="line"><span class="lineno"> 1783</span>            len -= data_size;</div>
<div class="line"><span class="lineno"> 1784</span>        }</div>
<div class="line"><span class="lineno"> 1785</span>        free(packet);</div>
<div class="line"><span class="lineno"> 1786</span>    }</div>
<div class="line"><span class="lineno"> 1787</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1788</span>    {</div>
<div class="line"><span class="lineno"> 1789</span>        kr = (*c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>)-&gt;WritePipeTO(c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#ae72e762f197de7be222f5cb0cc0beac1">interface</a>, c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a68cda814b13e4e7b07f76f0291771bca">out_pipe_ref</a>, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, len, 5000, 5000);</div>
<div class="line"><span class="lineno"> 1790</span>        <span class="keywordflow">if</span> (kr != kIOReturnSuccess)</div>
<div class="line"><span class="lineno"> 1791</span>        {</div>
<div class="line"><span class="lineno"> 1792</span>            LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: darwin_usb_write(): WritePipe returned kr=0x%08lx\n&quot;</span>, kr));</div>
<div class="line"><span class="lineno"> 1793</span>        }</div>
<div class="line"><span class="lineno"> 1794</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1795</span>        {</div>
<div class="line"><span class="lineno"> 1796</span>            c-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a4dfdddaa87057cdc153853a82827b85c">total_bytes_written</a> += (<span class="keywordtype">unsigned</span> long)len;</div>
<div class="line"><span class="lineno"> 1797</span>            transferred_bytes = len;</div>
<div class="line"><span class="lineno"> 1798</span>        }</div>
<div class="line"><span class="lineno"> 1799</span>    }</div>
<div class="line"><span class="lineno"> 1800</span> </div>
<div class="line"><span class="lineno"> 1801</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a6b11be685f613bf98fd2492cd26c7ce6">change_refcount</a>(c, -1) &lt;= 0)</div>
<div class="line"><span class="lineno"> 1802</span>        <span class="keywordflow">return</span> PI_ERR_SOCK_DISCONNECTED;</div>
<div class="line"><span class="lineno"> 1803</span> </div>
<div class="line"><span class="lineno"> 1804</span>    <span class="keywordflow">return</span> transferred_bytes;</div>
<div class="line"><span class="lineno"> 1805</span>}</div>
<div class="ttc" id="astructusb__connection__t_html_a3da177f255bf2bb5168996f60d7ca46f"><div class="ttname"><a href="structusb__connection__t.html#a3da177f255bf2bb5168996f60d7ca46f">usb_connection_t::out_pipe_bulk_size</a></div><div class="ttdeci">int out_pipe_bulk_size</div><div class="ttdef"><b>Definition</b> darwinusb.c:159</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00034">buf</a>, <a class="el" href="#l00492">change_refcount()</a>, <a class="el" href="#l00311">flags</a>, <a class="el" href="#l00145">usb_connection_t::interface</a>, <a class="el" href="#l00153">usb_connection_t::opened</a>, <a class="el" href="#l00159">usb_connection_t::out_pipe_bulk_size</a>, <a class="el" href="#l00158">usb_connection_t::out_pipe_ref</a>, <a class="el" href="#l01625">pi_set_error()</a>, <a class="el" href="#l00292">PRODUCT_PALMCONNECT_USB</a>, <a class="el" href="#l00150">usb_connection_t::productID</a>, <a class="el" href="#l00167">usb_connection_t::total_bytes_written</a>, <a class="el" href="#l00106">ULOG</a>, <a class="el" href="#l00290">VENDOR_PALMONE</a>, and <a class="el" href="#l00149">usb_connection_t::vendorID</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01950">pi_usb_impl_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a62be9dca709b9fa802954d73d21ab332_cgraph.png" border="0" usemap="#adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_cgraph" alt=""/></div>
<map name="adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_cgraph" id="adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_cgraph">
<area shape="rect" title=" " alt="" coords="5,80,69,106"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="117,55,234,80"/>
<area shape="poly" title=" " alt="" coords="69,84,101,78,102,84,70,90"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="131,104,220,130"/>
<area shape="poly" title=" " alt="" coords="70,96,116,104,115,109,69,101"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="282,5,416,31"/>
<area shape="poly" title=" " alt="" coords="223,51,286,33,287,38,224,57"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="298,55,400,80"/>
<area shape="poly" title=" " alt="" coords="235,65,283,65,283,70,235,70"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="296,104,402,130"/>
<area shape="poly" title=" " alt="" coords="220,114,281,114,281,120,220,120"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="471,55,577,80"/>
<area shape="poly" title=" " alt="" coords="397,101,460,83,462,88,398,106"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="464,104,584,130"/>
<area shape="poly" title=" " alt="" coords="402,114,448,114,448,120,402,120"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="480,153,568,179"/>
<area shape="poly" title=" " alt="" coords="398,128,466,147,464,152,397,133"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_a62be9dca709b9fa802954d73d21ab332_icgraph.png" border="0" usemap="#adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_icgraph" alt=""/></div>
<map name="adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_icgraph" id="adarwinusb_8c_a62be9dca709b9fa802954d73d21ab332_icgraph">
<area shape="rect" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<a id="ae063014a517d3d5d8b74a3b7348349f3" name="ae063014a517d3d5d8b74a3b7348349f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae063014a517d3d5d8b74a3b7348349f3">&#9670;&#160;</a></span>usb_thread_run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * usb_thread_run </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>foo</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  628</span>{</div>
<div class="line"><span class="lineno">  629</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#a7a9d99aa7696e0e755b80cdd81c0709d">start_listening</a>() == 0)</div>
<div class="line"><span class="lineno">  630</span>    {</div>
<div class="line"><span class="lineno">  631</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: usb_thread_run, starting...\n&quot;</span>));</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>        <span class="comment">/* obtain the CFRunLoop for this thread */</span></div>
<div class="line"><span class="lineno">  634</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a>);</div>
<div class="line"><span class="lineno">  635</span>        <a class="code hl_variable" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a> = CFRunLoopGetCurrent();</div>
<div class="line"><span class="lineno">  636</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a>);</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>        <span class="comment">/* signal main thread that init was successful */</span></div>
<div class="line"><span class="lineno">  639</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno">  640</span>        pthread_cond_broadcast(&amp;<a class="code hl_variable" href="#aba17cac29b694d3e604d4b608228c8c1">usb_thread_ready_cond</a>);</div>
<div class="line"><span class="lineno">  641</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>        CFRunLoopRun();</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: usb_thread_run, done with runloop\n&quot;</span>));</div>
<div class="line"><span class="lineno">  646</span> </div>
<div class="line"><span class="lineno">  647</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a>);</div>
<div class="line"><span class="lineno">  648</span>        <a class="code hl_variable" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a> = 0;</div>
<div class="line"><span class="lineno">  649</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a>);</div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a>)</div>
<div class="line"><span class="lineno">  652</span>        {</div>
<div class="line"><span class="lineno">  653</span>            IOObjectRelease (<a class="code hl_variable" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a>);</div>
<div class="line"><span class="lineno">  654</span>            <a class="code hl_variable" href="#af9b66f16119c60eefb658bfc4ac4b617">usb_device_added_iter</a> = 0;</div>
<div class="line"><span class="lineno">  655</span>        }</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a>)</div>
<div class="line"><span class="lineno">  658</span>        {</div>
<div class="line"><span class="lineno">  659</span>            IONotificationPortDestroy(<a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a>);</div>
<div class="line"><span class="lineno">  660</span>            <a class="code hl_variable" href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">usb_notify_port</a> = NULL;</div>
<div class="line"><span class="lineno">  661</span>        }</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>        <span class="comment">/* decrement the refcount of each structure. If there</span></div>
<div class="line"><span class="lineno">  664</span><span class="comment">         * was a pending read, decrement once more since</span></div>
<div class="line"><span class="lineno">  665</span><span class="comment">         * prime_read() increments the refcount</span></div>
<div class="line"><span class="lineno">  666</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  667</span>        <a class="code hl_struct" href="structusb__connection__t.html">usb_connection_t</a> *elem, *next, *prev = NULL;</div>
<div class="line"><span class="lineno">  668</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  669</span>        elem = <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a>;</div>
<div class="line"><span class="lineno">  670</span>        <span class="keywordflow">while</span> (elem != NULL)</div>
<div class="line"><span class="lineno">  671</span>        {</div>
<div class="line"><span class="lineno">  672</span>            next = elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a>;</div>
<div class="line"><span class="lineno">  673</span>            pthread_mutex_lock(&amp;elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>);</div>
<div class="line"><span class="lineno">  674</span>            elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a>--;</div>
<div class="line"><span class="lineno">  675</span>            <span class="keywordflow">if</span> (elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#acb57149c233ecb5ae4394ef5a41f4359">read_pending</a>)</div>
<div class="line"><span class="lineno">  676</span>                elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a>--;</div>
<div class="line"><span class="lineno">  677</span>            <span class="keywordflow">if</span> (elem &lt; 0)</div>
<div class="line"><span class="lineno">  678</span>                LOG((PI_DBG_DEV, PI_DBG_LVL_ERR, <span class="stringliteral">&quot;darwinusb: while stopping usb_thread, connection %p&#39;s refcount became &lt; 0 (%d)&quot;</span>, elem, elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a223a278e0bf3b42ae887efe07bfbeac0">ref_count</a>));</div>
<div class="line"><span class="lineno">  679</span>            <span class="keywordflow">if</span> (elem == 0)</div>
<div class="line"><span class="lineno">  680</span>            {</div>
<div class="line"><span class="lineno">  681</span>                <span class="keywordflow">if</span> (prev != NULL)</div>
<div class="line"><span class="lineno">  682</span>                    prev-&gt;<a class="code hl_variable" href="structusb__connection__t.html#a9fb446ce2250b205634d4826efa0d9ab">next</a> = next;</div>
<div class="line"><span class="lineno">  683</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  684</span>                    <a class="code hl_variable" href="#a8bb24b1602e506248a782023abbef0b5">usb_connections</a> = next;</div>
<div class="line"><span class="lineno">  685</span>                <a class="code hl_function" href="#a7974faab5165fb2b558c2f0f08e921ae">stop_listening</a>(elem);</div>
<div class="line"><span class="lineno">  686</span>                elem = NULL;</div>
<div class="line"><span class="lineno">  687</span>            }</div>
<div class="line"><span class="lineno">  688</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  689</span>            {</div>
<div class="line"><span class="lineno">  690</span>                pthread_mutex_unlock(&amp;elem-&gt;<a class="code hl_variable" href="structusb__connection__t.html#aa40d718670d32f65e7b63678b7de41f2">ref_count_mutex</a>);</div>
<div class="line"><span class="lineno">  691</span>                prev = elem;</div>
<div class="line"><span class="lineno">  692</span>            }</div>
<div class="line"><span class="lineno">  693</span>        }</div>
<div class="line"><span class="lineno">  694</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">usb_connections_mutex</a>);</div>
<div class="line"><span class="lineno">  695</span> </div>
<div class="line"><span class="lineno">  696</span>        <a class="code hl_variable" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a> = 0;</div>
<div class="line"><span class="lineno">  697</span>        <a class="code hl_variable" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a> = NULL;</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>        LOG((PI_DBG_DEV, PI_DBG_LVL_DEBUG, <span class="stringliteral">&quot;darwinusb: usb_thread_run, exited.\n&quot;</span>));</div>
<div class="line"><span class="lineno">  700</span>    }</div>
<div class="line"><span class="lineno">  701</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  702</span>    {</div>
<div class="line"><span class="lineno">  703</span>        <span class="comment">/* signal main thread that init failed */</span></div>
<div class="line"><span class="lineno">  704</span>        <a class="code hl_variable" href="#a4622ae4614d20e142779408a7f8c7825">usb_thread</a> = 0;</div>
<div class="line"><span class="lineno">  705</span>        <a class="code hl_variable" href="#aa8f71bd48f1b7d294f04994511f77eeb">usb_run_loop</a> = NULL;</div>
<div class="line"><span class="lineno">  706</span>        pthread_mutex_lock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno">  707</span>        pthread_cond_signal(&amp;<a class="code hl_variable" href="#aba17cac29b694d3e604d4b608228c8c1">usb_thread_ready_cond</a>);</div>
<div class="line"><span class="lineno">  708</span>        pthread_mutex_unlock(&amp;<a class="code hl_variable" href="#a4f2c71376203c7c3c34d2adc0d1c8acd">usb_thread_ready_mutex</a>);</div>
<div class="line"><span class="lineno">  709</span>    }</div>
<div class="line"><span class="lineno">  710</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  711</span>}</div>
<div class="ttc" id="adarwinusb_8c_html_a7a9d99aa7696e0e755b80cdd81c0709d"><div class="ttname"><a href="#a7a9d99aa7696e0e755b80cdd81c0709d">start_listening</a></div><div class="ttdeci">static int start_listening(void)</div><div class="ttdef"><b>Definition</b> darwinusb.c:524</div></div>
<div class="ttc" id="adarwinusb_8c_html_a8360facefc49be38517fde7b07169f82"><div class="ttname"><a href="#a8360facefc49be38517fde7b07169f82">usb_run_loop_mutex</a></div><div class="ttdeci">static pthread_mutex_t usb_run_loop_mutex</div><div class="ttdef"><b>Definition</b> darwinusb.c:128</div></div>
<div class="ttc" id="astructusb__connection__t_html_acb57149c233ecb5ae4394ef5a41f4359"><div class="ttname"><a href="structusb__connection__t.html#acb57149c233ecb5ae4394ef5a41f4359">usb_connection_t::read_pending</a></div><div class="ttdeci">int read_pending</div><div class="ttdef"><b>Definition</b> darwinusb.c:155</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00138">usb_connection_t::next</a>, <a class="el" href="#l00155">usb_connection_t::read_pending</a>, <a class="el" href="#l00143">usb_connection_t::ref_count</a>, <a class="el" href="#l00142">usb_connection_t::ref_count_mutex</a>, <a class="el" href="#l00524">start_listening()</a>, <a class="el" href="#l00582">stop_listening()</a>, <a class="el" href="#l00178">usb_connections</a>, <a class="el" href="#l00131">usb_connections_mutex</a>, <a class="el" href="#l00124">usb_device_added_iter</a>, <a class="el" href="#l00123">usb_notify_port</a>, <a class="el" href="#l00127">usb_run_loop</a>, <a class="el" href="#l00128">usb_run_loop_mutex</a>, <a class="el" href="#l00133">usb_thread</a>, <a class="el" href="#l00130">usb_thread_ready_cond</a>, and <a class="el" href="#l00129">usb_thread_ready_mutex</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l01599">u_open()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_cgraph.png" border="0" usemap="#adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_cgraph" alt=""/></div>
<map name="adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_cgraph" id="adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_cgraph">
<area shape="rect" title=" " alt="" coords="5,413,116,439"/>
<area shape="rect" href="darwinusb_8c.html#a7a9d99aa7696e0e755b80cdd81c0709d" title=" " alt="" coords="164,339,266,364"/>
<area shape="poly" title=" " alt="" coords="88,410,171,369,174,374,90,415"/>
<area shape="rect" href="darwinusb_8c.html#a7974faab5165fb2b558c2f0f08e921ae" title=" " alt="" coords="1125,412,1226,438"/>
<area shape="poly" title=" " alt="" coords="116,431,230,443,363,449,749,449,945,442,1109,429,1109,434,946,447,749,454,363,454,230,448,116,436"/>
<area shape="rect" href="darwinusb_8c.html#ad2382b0d9c99eeded50fdcb6f448b92d" title=" " alt="" coords="314,264,415,290"/>
<area shape="poly" title=" " alt="" coords="241,336,322,295,325,300,244,341"/>
<area shape="rect" href="darwinusb_8c.html#ab10d2c139ee0772df628b5e705368986" title=" " alt="" coords="484,288,596,314"/>
<area shape="poly" title=" " alt="" coords="416,281,469,288,468,294,416,286"/>
<area shape="rect" href="darwinusb_8c.html#ab97608baf2dc20e00693ea3d28b1c5fe" title=" " alt="" coords="484,337,596,363"/>
<area shape="poly" title=" " alt="" coords="391,288,464,324,479,329,477,334,462,329,389,293"/>
<area shape="rect" href="darwinusb_8c.html#a44db8313ee840eece0ab14aa96ca9bf9" title=" " alt="" coords="480,188,600,214"/>
<area shape="poly" title=" " alt="" coords="388,261,462,224,479,217,481,222,464,229,390,266"/>
<area shape="rect" href="darwinusb_8c.html#a6378ac6f6b9262ad7cba19de626cd74b" title=" " alt="" coords="463,87,617,112"/>
<area shape="poly" title=" " alt="" coords="369,262,403,200,429,163,462,129,480,117,483,122,465,134,433,166,407,203,374,265"/>
<area shape="rect" href="darwinusb_8c.html#a1760782cd564351de8fb058afe311e05" title=" " alt="" coords="683,388,812,414"/>
<area shape="poly" title=" " alt="" coords="377,289,411,332,436,355,465,373,514,391,567,401,619,405,667,405,667,411,619,411,567,406,513,396,462,378,433,359,407,336,372,292"/>
<area shape="rect" href="darwinusb_8c.html#ad2b23562cd53b9fee904b9ad45ab2889" title=" " alt="" coords="694,5,800,31"/>
<area shape="poly" title=" " alt="" coords="373,262,409,219,434,194,462,173,484,162,504,155,541,150,577,144,595,136,615,123,631,103,638,83,646,62,663,41,678,32,681,36,666,46,650,65,643,85,636,106,618,127,598,141,578,149,542,155,506,160,486,167,465,178,437,198,413,222,377,265"/>
<area shape="rect" href="darwinusb_8c.html#a9a37658b034e10d52a5affda2c28a26d" title=" " alt="" coords="497,239,583,264"/>
<area shape="poly" title=" " alt="" coords="416,267,482,257,482,262,416,272"/>
<area shape="rect" href="darwinusb_8c.html#a6bf0b49b7f893ca4dd2b2a7739c59aec" title=" " alt="" coords="914,180,1024,206"/>
<area shape="poly" title=" " alt="" coords="600,211,665,221,747,226,830,221,905,207,905,212,830,226,747,232,664,226,600,217"/>
<area shape="rect" href="darwinusb_8c.html#a75b8e770479707f2ca65619e5e15248b" title=" " alt="" coords="682,185,812,211"/>
<area shape="poly" title=" " alt="" coords="600,197,667,197,667,202,600,203"/>
<area shape="rect" href="darwinusb_8c.html#a1fdb9881cd44d8dfa115018ef8a8a07a" title=" " alt="" coords="665,55,830,96"/>
<area shape="poly" title=" " alt="" coords="582,185,615,167,630,152,638,137,647,122,663,107,670,102,673,106,666,111,652,126,643,140,634,155,618,171,584,190"/>
<area shape="rect" href="darwinusb_8c.html#a90eff23f2e0b0132dbb82d4cbfeb4cc0" title=" " alt="" coords="672,120,823,161"/>
<area shape="poly" title=" " alt="" coords="587,185,659,163,661,169,588,190"/>
<area shape="poly" title=" " alt="" coords="813,194,898,192,898,197,813,199"/>
<area shape="poly" title=" " alt="" coords="804,94,831,106,888,138,937,169,934,173,885,143,829,111,802,99"/>
<area shape="rect" href="darwinusb_8c.html#a0cc85622030ec13870fc90026ace908b" title=" " alt="" coords="878,55,1060,96"/>
<area shape="poly" title=" " alt="" coords="830,73,862,73,862,78,830,78"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="1128,63,1223,88"/>
<area shape="poly" title=" " alt="" coords="1060,73,1113,73,1113,78,1060,78"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="1291,63,1381,88"/>
<area shape="poly" title=" " alt="" coords="1224,73,1275,73,1275,78,1224,78"/>
<area shape="poly" title=" " alt="" coords="824,156,899,174,898,179,823,161"/>
<area shape="poly" title=" " alt="" coords="823,134,935,123,1060,105,1118,91,1119,96,1061,110,936,129,824,139"/>
<area shape="rect" href="darwinusb_8c.html#a6b11be685f613bf98fd2492cd26c7ce6" title=" " alt="" coords="910,363,1028,388"/>
<area shape="poly" title=" " alt="" coords="812,391,895,381,895,387,813,396"/>
<area shape="rect" href="darwinusb_8c.html#a173addd105f622a77d8797cad4a33a68" title=" " alt="" coords="1108,363,1243,388"/>
<area shape="poly" title=" " alt="" coords="1028,373,1093,373,1093,378,1028,378"/>
<area shape="poly" title=" " alt="" coords="1027,386,1110,407,1109,412,1026,392"/>
<area shape="poly" title=" " alt="" coords="801,29,874,48,872,53,799,34"/>
<area shape="poly" title=" " alt="" coords="801,17,920,23,1061,41,1120,55,1119,60,1060,46,920,29,801,22"/>
<area shape="poly" title=" " alt="" coords="584,258,618,273,633,286,642,299,651,312,666,323,723,346,783,361,843,370,895,373,895,379,842,375,782,366,721,351,663,327,647,315,638,302,629,290,615,278,582,263"/>
<area shape="rect" href="darwinusb_8c.html#a657fc918c5800dab2a0fbdf7e4a97d73" title=" " alt="" coords="689,287,806,312"/>
<area shape="poly" title=" " alt="" coords="571,262,675,289,673,294,570,267"/>
<area shape="poly" title=" " alt="" coords="788,310,916,355,914,360,786,315"/>
<area shape="poly" title=" " alt="" coords="716,289,597,259,599,254,717,284"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="darwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_icgraph.png" border="0" usemap="#adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_icgraph" alt=""/></div>
<map name="adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_icgraph" id="adarwinusb_8c_ae063014a517d3d5d8b74a3b7348349f3_icgraph">
<area shape="rect" title=" " alt="" coords="1403,242,1514,268"/>
<area shape="rect" href="darwinusb_8c.html#aad2542bd9cbedf6534bc2443fea26657" title=" " alt="" coords="1292,242,1355,268"/>
<area shape="poly" title=" " alt="" coords="1388,258,1356,258,1356,252,1388,252"/>
<area shape="rect" href="darwinusb_8c.html#a21b4c9d5b57f1d4a8f6b08b170b1d29f" title=" " alt="" coords="1130,242,1244,268"/>
<area shape="poly" title=" " alt="" coords="1276,258,1245,258,1245,252,1276,252"/>
<area shape="rect" href="usb_8c.html#a68c518ca08dac477013ed3b56ee8c174" title=" " alt="" coords="977,242,1082,268"/>
<area shape="poly" title=" " alt="" coords="1114,258,1082,258,1082,252,1114,252"/>
<area shape="rect" href="socket_8c.html#a970e724b72986d947471a345e67a119b" title=" " alt="" coords="831,242,929,268"/>
<area shape="poly" title=" " alt="" coords="962,258,930,258,930,252,962,252"/>
<area shape="rect" href="socket_8c.html#affbe18c8f2af556dffc3ac354fbf957d" title=" " alt="" coords="710,145,772,170"/>
<area shape="poly" title=" " alt="" coords="847,235,759,173,762,169,850,231"/>
<area shape="rect" href="socket_8c.html#a941d3345fc005dbd4583c01aedf0504b" title=" " alt="" coords="699,292,783,317"/>
<area shape="poly" title=" " alt="" coords="828,276,780,293,779,288,826,271"/>
<area shape="rect" href="pisock__wrap_8c.html#a93d21fa0d73dd33057be113819f38db4" title=" " alt="" coords="535,21,640,46"/>
<area shape="poly" title=" " alt="" coords="720,133,689,96,649,60,630,49,633,45,652,55,693,92,724,130"/>
<area shape="rect" href="connect_8c.html#a2e5febae39ff2bb757f58471f231d8a6" title=" " alt="" coords="538,70,637,96"/>
<area shape="poly" title=" " alt="" coords="704,139,650,109,625,99,627,94,652,105,707,134"/>
<area shape="rect" href="libjpisock_8c.html#a201020848015baf4f5015d6d0f736988" title=" " alt="" coords="538,120,637,145"/>
<area shape="poly" title=" " alt="" coords="694,153,637,143,638,138,694,147"/>
<area shape="rect" href="userland_8c.html#a21d841df63f1c93b1fc98b4b4a8b0bbc" title=" " alt="" coords="542,169,633,194"/>
<area shape="poly" title=" " alt="" coords="695,167,634,177,633,172,694,162"/>
<area shape="rect" href="pilot-debug_8c.html#a0dacc8d2e2dac4868581ef1931b0cee1" title=" " alt="" coords="550,218,625,244"/>
<area shape="poly" title=" " alt="" coords="705,181,652,209,627,220,625,215,650,205,703,176"/>
<area shape="rect" href="libjpisock_8c.html#a461cdfef86fecffb4449d69c271573e7" title=" " alt="" coords="323,5,476,46"/>
<area shape="poly" title=" " alt="" coords="529,115,523,110,508,97,498,85,489,72,475,60,456,49,459,44,478,56,493,69,502,82,512,94,526,106,532,110"/>
<area shape="rect" href="pitcl_8c.html#aa7a47547eb5440bc9f883afba9254f65" title=" " alt="" coords="363,70,436,96"/>
<area shape="poly" title=" " alt="" coords="529,164,523,160,508,147,498,134,489,121,475,109,436,93,438,88,478,105,493,118,503,130,512,143,526,156,532,159"/>
<area shape="rect" href="pitcl_8c.html#afa4522a01803f57bd2b147fae9c0f225" title=" " alt="" coords="349,120,450,145"/>
<area shape="poly" title=" " alt="" coords="526,168,450,148,451,143,527,163"/>
<area shape="rect" href="pilot-wav_8c.html#a79213f9623d93348a3a7f9ba790963c9" title=" " alt="" coords="364,169,435,194"/>
<area shape="poly" title=" " alt="" coords="526,184,436,184,436,179,526,179"/>
<area shape="rect" href="pilot-install-memo_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="375,218,424,244"/>
<area shape="poly" title=" " alt="" coords="528,200,425,227,424,222,526,195"/>
<area shape="rect" href="pilot-hinotes_8c.html#a217dbf8b442f20279ea00b898af96f52" title=" " alt="" coords="375,268,424,293"/>
<area shape="poly" title=" " alt="" coords="532,204,526,208,512,220,503,233,493,246,478,259,451,271,425,279,424,273,449,266,475,254,489,242,498,230,508,217,523,204,529,199"/>
<area shape="rect" href="pilot-addresses_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="375,317,424,342"/>
<area shape="poly" title=" " alt="" coords="530,204,526,207,509,232,503,257,497,282,490,295,478,308,452,322,425,330,424,324,450,318,475,304,485,292,492,280,498,255,504,230,522,204,526,200"/>
<area shape="rect" href="pitcl_8c.html#ab8a87c2a8cbabc03b87303f4bc2e9601" title=" " alt="" coords="177,70,273,96"/>
<area shape="poly" title=" " alt="" coords="336,117,272,99,274,94,338,112"/>
<area shape="rect" href="pitcl_8c.html#addda8a7f5fdbf7d4efee71dde6b810d9" title=" " alt="" coords="175,120,275,145"/>
<area shape="poly" title=" " alt="" coords="333,135,275,135,275,130,333,130"/>
<area shape="rect" href="pitcl_8c.html#a96c8407b29d4a8f6613f0d136322f5b4" title=" " alt="" coords="5,96,127,121"/>
<area shape="poly" title=" " alt="" coords="162,96,128,101,127,96,161,90"/>
<area shape="poly" title=" " alt="" coords="159,125,126,120,127,115,160,120"/>
<area shape="rect" href="pilot-wav_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="200,169,250,194"/>
<area shape="poly" title=" " alt="" coords="348,184,250,184,250,179,348,179"/>
<area shape="rect" href="pisock__wrap_8c.html#a77396b6722dba076dac73dfce5847361" title=" " alt="" coords="524,268,651,293"/>
<area shape="poly" title=" " alt="" coords="683,298,650,293,651,288,684,293"/>
<area shape="rect" href="pilot-debugsh_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title=" " alt="" coords="563,317,612,342"/>
<area shape="poly" title=" " alt="" coords="684,316,613,328,612,323,683,311"/>
<area shape="rect" href="pilot-nredir_8c.html#ac0f2228420376f4db7e1274f2b41667c" title=" " alt="" coords="563,366,612,392"/>
<area shape="poly" title=" " alt="" coords="707,328,652,357,614,373,612,368,650,353,704,323"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a8bdf361a62cb4e7c490fc6023606a290" name="a8bdf361a62cb4e7c490fc6023606a290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bdf361a62cb4e7c490fc6023606a290">&#9670;&#160;</a></span>accept_multiple_simultaneous_connections</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int accept_multiple_simultaneous_connections = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00405">darwinusb_setoptions()</a>, and <a class="el" href="#l00714">device_added()</a>.</p>

</div>
</div>
<a id="a2ce0dbf009bbc997676eb85f78dfac7d" name="a2ce0dbf009bbc997676eb85f78dfac7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ce0dbf009bbc997676eb85f78dfac7d">&#9670;&#160;</a></span>[struct]</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct  { ... }  acceptedDevices[]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01551">accepts_device()</a>.</p>

</div>
</div>
<a id="a1cbb17ede73ea044a04a129bf4d86976" name="a1cbb17ede73ea044a04a129bf4d86976"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cbb17ede73ea044a04a129bf4d86976">&#9670;&#160;</a></span>flags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short flags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l06461">_wrap_DBInfo_flags_set()</a>, <a class="el" href="#l01551">accepts_device()</a>, <a class="el" href="#l00392">cmp_flush()</a>, <a class="el" href="#l00347">cmp_rx()</a>, <a class="el" href="#l00297">cmp_tx()</a>, <a class="el" href="#l00878">configure_device()</a>, <a class="el" href="#l00082">PilotLink::createDB()</a>, <a class="el" href="#l01505">dlp_CreateDB()</a>, <a class="el" href="#l02610">dlp_DeleteCategory()</a>, <a class="el" href="#l02583">dlp_DeleteRecord()</a>, <a class="el" href="#l02896">dlp_DeleteResource()</a>, <a class="el" href="#l03839">dlp_ExpCardInfo()</a>, <a class="el" href="#l01312">dlp_FindDBByName()</a>, <a class="el" href="#l01352">dlp_FindDBByOpenHandle()</a>, <a class="el" href="#l01395">dlp_FindDBByTypeCreator()</a>, <a class="el" href="#l01040">dlp_ReadDBList()</a>, <a class="el" href="#l03147">dlp_ReadNextRecInCategory()</a>, <a class="el" href="#l01809">dlp_SetDBInfo()</a>, <a class="el" href="#l04555">dlp_VFSVolumeFormat()</a>, <a class="el" href="#l02510">dlp_WriteRecord()</a>, <a class="el" href="#l00677">Gen24bitRow()</a>, <a class="el" href="#l00218">DatebookRecord::getBuffer()</a>, <a class="el" href="#l00489">Java_org_gnu_pilotlink_PilotLink_createDB()</a>, <a class="el" href="#l01172">Java_org_gnu_pilotlink_PilotLink_readDBList()</a>, <a class="el" href="#l00206">ls_fn()</a>, <a class="el" href="#l00443">main()</a>, <a class="el" href="#l01002">main()</a>, <a class="el" href="#l00277">net_flush()</a>, <a class="el" href="#l00407">net_rx()</a>, <a class="el" href="#l00305">net_tx()</a>, <a class="el" href="#l00943">padp_dump()</a>, <a class="el" href="#l00890">padp_dump_header()</a>, <a class="el" href="#l00682">padp_flush()</a>, <a class="el" href="#l00403">padp_rx()</a>, <a class="el" href="#l00824">padp_sendack()</a>, <a class="el" href="#l00180">padp_tx()</a>, <a class="el" href="#l00320">palm_backup()</a>, <a class="el" href="#l00873">palm_fetch()</a>, <a class="el" href="#l01559">palm_install()</a>, <a class="el" href="#l02220">palm_list()</a>, <a class="el" href="#l01628">palm_list_internal()</a>, <a class="el" href="#l00649">pi_bluetooth_flush()</a>, <a class="el" href="#l00393">pi_bluetooth_open()</a>, <a class="el" href="#l00666">pi_bluetooth_read()</a>, <a class="el" href="#l00853">pi_file_install()</a>, <a class="el" href="#l01338">pi_flush()</a>, <a class="el" href="#l00430">pi_inet_flush()</a>, <a class="el" href="#l00495">pi_inet_read()</a>, <a class="el" href="#l01288">pi_recv()</a>, <a class="el" href="#l01258">pi_send()</a>, <a class="el" href="#l00102">plu_findcategory()</a>, <a class="el" href="#l00666">PySwigObject_print()</a>, <a class="el" href="#l00879">PySwigPacked_print()</a>, <a class="el" href="#l00206">PilotLink::readDBList()</a>, <a class="el" href="#l00508">s_flush()</a>, <a class="el" href="#l00421">s_read()</a>, <a class="el" href="#l00383">s_read_buf()</a>, <a class="el" href="#l00133">DatebookRecord::setBuffer()</a>, <a class="el" href="#l00441">slp_flush()</a>, <a class="el" href="#l00278">slp_rx()</a>, <a class="el" href="#l00197">slp_tx()</a>, <a class="el" href="#l01249">SWIG_Python_ConvertPacked()</a>, <a class="el" href="#l01144">SWIG_Python_ConvertPtr()</a>, <a class="el" href="#l01235">SWIG_Python_MustGetPtr()</a>, <a class="el" href="#l12731">swig_varlink_print()</a>, <a class="el" href="#l00276">sys_flush()</a>, <a class="el" href="#l00239">sys_rx()</a>, <a class="el" href="#l00174">sys_tx()</a>, <a class="el" href="#l01578">u_flush()</a>, <a class="el" href="#l00434">u_flush()</a>, <a class="el" href="#l00582">u_flush()</a>, <a class="el" href="#l00371">u_flush()</a>, <a class="el" href="#l00342">u_read()</a>, <a class="el" href="#l00285">u_read()</a>, <a class="el" href="#l01808">u_read()</a>, <a class="el" href="#l00480">u_read()</a>, <a class="el" href="#l00247">u_read_buf()</a>, <a class="el" href="#l00493">u_read_i()</a>, <a class="el" href="#l01742">u_write()</a>, <a class="el" href="#l00459">u_write()</a>, <a class="el" href="#l00183">unpack_Mail()</a>, <a class="el" href="#l00923">USB_configure_device()</a>, <a class="el" href="#l01030">USB_configure_generic()</a>, <a class="el" href="#l00454">WaitForConnect()</a>, <a class="el" href="#l00911">write_ppm()</a>, and <a class="el" href="#l00942">WritePicture()</a>.</p>

</div>
</div>
<a id="a43b0eb165838e76a61358dc70072e62b" name="a43b0eb165838e76a61358dc70072e62b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43b0eb165838e76a61358dc70072e62b">&#9670;&#160;</a></span>productID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short productID</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01551">accepts_device()</a>.</p>

</div>
</div>
<a id="a8236dfde083ec56b0a613afbecf88237" name="a8236dfde083ec56b0a613afbecf88237"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8236dfde083ec56b0a613afbecf88237">&#9670;&#160;</a></span>usb_connection_added_cond</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t usb_connection_added_cond = PTHREAD_COND_INITIALIZER</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01402">read_completion()</a>, and <a class="el" href="#l01642">u_wait_for_device()</a>.</p>

</div>
</div>
<a id="a8bb24b1602e506248a782023abbef0b5" name="a8bb24b1602e506248a782023abbef0b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bb24b1602e506248a782023abbef0b5">&#9670;&#160;</a></span>usb_connections</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structusb__connection__t.html">usb_connection_t</a>* usb_connections = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00417">add_connection()</a>, <a class="el" href="#l00467">connection_for_socket()</a>, <a class="el" href="#l00714">device_added()</a>, <a class="el" href="#l00455">device_already_in_use()</a>, <a class="el" href="#l00428">remove_connection()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="a46fbd25dde6a77fa97ee6d01ce7dcf39" name="a46fbd25dde6a77fa97ee6d01ce7dcf39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46fbd25dde6a77fa97ee6d01ce7dcf39">&#9670;&#160;</a></span>usb_connections_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t usb_connections_mutex = PTHREAD_MUTEX_INITIALIZER</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00417">add_connection()</a>, <a class="el" href="#l00467">connection_for_socket()</a>, <a class="el" href="#l00455">device_already_in_use()</a>, <a class="el" href="#l01402">read_completion()</a>, <a class="el" href="#l00428">remove_connection()</a>, <a class="el" href="#l01642">u_wait_for_device()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="af9b66f16119c60eefb658bfc4ac4b617" name="af9b66f16119c60eefb658bfc4ac4b617"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9b66f16119c60eefb658bfc4ac4b617">&#9670;&#160;</a></span>usb_device_added_iter</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">io_iterator_t usb_device_added_iter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00524">start_listening()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="a1bd3b03e77dab6f4cb1e1dba056ece1f" name="a1bd3b03e77dab6f4cb1e1dba056ece1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bd3b03e77dab6f4cb1e1dba056ece1f">&#9670;&#160;</a></span>usb_notify_port</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">IONotificationPortRef usb_notify_port</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00714">device_added()</a>, <a class="el" href="#l00524">start_listening()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="aa8f71bd48f1b7d294f04994511f77eeb" name="aa8f71bd48f1b7d294f04994511f77eeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8f71bd48f1b7d294f04994511f77eeb">&#9670;&#160;</a></span>usb_run_loop</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">CFRunLoopRef usb_run_loop = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01402">read_completion()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="a8360facefc49be38517fde7b07169f82" name="a8360facefc49be38517fde7b07169f82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8360facefc49be38517fde7b07169f82">&#9670;&#160;</a></span>usb_run_loop_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t usb_run_loop_mutex = PTHREAD_MUTEX_INITIALIZER</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="a4622ae4614d20e142779408a7f8c7825" name="a4622ae4614d20e142779408a7f8c7825"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4622ae4614d20e142779408a7f8c7825">&#9670;&#160;</a></span>usb_thread</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t usb_thread = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01599">u_open()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="aba17cac29b694d3e604d4b608228c8c1" name="aba17cac29b694d3e604d4b608228c8c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba17cac29b694d3e604d4b608228c8c1">&#9670;&#160;</a></span>usb_thread_ready_cond</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t usb_thread_ready_cond = PTHREAD_COND_INITIALIZER</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01599">u_open()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="a4f2c71376203c7c3c34d2adc0d1c8acd" name="a4f2c71376203c7c3c34d2adc0d1c8acd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f2c71376203c7c3c34d2adc0d1c8acd">&#9670;&#160;</a></span>usb_thread_ready_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t usb_thread_ready_mutex = PTHREAD_MUTEX_INITIALIZER</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01599">u_open()</a>, and <a class="el" href="#l00627">usb_thread_run()</a>.</p>

</div>
</div>
<a id="aafae79b6a22926854b79c987d784db2d" name="aafae79b6a22926854b79c987d784db2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafae79b6a22926854b79c987d784db2d">&#9670;&#160;</a></span>vendorID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short vendorID</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="#l01551">accepts_device()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ef3825c9845ea6880aaea633307886b2.html">libpisock</a></li><li class="navelem"><a class="el" href="darwinusb_8c.html">darwinusb.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
