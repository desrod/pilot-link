<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pilot-link: libpisock/os2serial.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pilot-link
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('os2serial_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">os2serial.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;io.h&gt;</code><br />
<code>#include &quot;pi-source.h&quot;</code><br />
<code>#include &quot;pi-serial.h&quot;</code><br />
<code>#include &quot;pi-slp.h&quot;</code><br />
<code>#include &quot;pi-syspkt.h&quot;</code><br />
<code>#include &quot;pi-padp.h&quot;</code><br />
<code>#include &lt;os2.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for os2serial.c:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c__incl.png" border="0" usemap="#alibpisock_2os2serial_8c" alt=""/></div>
<map name="alibpisock_2os2serial_8c" id="alibpisock_2os2serial_8c">
<area shape="rect" title=" " alt="" coords="398,5,537,31"/>
<area shape="rect" title=" " alt="" coords="5,79,95,105"/>
<area shape="poly" title=" " alt="" coords="398,33,111,81,110,76,397,28"/>
<area shape="rect" title=" " alt="" coords="118,79,198,105"/>
<area shape="poly" title=" " alt="" coords="415,34,214,80,213,75,414,29"/>
<area shape="rect" title=" " alt="" coords="221,79,282,105"/>
<area shape="poly" title=" " alt="" coords="432,34,297,78,295,73,430,29"/>
<area shape="rect" title=" " alt="" coords="306,79,348,105"/>
<area shape="poly" title=" " alt="" coords="445,34,364,75,361,70,442,29"/>
<area shape="rect" title=" " alt="" coords="373,79,458,105"/>
<area shape="poly" title=" " alt="" coords="461,33,435,68,431,65,457,30"/>
<area shape="rect" title=" " alt="" coords="482,79,559,105"/>
<area shape="poly" title=" " alt="" coords="478,30,505,65,500,68,474,33"/>
<area shape="rect" title=" " alt="" coords="584,79,647,105"/>
<area shape="poly" title=" " alt="" coords="494,29,577,69,575,74,491,34"/>
<area shape="rect" title=" " alt="" coords="671,79,757,105"/>
<area shape="poly" title=" " alt="" coords="510,29,658,72,657,77,508,34"/>
<area shape="rect" title=" " alt="" coords="781,79,855,105"/>
<area shape="poly" title=" " alt="" coords="533,29,766,76,765,81,532,34"/>
<area shape="rect" title=" " alt="" coords="879,79,933,105"/>
<area shape="poly" title=" " alt="" coords="538,24,685,44,865,76,864,81,684,49,537,30"/>
</map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSTR__EXTSETBAUDRATE.html">STR_EXTSETBAUDRATE</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0e5c57266b379937315b27afac31eecc" id="r_a0e5c57266b379937315b27afac31eecc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0e5c57266b379937315b27afac31eecc">INCL_BASE</a></td></tr>
<tr class="separator:a0e5c57266b379937315b27afac31eecc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab197c0eb4fb73e547ace952757ea84db" id="r_ab197c0eb4fb73e547ace952757ea84db"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab197c0eb4fb73e547ace952757ea84db">INCL_DOSDEVICES</a>&#160;&#160;&#160;/* DosDevice   values */</td></tr>
<tr class="separator:ab197c0eb4fb73e547ace952757ea84db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5826f0a1d4ed886122902c7650f72904" id="r_a5826f0a1d4ed886122902c7650f72904"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5826f0a1d4ed886122902c7650f72904">INCL_DOSDEVIOCTL</a>&#160;&#160;&#160;/* DosDevIOCtl values */</td></tr>
<tr class="separator:a5826f0a1d4ed886122902c7650f72904"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7a305ed93f5946436bd4f603d791ee7" id="r_af7a305ed93f5946436bd4f603d791ee7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af7a305ed93f5946436bd4f603d791ee7">INCL_DOSFILEMGR</a>&#160;&#160;&#160;/* File System values */</td></tr>
<tr class="separator:af7a305ed93f5946436bd4f603d791ee7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5be3fd564ccd2bc655b8893b24b8d03" id="r_aa5be3fd564ccd2bc655b8893b24b8d03"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa5be3fd564ccd2bc655b8893b24b8d03">INCL_MISC</a></td></tr>
<tr class="separator:aa5be3fd564ccd2bc655b8893b24b8d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab60308506cb83fd60c2d61a0ab0e95c8" id="r_ab60308506cb83fd60c2d61a0ab0e95c8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab60308506cb83fd60c2d61a0ab0e95c8">pi_serial_open</a> (pi_socket_t *ps, struct pi_sockaddr *addr, size_t addrlen)</td></tr>
<tr class="separator:ab60308506cb83fd60c2d61a0ab0e95c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a456598e5a37b644936baac33ffa2ada5" id="r_a456598e5a37b644936baac33ffa2ada5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a456598e5a37b644936baac33ffa2ada5">pi_socket_set_timeout</a> (pi_socket_t *ps, int read_timeout, int write_timeout)</td></tr>
<tr class="separator:a456598e5a37b644936baac33ffa2ada5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a246b8f9ccfa9b6946e8bda20fb73adbb" id="r_a246b8f9ccfa9b6946e8bda20fb73adbb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a246b8f9ccfa9b6946e8bda20fb73adbb">so_changebaud</a> (pi_socket_t *ps)</td></tr>
<tr class="separator:a246b8f9ccfa9b6946e8bda20fb73adbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a844542553c7c0cf6e05ecf3e52dba0" id="r_a7a844542553c7c0cf6e05ecf3e52dba0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7a844542553c7c0cf6e05ecf3e52dba0">so_close</a> (pi_socket_t *ps)</td></tr>
<tr class="separator:a7a844542553c7c0cf6e05ecf3e52dba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a652a6735dcb5a71256859121ef1562" id="r_a0a652a6735dcb5a71256859121ef1562"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0a652a6735dcb5a71256859121ef1562">so_read</a> (pi_socket_t *ps, int timeout)</td></tr>
<tr class="separator:a0a652a6735dcb5a71256859121ef1562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e5afab2de1fa817622a915b4ba4f731" id="r_a2e5afab2de1fa817622a915b4ba4f731"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2e5afab2de1fa817622a915b4ba4f731">so_write</a> (pi_socket_t *ps)</td></tr>
<tr class="separator:a2e5afab2de1fa817622a915b4ba4f731"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0e5c57266b379937315b27afac31eecc" name="a0e5c57266b379937315b27afac31eecc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e5c57266b379937315b27afac31eecc">&#9670;&#160;</a></span>INCL_BASE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCL_BASE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab197c0eb4fb73e547ace952757ea84db" name="ab197c0eb4fb73e547ace952757ea84db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab197c0eb4fb73e547ace952757ea84db">&#9670;&#160;</a></span>INCL_DOSDEVICES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCL_DOSDEVICES&#160;&#160;&#160;/* DosDevice   values */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5826f0a1d4ed886122902c7650f72904" name="a5826f0a1d4ed886122902c7650f72904"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5826f0a1d4ed886122902c7650f72904">&#9670;&#160;</a></span>INCL_DOSDEVIOCTL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCL_DOSDEVIOCTL&#160;&#160;&#160;/* DosDevIOCtl values */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af7a305ed93f5946436bd4f603d791ee7" name="af7a305ed93f5946436bd4f603d791ee7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7a305ed93f5946436bd4f603d791ee7">&#9670;&#160;</a></span>INCL_DOSFILEMGR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCL_DOSFILEMGR&#160;&#160;&#160;/* File System values */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa5be3fd564ccd2bc655b8893b24b8d03" name="aa5be3fd564ccd2bc655b8893b24b8d03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5be3fd564ccd2bc655b8893b24b8d03">&#9670;&#160;</a></span>INCL_MISC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INCL_MISC</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab60308506cb83fd60c2d61a0ab0e95c8" name="ab60308506cb83fd60c2d61a0ab0e95c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab60308506cb83fd60c2d61a0ab0e95c8">&#9670;&#160;</a></span>pi_serial_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pi_serial_open </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pi_sockaddr *</td>          <td class="paramname"><span class="paramname"><em>addr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>addrlen</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   66</span>{</div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordtype">int</span>     c,</div>
<div class="line"><span class="lineno">   68</span>        filesize = 0;</div>
<div class="line"><span class="lineno">   69</span>    HFILE   fd;</div>
<div class="line"><span class="lineno">   70</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code hl_variable" href="namespacepisocktests.html#a2f4ab7bf743142dae2e459aa18f9f1d4">action</a>;</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordtype">char</span> *<a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a> = addr-&gt;pi_device;</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">if</span> ((!<a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a>) || !strlen(<a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a>))</div>
<div class="line"><span class="lineno">   75</span>        <a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a> = getenv(<span class="stringliteral">&quot;PILOTPORT&quot;</span>);</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a>)</div>
<div class="line"><span class="lineno">   77</span>        <a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a> = <span class="stringliteral">&quot;&lt;Null&gt;&quot;</span>;</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">/* open the device */</span></div>
<div class="line"><span class="lineno">   80</span>    rc = DosOpen(<a class="code hl_variable" href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a>,   <span class="comment">/* the device   */</span></div>
<div class="line"><span class="lineno">   81</span>             &amp;fd,   <span class="comment">/* the file descriptor returned */</span></div>
<div class="line"><span class="lineno">   82</span>             &amp;action,   <span class="comment">/* the action taken */</span></div>
<div class="line"><span class="lineno">   83</span>             filesize,  <span class="comment">/* the size of the file */</span></div>
<div class="line"><span class="lineno">   84</span>             FILE_NORMAL,   <span class="comment">/* file permissions mode,</span></div>
<div class="line"><span class="lineno">   85</span><span class="comment">                         not the same as UNIX   */</span></div>
<div class="line"><span class="lineno">   86</span>             OPEN_ACTION_OPEN_IF_EXISTS, <span class="comment">/* file open action */</span></div>
<div class="line"><span class="lineno">   87</span>             OPEN_SHARE_DENYREADWRITE |</div>
<div class="line"><span class="lineno">   88</span>             OPEN_ACCESS_READWRITE, <span class="comment">/* open mode */</span></div>
<div class="line"><span class="lineno">   89</span>             0);    <span class="comment">/* extended attributes  */</span></div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">if</span> (c) {</div>
<div class="line"><span class="lineno">   91</span>        <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">case</span> 2:     </div>
<div class="line"><span class="lineno">   93</span>            errno = ENOENT;     <span class="comment">/* ERROR_FILE_NOT_FOUND  */</span></div>
<div class="line"><span class="lineno">   94</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   95</span>        <span class="keywordflow">case</span> 3:     </div>
<div class="line"><span class="lineno">   96</span>            errno = ENOTDIR;    <span class="comment">/* ERROR_PATH_NOT_FOUND  */</span></div>
<div class="line"><span class="lineno">   97</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   98</span>        <span class="keywordflow">case</span> 4:     </div>
<div class="line"><span class="lineno">   99</span>            errno = EMFILE;     <span class="comment">/* ERROR_TOO_MANY_OPEN_FILES*/</span></div>
<div class="line"><span class="lineno">  100</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  101</span>        <span class="keywordflow">case</span> 5:     </div>
<div class="line"><span class="lineno">  102</span>            errno = EACCES;     <span class="comment">/* ERROR_ACCESS_DENIED  */</span></div>
<div class="line"><span class="lineno">  103</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  104</span>        <span class="keywordflow">case</span> 32:    </div>
<div class="line"><span class="lineno">  105</span>            errno = EBUSY;      <span class="comment">/* ERROR_SHARING_VIOLATION */</span></div>
<div class="line"><span class="lineno">  106</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  107</span>        <span class="keywordflow">case</span> 82:    </div>
<div class="line"><span class="lineno">  108</span>            errno = EEXIST;     <span class="comment">/* ERROR_CANNOT_MAKE    */</span></div>
<div class="line"><span class="lineno">  109</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  110</span>        <span class="keywordflow">case</span> 99:    </div>
<div class="line"><span class="lineno">  111</span>            errno = EBUSY;      <span class="comment">/* ERROR_DEVICE_IN_USE  */</span></div>
<div class="line"><span class="lineno">  112</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  113</span>        <span class="keywordflow">case</span> 112:   </div>
<div class="line"><span class="lineno">  114</span>            errno = ENOSPC;     <span class="comment">/* ERROR_DISK_FULL      */</span></div>
<div class="line"><span class="lineno">  115</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  116</span>        <span class="keywordflow">case</span> 87:    </div>
<div class="line"><span class="lineno">  117</span>            errno = EINVAL;     <span class="comment">/* ERROR_INVALID_PARAMETER  */</span></div>
<div class="line"><span class="lineno">  118</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  120</span>            errno = -ENOMSG;</div>
<div class="line"><span class="lineno">  121</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  122</span>        }</div>
<div class="line"><span class="lineno">  123</span>        <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  124</span>    }</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    ps-&gt;mac-&gt;fd = _imphandle(fd);   <span class="comment">/* Let EMX know about this handle */</span></div>
<div class="line"><span class="lineno">  127</span>    ps-&gt;mac-&gt;fd = dup2(ps-&gt;mac-&gt;fd,</div>
<div class="line"><span class="lineno">  128</span>         ps-&gt;sd);   <span class="comment">/* Substitute serial connection for</span></div>
<div class="line"><span class="lineno">  129</span><span class="comment">                 original NUL handle */</span></div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <a class="code hl_function" href="#a246b8f9ccfa9b6946e8bda20fb73adbb">so_changebaud</a>(ps);</div>
<div class="line"><span class="lineno">  132</span>    <a class="code hl_function" href="#a456598e5a37b644936baac33ffa2ada5">pi_socket_set_timeout</a>(ps, -1, 60000);</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    ps-&gt;serial_close    = <a class="code hl_function" href="#a7a844542553c7c0cf6e05ecf3e52dba0">so_close</a>;</div>
<div class="line"><span class="lineno">  135</span>    ps-&gt;serial_read     = <a class="code hl_function" href="#a0a652a6735dcb5a71256859121ef1562">so_read</a>;</div>
<div class="line"><span class="lineno">  136</span>    ps-&gt;serial_write    = <a class="code hl_function" href="#a2e5afab2de1fa817622a915b4ba4f731">so_write</a>;</div>
<div class="line"><span class="lineno">  137</span>    ps-&gt;serial_changebaud   = <a class="code hl_function" href="#a246b8f9ccfa9b6946e8bda20fb73adbb">so_changebaud</a>;</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordflow">if</span> (ps-&gt;debuglog) {</div>
<div class="line"><span class="lineno">  141</span>        ps-&gt;debugfd = open(ps-&gt;debuglog, O_WRONLY | O_CREAT, S_IRUSR | S_IWUSR);</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>        <span class="comment">/* This sequence is magic used by my trace analyzer - kja */</span></div>
<div class="line"><span class="lineno">  144</span>        write(ps-&gt;debugfd, <span class="stringliteral">&quot;\0\1\0\0\0\0\0\0\0\0&quot;</span>, 10);</div>
<div class="line"><span class="lineno">  145</span>    }</div>
<div class="line"><span class="lineno">  146</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">return</span> (fd);</div>
<div class="line"><span class="lineno">  148</span>}</div>
<div class="ttc" id="anamespacepisocktests_html_a2f4ab7bf743142dae2e459aa18f9f1d4"><div class="ttname"><a href="namespacepisocktests.html#a2f4ab7bf743142dae2e459aa18f9f1d4">pisocktests.action</a></div><div class="ttdeci">action</div><div class="ttdef"><b>Definition</b> pisocktests.py:160</div></div>
<div class="ttc" id="aos2serial_8c_html_a0a652a6735dcb5a71256859121ef1562"><div class="ttname"><a href="#a0a652a6735dcb5a71256859121ef1562">so_read</a></div><div class="ttdeci">static int so_read(pi_socket_t *ps, int timeout)</div><div class="ttdef"><b>Definition</b> os2serial.c:444</div></div>
<div class="ttc" id="aos2serial_8c_html_a246b8f9ccfa9b6946e8bda20fb73adbb"><div class="ttname"><a href="#a246b8f9ccfa9b6946e8bda20fb73adbb">so_changebaud</a></div><div class="ttdeci">static int so_changebaud(pi_socket_t *ps)</div><div class="ttdef"><b>Definition</b> os2serial.c:170</div></div>
<div class="ttc" id="aos2serial_8c_html_a2e5afab2de1fa817622a915b4ba4f731"><div class="ttname"><a href="#a2e5afab2de1fa817622a915b4ba4f731">so_write</a></div><div class="ttdeci">static int so_write(pi_socket_t *ps)</div><div class="ttdef"><b>Definition</b> os2serial.c:387</div></div>
<div class="ttc" id="aos2serial_8c_html_a456598e5a37b644936baac33ffa2ada5"><div class="ttname"><a href="#a456598e5a37b644936baac33ffa2ada5">pi_socket_set_timeout</a></div><div class="ttdeci">static int pi_socket_set_timeout(pi_socket_t *ps, int read_timeout, int write_timeout)</div><div class="ttdef"><b>Definition</b> os2serial.c:282</div></div>
<div class="ttc" id="aos2serial_8c_html_a7a844542553c7c0cf6e05ecf3e52dba0"><div class="ttname"><a href="#a7a844542553c7c0cf6e05ecf3e52dba0">so_close</a></div><div class="ttdeci">static int so_close(pi_socket_t *ps)</div><div class="ttdef"><b>Definition</b> os2serial.c:253</div></div>
<div class="ttc" id="apd-tty_8c_html_a189c327f8c030df91c9b969a94bfae22"><div class="ttname"><a href="pd-tty_8c.html#a189c327f8c030df91c9b969a94bfae22">tty</a></div><div class="ttdeci">int tty</div><div class="ttdef"><b>Definition</b> pilot-debug.c:89</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00282">pi_socket_set_timeout()</a>, <a class="el" href="#l00170">so_changebaud()</a>, <a class="el" href="#l00253">so_close()</a>, <a class="el" href="#l00444">so_read()</a>, <a class="el" href="#l00387">so_write()</a>, and <a class="el" href="#l00089">tty</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_ab60308506cb83fd60c2d61a0ab0e95c8_cgraph.png" border="0" usemap="#aos2serial_8c_ab60308506cb83fd60c2d61a0ab0e95c8_cgraph" alt=""/></div>
<map name="aos2serial_8c_ab60308506cb83fd60c2d61a0ab0e95c8_cgraph" id="aos2serial_8c_ab60308506cb83fd60c2d61a0ab0e95c8_cgraph">
<area shape="rect" title=" " alt="" coords="5,180,110,206"/>
<area shape="rect" href="os2serial_8c.html#a456598e5a37b644936baac33ffa2ada5" title=" " alt="" coords="318,131,470,156"/>
<area shape="poly" title=" " alt="" coords="69,178,105,145,130,128,157,116,205,106,255,106,302,113,342,123,341,128,301,118,254,112,206,111,158,121,132,133,109,149,72,182"/>
<area shape="rect" href="os2serial_8c.html#a246b8f9ccfa9b6946e8bda20fb73adbb" title=" " alt="" coords="158,131,270,156"/>
<area shape="poly" title=" " alt="" coords="100,177,155,159,157,164,102,182"/>
<area shape="rect" href="os2serial_8c.html#a7a844542553c7c0cf6e05ecf3e52dba0" title=" " alt="" coords="177,180,250,206"/>
<area shape="poly" title=" " alt="" coords="110,190,161,190,161,196,110,196"/>
<area shape="rect" href="os2serial_8c.html#a0a652a6735dcb5a71256859121ef1562" title=" " alt="" coords="180,229,248,255"/>
<area shape="poly" title=" " alt="" coords="102,204,166,225,165,230,100,209"/>
<area shape="rect" href="os2serial_8c.html#a2e5afab2de1fa817622a915b4ba4f731" title=" " alt="" coords="179,279,249,304"/>
<area shape="poly" title=" " alt="" coords="76,204,113,234,159,265,167,269,164,274,156,270,110,238,72,208"/>
<area shape="poly" title=" " alt="" coords="246,227,269,216,359,163,361,167,271,221,249,231"/>
<area shape="rect" href="slp_8c.html#af8addd6e0b15768d09426046d6a5c76b" title=" " alt="" coords="366,229,422,255"/>
<area shape="poly" title=" " alt="" coords="248,240,351,240,351,245,248,245"/>
<area shape="rect" href="utils_8c.html#a135879f5a0f93242c8fdaf9a790833d8" title=" " alt="" coords="553,5,607,31"/>
<area shape="poly" title=" " alt="" coords="411,227,440,201,468,167,483,133,488,102,495,72,503,56,517,40,537,26,540,31,520,44,508,59,500,74,493,103,488,135,473,170,444,205,415,231"/>
<area shape="rect" href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4" title=" " alt="" coords="520,55,640,80"/>
<area shape="poly" title=" " alt="" coords="409,227,438,200,468,167,482,146,490,127,499,109,517,90,521,86,524,91,520,93,503,112,495,129,487,148,472,170,442,204,413,231"/>
<area shape="rect" href="pi-buffer_8c.html#af440579d61c8649154b0f0512c285606" title=" " alt="" coords="530,104,630,130"/>
<area shape="poly" title=" " alt="" coords="407,227,454,185,517,139,525,134,528,139,520,143,457,189,411,231"/>
<area shape="rect" href="pi-buffer_8c.html#a6775d9fcdb4fb3e02ce032337e1d10dc" title=" " alt="" coords="529,153,631,179"/>
<area shape="poly" title=" " alt="" coords="422,228,532,183,534,188,424,233"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="727,229,822,255"/>
<area shape="poly" title=" " alt="" coords="423,240,711,240,711,245,423,245"/>
<area shape="rect" href="socket_8c.html#a0d734c11092254f751f06eda9d35d7b3" title=" " alt="" coords="538,304,622,330"/>
<area shape="poly" title=" " alt="" coords="424,251,519,290,532,295,530,300,517,295,422,256"/>
<area shape="rect" href="socket_8c.html#a8fe4e2f277f57446a40cc3ccf20dd368" title=" " alt="" coords="522,403,638,428"/>
<area shape="poly" title=" " alt="" coords="405,254,449,318,482,356,520,389,525,393,522,397,517,394,478,360,445,321,401,257"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="535,353,625,379"/>
<area shape="poly" title=" " alt="" coords="411,253,457,295,520,340,528,344,525,349,517,344,454,299,407,257"/>
<area shape="rect" href="slp_8c.html#a1d28b91955f92f83aff45e1b5983261a" title=" " alt="" coords="541,255,619,280"/>
<area shape="poly" title=" " alt="" coords="423,243,526,258,526,263,423,249"/>
<area shape="rect" href="slp_8c.html#ad188b3c495c6437f9b997e23b1299254" title=" " alt="" coords="518,452,642,478"/>
<area shape="poly" title=" " alt="" coords="403,254,418,290,442,340,477,392,520,439,524,442,521,446,517,443,472,396,438,342,413,293,398,256"/>
<area shape="rect" href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238" title=" " alt="" coords="716,55,833,80"/>
<area shape="poly" title=" " alt="" coords="640,65,700,65,700,70,640,70"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="922,229,1012,255"/>
<area shape="poly" title=" " alt="" coords="823,240,906,240,906,245,823,245"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="722,353,827,379"/>
<area shape="poly" title=" " alt="" coords="623,325,707,347,706,352,622,330"/>
<area shape="rect" href="socket_8c.html#aaeefde34eb00f88065ce7a51dd03a8e6" title=" " alt="" coords="706,304,843,330"/>
<area shape="poly" title=" " alt="" coords="622,314,690,314,690,320,622,320"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="914,304,1019,330"/>
<area shape="poly" title=" " alt="" coords="827,350,899,331,900,337,828,355"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="907,353,1026,379"/>
<area shape="poly" title=" " alt="" coords="827,364,891,364,891,369,827,369"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="923,403,1010,428"/>
<area shape="poly" title=" " alt="" coords="828,377,909,398,907,403,827,382"/>
<area shape="poly" title=" " alt="" coords="633,399,706,381,707,386,634,405"/>
<area shape="rect" href="socket_8c.html#af71c99cb810ee32e115acfeebcc4fdcd" title=" " alt="" coords="690,403,859,428"/>
<area shape="poly" title=" " alt="" coords="638,413,674,413,674,418,638,418"/>
<area shape="poly" title=" " alt="" coords="625,364,706,364,706,369,625,369"/>
<area shape="poly" title=" " alt="" coords="619,260,711,248,712,253,620,265"/>
</map>
</div>

</div>
</div>
<a id="a456598e5a37b644936baac33ffa2ada5" name="a456598e5a37b644936baac33ffa2ada5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a456598e5a37b644936baac33ffa2ada5">&#9670;&#160;</a></span>pi_socket_set_timeout()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int pi_socket_set_timeout </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>read_timeout</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>write_timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  284</span>{</div>
<div class="line"><span class="lineno">  285</span>    <span class="keywordtype">int</span>     param_length,</div>
<div class="line"><span class="lineno">  286</span>        ret_len,</div>
<div class="line"><span class="lineno">  287</span>        c,      <span class="comment">/* switch */</span></div>
<div class="line"><span class="lineno">  288</span>        newtimeout;</div>
<div class="line"><span class="lineno">  289</span>    DCBINFO devinfo;</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>    <span class="keywordflow">if</span> ((ps-&gt;os2_read_timeout == read_timeout || read_timeout == -1)</div>
<div class="line"><span class="lineno">  292</span>        &amp;&amp; (ps-&gt;os2_write_timeout == write_timeout</div>
<div class="line"><span class="lineno">  293</span>        || write_timeout == -1))</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">return</span> (0);</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    ret_len = <span class="keyword">sizeof</span>(DCBINFO);</div>
<div class="line"><span class="lineno">  297</span>    c = DosDevIOCtl(ps-&gt;mac-&gt;fd,    <span class="comment">/* file decsriptor */</span></div>
<div class="line"><span class="lineno">  298</span>             IOCTL_ASYNC,   <span class="comment">/* asyncronous change   */</span></div>
<div class="line"><span class="lineno">  299</span>             ASYNC_GETDCBINFO,  <span class="comment">/* get device control</span></div>
<div class="line"><span class="lineno">  300</span><span class="comment">                         block info     */</span></div>
<div class="line"><span class="lineno">  301</span>             NULL,      <span class="comment">/*  */</span></div>
<div class="line"><span class="lineno">  302</span>             0, <span class="comment">/* length of the previous parameter     */</span></div>
<div class="line"><span class="lineno">  303</span>             NULL,  <span class="comment">/* max length of data ret       */</span></div>
<div class="line"><span class="lineno">  304</span>             &amp;devinfo,  <span class="comment">/* data to be recieved      */</span></div>
<div class="line"><span class="lineno">  305</span>             ret_len,   <span class="comment">/* length of data       */</span></div>
<div class="line"><span class="lineno">  306</span>             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;ret_len);</div>
<div class="line"><span class="lineno">  307</span>                <span class="comment">/* length of data returned      */</span></div>
<div class="line"><span class="lineno">  308</span>    <span class="keywordflow">if</span> (c)</div>
<div class="line"><span class="lineno">  309</span>        <span class="keywordflow">goto</span> <a class="code hl_variable" href="namespacepisock.html#af10dacfa214e2575bb2e0ee407c242e0">error</a>;</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>    <span class="keywordflow">if</span> (read_timeout != -1) {</div>
<div class="line"><span class="lineno">  312</span>        <span class="keywordflow">if</span> (read_timeout == 0) {</div>
<div class="line"><span class="lineno">  313</span>            devinfo.usReadTimeout = 65535;</div>
<div class="line"><span class="lineno">  314</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  315</span>            newtimeout = read_timeout - 0.1;</div>
<div class="line"><span class="lineno">  316</span>            <span class="keywordflow">if</span> (newtimeout &gt; 65535)</div>
<div class="line"><span class="lineno">  317</span>                newtimeout = 65535;</div>
<div class="line"><span class="lineno">  318</span>            devinfo.usReadTimeout = newtimeout;</div>
<div class="line"><span class="lineno">  319</span>        }</div>
<div class="line"><span class="lineno">  320</span>    }</div>
<div class="line"><span class="lineno">  321</span>    <span class="keywordflow">if</span> (write_timeout == -1) {</div>
<div class="line"><span class="lineno">  322</span>        <span class="keywordflow">if</span> (write_timeout == 0) {</div>
<div class="line"><span class="lineno">  323</span>            devinfo.fbTimeout |= 0x01;</div>
<div class="line"><span class="lineno">  324</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  325</span>            devinfo.fbTimeout &amp;= 0xFE;</div>
<div class="line"><span class="lineno">  326</span>            newtimeout = write_timeout;</div>
<div class="line"><span class="lineno">  327</span>            <span class="keywordflow">if</span> (newtimeout &gt; 65535)</div>
<div class="line"><span class="lineno">  328</span>                newtimeout = 65535;</div>
<div class="line"><span class="lineno">  329</span>            devinfo.usWriteTimeout = newtimeout;</div>
<div class="line"><span class="lineno">  330</span>        }</div>
<div class="line"><span class="lineno">  331</span>    }</div>
<div class="line"><span class="lineno">  332</span>    param_length = <span class="keyword">sizeof</span>(DCBINFO);</div>
<div class="line"><span class="lineno">  333</span>    c = DosDevIOCtl(ps-&gt;mac-&gt;fd,    <span class="comment">/* file decsriptor  */</span></div>
<div class="line"><span class="lineno">  334</span>             IOCTL_ASYNC,   <span class="comment">/* asyncronous change   */</span></div>
<div class="line"><span class="lineno">  335</span>             ASYNC_SETDCBINFO,  <span class="comment">/* get device control</span></div>
<div class="line"><span class="lineno">  336</span><span class="comment">                         block info     */</span></div>
<div class="line"><span class="lineno">  337</span>             &amp;devinfo,  <span class="comment">/* parameters to set    */</span></div>
<div class="line"><span class="lineno">  338</span>             param_length,  <span class="comment">/* length of the previous parameter*/</span></div>
<div class="line"><span class="lineno">  339</span>             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;param_length,</div>
<div class="line"><span class="lineno">  340</span>                    <span class="comment">/* max length of parameters */</span></div>
<div class="line"><span class="lineno">  341</span>             NULL,      <span class="comment">/* data to be recieved  */</span></div>
<div class="line"><span class="lineno">  342</span>             0,     <span class="comment">/* length of data   */</span></div>
<div class="line"><span class="lineno">  343</span>             NULL);     <span class="comment">/* length of data returned */</span></div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>      <a class="code hl_variable" href="namespacepisock.html#af10dacfa214e2575bb2e0ee407c242e0">error</a>:</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordflow">if</span> (c) {</div>
<div class="line"><span class="lineno">  347</span>        <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><span class="lineno">  348</span>        <span class="keywordflow">case</span> 1:     </div>
<div class="line"><span class="lineno">  349</span>            errno = ENOTTY; <span class="comment">/* ERROR_INVALID_FUNCTION */</span></div>
<div class="line"><span class="lineno">  350</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  351</span>        <span class="keywordflow">case</span> 6:     </div>
<div class="line"><span class="lineno">  352</span>            errno = EBADF;  <span class="comment">/* ERROR_INVALID_HANDLE */</span></div>
<div class="line"><span class="lineno">  353</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  354</span>        <span class="keywordflow">case</span> 87:    </div>
<div class="line"><span class="lineno">  355</span>            errno = EINVAL; <span class="comment">/* ERROR_INVALID_PARAMETER */</span></div>
<div class="line"><span class="lineno">  356</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  357</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  358</span>            errno = -ENOMSG;</div>
<div class="line"><span class="lineno">  359</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  360</span>        }</div>
<div class="line"><span class="lineno">  361</span>        <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  362</span>    }</div>
<div class="line"><span class="lineno">  363</span>    <span class="keywordflow">if</span> (read_timeout != -1)</div>
<div class="line"><span class="lineno">  364</span>        ps-&gt;os2_read_timeout = read_timeout;</div>
<div class="line"><span class="lineno">  365</span>    <span class="keywordflow">if</span> (write_timeout != -1)</div>
<div class="line"><span class="lineno">  366</span>        ps-&gt;os2_write_timeout = write_timeout;</div>
<div class="line"><span class="lineno">  367</span><span class="preprocessor">#ifdef OS2_DEBUG</span></div>
<div class="line"><span class="lineno">  368</span>    fprintf(stderr, <span class="stringliteral">&quot;set read_timeout to %d\n&quot;</span>, read_timeout);</div>
<div class="line"><span class="lineno">  369</span>    fprintf(stderr, <span class="stringliteral">&quot;set write_timeout to %d\n&quot;</span>, write_timeout);</div>
<div class="line"><span class="lineno">  370</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  371</span>    <span class="keywordflow">return</span> (0);</div>
<div class="line"><span class="lineno">  372</span>}</div>
<div class="ttc" id="anamespacepisock_html_af10dacfa214e2575bb2e0ee407c242e0"><div class="ttname"><a href="namespacepisock.html#af10dacfa214e2575bb2e0ee407c242e0">pisock.error</a></div><div class="ttdeci">error</div><div class="ttdef"><b>Definition</b> pisock.py:41</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00065">pi_serial_open()</a>, and <a class="el" href="#l00444">so_read()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a456598e5a37b644936baac33ffa2ada5_icgraph.png" border="0" usemap="#aos2serial_8c_a456598e5a37b644936baac33ffa2ada5_icgraph" alt=""/></div>
<map name="aos2serial_8c_a456598e5a37b644936baac33ffa2ada5_icgraph" id="aos2serial_8c_a456598e5a37b644936baac33ffa2ada5_icgraph">
<area shape="rect" title=" " alt="" coords="273,5,425,31"/>
<area shape="rect" href="os2serial_8c.html#ab60308506cb83fd60c2d61a0ab0e95c8" title=" " alt="" coords="5,5,110,31"/>
<area shape="poly" title=" " alt="" coords="258,21,110,21,110,16,258,16"/>
<area shape="rect" href="os2serial_8c.html#a0a652a6735dcb5a71256859121ef1562" title=" " alt="" coords="158,31,225,56"/>
<area shape="poly" title=" " alt="" coords="258,36,226,41,225,36,257,30"/>
<area shape="poly" title=" " alt="" coords="142,37,110,31,111,25,143,32"/>
</map>
</div>

</div>
</div>
<a id="a246b8f9ccfa9b6946e8bda20fb73adbb" name="a246b8f9ccfa9b6946e8bda20fb73adbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a246b8f9ccfa9b6946e8bda20fb73adbb">&#9670;&#160;</a></span>so_changebaud()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int so_changebaud </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  171</span>{</div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordtype">int</span>     param_length,</div>
<div class="line"><span class="lineno">  173</span>        c;      <span class="comment">/* switch */</span></div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> linctrl[3] = { 8, 0, 0 };</div>
<div class="line"><span class="lineno">  175</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structSTR__EXTSETBAUDRATE.html">STR_EXTSETBAUDRATE</a> extsetbaudrate;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    extsetbaudrate.<a class="code hl_variable" href="structSTR__EXTSETBAUDRATE.html#ae22c8cfcd5d88a0158d4e84b221c2d6d">baudrate</a> = ps-&gt;rate;</div>
<div class="line"><span class="lineno">  178</span>    extsetbaudrate.fraction = 0;    <span class="comment">/* if anyone knows some fractions*/</span></div>
<div class="line"><span class="lineno">  179</span>                    <span class="comment">/* that could be used here, let me</span></div>
<div class="line"><span class="lineno">  180</span><span class="comment">                     know */</span></div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    param_length = <span class="keyword">sizeof</span>(extsetbaudrate);</div>
<div class="line"><span class="lineno">  183</span>    c = DosDevIOCtl(ps-&gt;mac-&gt;fd,    <span class="comment">/* file decsriptor */</span></div>
<div class="line"><span class="lineno">  184</span>             IOCTL_ASYNC,   <span class="comment">/* asyncronous change   */</span></div>
<div class="line"><span class="lineno">  185</span>             ASYNC_EXTSETBAUDRATE,  <span class="comment">/* set the baudrate */</span></div>
<div class="line"><span class="lineno">  186</span>             &amp;extsetbaudrate,   <span class="comment">/* pointer to the baudrate */</span></div>
<div class="line"><span class="lineno">  187</span>             param_length,  <span class="comment">/* length of the previous parameter*/</span></div>
<div class="line"><span class="lineno">  188</span>             (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;param_length,   <span class="comment">/* max length</span></div>
<div class="line"><span class="lineno">  189</span><span class="comment">                                 of data ret */</span></div>
<div class="line"><span class="lineno">  190</span>             NULL,  <span class="comment">/* data to be sent */</span></div>
<div class="line"><span class="lineno">  191</span>             0, <span class="comment">/* length of data */</span></div>
<div class="line"><span class="lineno">  192</span>             NULL); <span class="comment">/* length of data returned  */</span></div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>    <span class="comment">/* also set the port to 8N1 as OS/2 defaults to some braindead</span></div>
<div class="line"><span class="lineno">  195</span><span class="comment">       values */</span></div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>    <span class="keywordflow">if</span> (!c) {   <span class="comment">/* but only if the previous operation succeeded */</span></div>
<div class="line"><span class="lineno">  198</span>        param_length = 3;   <span class="comment">/* 3 bytes for line control */</span></div>
<div class="line"><span class="lineno">  199</span>        c = DosDevIOCtl(ps-&gt;mac-&gt;fd,    <span class="comment">/* file decsriptor  */</span></div>
<div class="line"><span class="lineno">  200</span>                 IOCTL_ASYNC,   <span class="comment">/* asyncronous change   */</span></div>
<div class="line"><span class="lineno">  201</span>                 ASYNC_SETLINECTRL, <span class="comment">/* set the line</span></div>
<div class="line"><span class="lineno">  202</span><span class="comment">                             controls   */</span></div>
<div class="line"><span class="lineno">  203</span>                 linctrl,   <span class="comment">/* pointer to the</span></div>
<div class="line"><span class="lineno">  204</span><span class="comment">                         configuration  */</span></div>
<div class="line"><span class="lineno">  205</span>                 param_length,  <span class="comment">/* length of the previous</span></div>
<div class="line"><span class="lineno">  206</span><span class="comment">                         parameter */</span></div>
<div class="line"><span class="lineno">  207</span>                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;param_length,   </div>
<div class="line"><span class="lineno">  208</span>                        <span class="comment">/* max length of params */</span></div>
<div class="line"><span class="lineno">  209</span>                 NULL,  <span class="comment">/* data to be returned  */</span></div>
<div class="line"><span class="lineno">  210</span>                 0, <span class="comment">/* length of data */</span></div>
<div class="line"><span class="lineno">  211</span>                 NULL); <span class="comment">/* length of data returned  */</span></div>
<div class="line"><span class="lineno">  212</span>    }</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">if</span> (c) {</div>
<div class="line"><span class="lineno">  215</span>        <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordflow">case</span> 1:     </div>
<div class="line"><span class="lineno">  217</span>            errno = ENOTTY; <span class="comment">/* ERROR_INVALID_FUNCTION   */</span></div>
<div class="line"><span class="lineno">  218</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  219</span>        <span class="keywordflow">case</span> 6:     </div>
<div class="line"><span class="lineno">  220</span>            errno = EBADF;  <span class="comment">/* ERROR_INVALID_HANDLE     */</span></div>
<div class="line"><span class="lineno">  221</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  222</span>        <span class="keywordflow">case</span> 87:    </div>
<div class="line"><span class="lineno">  223</span>            errno = EINVAL; <span class="comment">/* ERROR_INVALID_PARAMETER  */</span></div>
<div class="line"><span class="lineno">  224</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  226</span>            errno = -ENOMSG;</div>
<div class="line"><span class="lineno">  227</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  228</span>        }</div>
<div class="line"><span class="lineno">  229</span>        <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="lineno">  230</span>    }</div>
<div class="line"><span class="lineno">  231</span>    <span class="comment">/* this pause seems necessary under OS2 to let the serial port</span></div>
<div class="line"><span class="lineno">  232</span><span class="comment">       realign itself */</span></div>
<div class="line"><span class="lineno">  233</span>    sleep(1);</div>
<div class="line"><span class="lineno">  234</span><span class="preprocessor">#ifdef OS2_DEBUG</span></div>
<div class="line"><span class="lineno">  235</span>    fprintf(stderr, <span class="stringliteral">&quot;set baudrate to %d\n&quot;</span>, <a class="code hl_variable" href="structSTR__EXTSETBAUDRATE.html#ae22c8cfcd5d88a0158d4e84b221c2d6d">baudrate</a>);</div>
<div class="line"><span class="lineno">  236</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordflow">return</span> (0);</div>
<div class="line"><span class="lineno">  238</span>}</div>
<div class="ttc" id="astructSTR__EXTSETBAUDRATE_html"><div class="ttname"><a href="structSTR__EXTSETBAUDRATE.html">STR_EXTSETBAUDRATE</a></div><div class="ttdef"><b>Definition</b> os2serial.c:152</div></div>
<div class="ttc" id="astructSTR__EXTSETBAUDRATE_html_ae22c8cfcd5d88a0158d4e84b221c2d6d"><div class="ttname"><a href="structSTR__EXTSETBAUDRATE.html#ae22c8cfcd5d88a0158d4e84b221c2d6d">STR_EXTSETBAUDRATE::baudrate</a></div><div class="ttdeci">ULONG baudrate</div><div class="ttdef"><b>Definition</b> os2serial.c:153</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00153">STR_EXTSETBAUDRATE::baudrate</a>, and <a class="el" href="#l00154">STR_EXTSETBAUDRATE::fraction</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00065">pi_serial_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a246b8f9ccfa9b6946e8bda20fb73adbb_icgraph.png" border="0" usemap="#aos2serial_8c_a246b8f9ccfa9b6946e8bda20fb73adbb_icgraph" alt=""/></div>
<map name="aos2serial_8c_a246b8f9ccfa9b6946e8bda20fb73adbb_icgraph" id="aos2serial_8c_a246b8f9ccfa9b6946e8bda20fb73adbb_icgraph">
<area shape="rect" title=" " alt="" coords="158,5,270,31"/>
<area shape="rect" href="os2serial_8c.html#ab60308506cb83fd60c2d61a0ab0e95c8" title=" " alt="" coords="5,5,110,31"/>
<area shape="poly" title=" " alt="" coords="142,21,110,21,110,16,142,16"/>
</map>
</div>

</div>
</div>
<a id="a7a844542553c7c0cf6e05ecf3e52dba0" name="a7a844542553c7c0cf6e05ecf3e52dba0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a844542553c7c0cf6e05ecf3e52dba0">&#9670;&#160;</a></span>so_close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int so_close </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  254</span>{</div>
<div class="line"><span class="lineno">  255</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  256</span>    <span class="keywordflow">if</span> (ps-&gt;debugfd)</div>
<div class="line"><span class="lineno">  257</span>        close(ps-&gt;debugfd);</div>
<div class="line"><span class="lineno">  258</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    DosClose(ps-&gt;mac-&gt;fd);</div>
<div class="line"><span class="lineno">  261</span>    <span class="keywordflow">return</span> (0);</div>
<div class="line"><span class="lineno">  262</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00065">pi_serial_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a7a844542553c7c0cf6e05ecf3e52dba0_icgraph.png" border="0" usemap="#aos2serial_8c_a7a844542553c7c0cf6e05ecf3e52dba0_icgraph" alt=""/></div>
<map name="aos2serial_8c_a7a844542553c7c0cf6e05ecf3e52dba0_icgraph" id="aos2serial_8c_a7a844542553c7c0cf6e05ecf3e52dba0_icgraph">
<area shape="rect" title=" " alt="" coords="158,5,231,31"/>
<area shape="rect" href="os2serial_8c.html#ab60308506cb83fd60c2d61a0ab0e95c8" title=" " alt="" coords="5,5,110,31"/>
<area shape="poly" title=" " alt="" coords="142,21,110,21,110,16,142,16"/>
</map>
</div>

</div>
</div>
<a id="a0a652a6735dcb5a71256859121ef1562" name="a0a652a6735dcb5a71256859121ef1562"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a652a6735dcb5a71256859121ef1562">&#9670;&#160;</a></span>so_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int so_read </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>timeout</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  445</span>{</div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordtype">int</span>     r;</div>
<div class="line"><span class="lineno">  447</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>;</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  450</span>    <span class="keywordtype">int</span>     i;</div>
<div class="line"><span class="lineno">  451</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordtype">int</span>     c;</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>    <span class="comment">/* FIXME: if timeout == 0, wait forever for packet, otherwise wait</span></div>
<div class="line"><span class="lineno">  455</span><span class="comment">       till timeout milli-seconds */</span></div>
<div class="line"><span class="lineno">  456</span> </div>
<div class="line"><span class="lineno">  457</span>    <span class="comment">/* for OS2, timeout of 0 is almost forever, only 1.8 hours if no</span></div>
<div class="line"><span class="lineno">  458</span><span class="comment">       timeout is set at all, the timeout defaults to 1 minute */</span></div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>    c = <a class="code hl_function" href="#a456598e5a37b644936baac33ffa2ada5">pi_socket_set_timeout</a>(ps, timeout / 100, -1);</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> (c == -1) {</div>
<div class="line"><span class="lineno">  462</span>        fprintf(stderr,</div>
<div class="line"><span class="lineno">  463</span>            <span class="stringliteral">&quot;error setting timeout, old timeout used\n&quot;</span>);</div>
<div class="line"><span class="lineno">  464</span>    }</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>    pi_serial_flush(ps);    <span class="comment">/* We likely want to be in sync with tx */</span></div>
<div class="line"><span class="lineno">  467</span>    <span class="keywordflow">if</span> (!ps-&gt;mac-&gt;expect)</div>
<div class="line"><span class="lineno">  468</span>        <a class="code hl_function" href="slp_8c.html#af8addd6e0b15768d09426046d6a5c76b">slp_rx</a>(ps); <span class="comment">/* let SLP know we want a packet */</span></div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>    <span class="keywordflow">while</span> (ps-&gt;mac-&gt;expect) {</div>
<div class="line"><span class="lineno">  471</span>        <a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a> = ps-&gt;mac-&gt;buf;</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>        <span class="keywordflow">while</span> (ps-&gt;mac-&gt;expect) {</div>
<div class="line"><span class="lineno">  474</span>            c = DosRead(ps-&gt;mac-&gt;fd, <a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a>, ps-&gt;mac-&gt;expect,</div>
<div class="line"><span class="lineno">  475</span>                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;r);</div>
<div class="line"><span class="lineno">  476</span>            <span class="keywordflow">if</span> (c) {</div>
<div class="line"><span class="lineno">  477</span>                <span class="comment">/* otherwise throw out any current packet and return */</span></div>
<div class="line"><span class="lineno">  478</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><span class="lineno">  479</span>                fprintf(stderr, <span class="stringliteral">&quot;Serial RX: timeout\n&quot;</span>);</div>
<div class="line"><span class="lineno">  480</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  481</span>                ps-&gt;mac-&gt;state  = ps-&gt;mac-&gt;expect = 1;</div>
<div class="line"><span class="lineno">  482</span>                ps-&gt;mac-&gt;buf    = ps-&gt;mac-&gt;rxb-&gt;data;</div>
<div class="line"><span class="lineno">  483</span>                ps-&gt;rx_errors++;</div>
<div class="line"><span class="lineno">  484</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  485</span>            }</div>
<div class="line"><span class="lineno">  486</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  487</span>            <span class="keywordflow">if</span> (ps-&gt;debuglog)</div>
<div class="line"><span class="lineno">  488</span>                <span class="keywordflow">for</span> (i = 0; i &lt; r; i++) {</div>
<div class="line"><span class="lineno">  489</span>                    write(ps-&gt;debugfd, <span class="stringliteral">&quot;1&quot;</span>, 1);</div>
<div class="line"><span class="lineno">  490</span>                    write(ps-&gt;debugfd, <a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a> + i, 1);</div>
<div class="line"><span class="lineno">  491</span>                }</div>
<div class="line"><span class="lineno">  492</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  493</span>            ps-&gt;rx_bytes += r;</div>
<div class="line"><span class="lineno">  494</span>            <a class="code hl_variable" href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a> += r;</div>
<div class="line"><span class="lineno">  495</span>            ps-&gt;mac-&gt;expect -= r;</div>
<div class="line"><span class="lineno">  496</span>        }</div>
<div class="line"><span class="lineno">  497</span>        <a class="code hl_function" href="slp_8c.html#af8addd6e0b15768d09426046d6a5c76b">slp_rx</a>(ps);</div>
<div class="line"><span class="lineno">  498</span>    }</div>
<div class="line"><span class="lineno">  499</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  500</span>}</div>
<div class="ttc" id="apitcl_8c_html_a0dea8f1af961c5e9eb4425acd7c95409"><div class="ttname"><a href="pitcl_8c.html#a0dea8f1af961c5e9eb4425acd7c95409">buf</a></div><div class="ttdeci">char buf[0xffff]</div><div class="ttdef"><b>Definition</b> pitcl.c:34</div></div>
<div class="ttc" id="aslp_8c_html_af8addd6e0b15768d09426046d6a5c76b"><div class="ttname"><a href="slp_8c.html#af8addd6e0b15768d09426046d6a5c76b">slp_rx</a></div><div class="ttdeci">ssize_t slp_rx(pi_socket_t *ps, pi_buffer_t *buf, size_t len, int flags)</div><div class="ttdef"><b>Definition</b> slp.c:278</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00034">buf</a>, <a class="el" href="#l00282">pi_socket_set_timeout()</a>, and <a class="el" href="#l00278">slp_rx()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00065">pi_serial_open()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a0a652a6735dcb5a71256859121ef1562_cgraph.png" border="0" usemap="#aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_cgraph" alt=""/></div>
<map name="aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_cgraph" id="aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_cgraph">
<area shape="rect" title=" " alt="" coords="5,205,73,231"/>
<area shape="rect" href="os2serial_8c.html#a456598e5a37b644936baac33ffa2ada5" title=" " alt="" coords="121,180,273,206"/>
<area shape="poly" title=" " alt="" coords="73,210,105,205,106,210,74,215"/>
<area shape="rect" href="slp_8c.html#af8addd6e0b15768d09426046d6a5c76b" title=" " alt="" coords="169,229,225,255"/>
<area shape="poly" title=" " alt="" coords="74,221,154,233,153,238,73,226"/>
<area shape="rect" href="utils_8c.html#a135879f5a0f93242c8fdaf9a790833d8" title=" " alt="" coords="356,5,409,31"/>
<area shape="poly" title=" " alt="" coords="225,237,249,230,271,216,287,195,294,174,295,131,296,86,303,64,319,40,339,26,343,30,323,44,308,66,301,87,300,131,299,175,291,198,275,220,252,235,226,242"/>
<area shape="rect" href="pi-buffer_8c.html#aed67e3ff08313fa288837c0d685adaa4" title=" " alt="" coords="322,55,443,80"/>
<area shape="poly" title=" " alt="" coords="225,237,249,230,271,216,284,201,290,186,295,155,299,123,306,106,319,90,321,88,325,92,323,93,311,109,304,124,300,156,296,188,288,204,275,220,251,235,226,242"/>
<area shape="rect" href="pi-buffer_8c.html#af440579d61c8649154b0f0512c285606" title=" " alt="" coords="332,104,433,130"/>
<area shape="poly" title=" " alt="" coords="225,236,249,228,271,216,287,198,295,179,303,159,319,139,323,136,327,140,323,143,307,162,300,181,292,201,275,220,251,233,226,241"/>
<area shape="rect" href="pi-buffer_8c.html#a6775d9fcdb4fb3e02ce032337e1d10dc" title=" " alt="" coords="332,153,434,179"/>
<area shape="poly" title=" " alt="" coords="225,232,272,216,342,184,344,189,274,221,226,237"/>
<area shape="rect" href="debug_8c.html#ac942525fcc03cc9c77dfe0628ade03b9" title=" " alt="" coords="529,229,625,255"/>
<area shape="poly" title=" " alt="" coords="225,240,513,240,513,245,225,245"/>
<area shape="rect" href="socket_8c.html#a0d734c11092254f751f06eda9d35d7b3" title=" " alt="" coords="340,304,425,330"/>
<area shape="poly" title=" " alt="" coords="226,251,322,290,334,295,332,300,320,295,224,256"/>
<area shape="rect" href="socket_8c.html#a8fe4e2f277f57446a40cc3ccf20dd368" title=" " alt="" coords="324,403,441,428"/>
<area shape="poly" title=" " alt="" coords="208,254,252,318,285,356,323,389,328,393,325,397,319,394,281,360,248,321,204,257"/>
<area shape="rect" href="socket_8c.html#a415df518818c6813556c5607b29e833e" title=" " alt="" coords="338,353,427,379"/>
<area shape="poly" title=" " alt="" coords="213,253,260,295,322,340,330,344,328,349,320,344,256,299,210,257"/>
<area shape="rect" href="slp_8c.html#a1d28b91955f92f83aff45e1b5983261a" title=" " alt="" coords="344,255,421,280"/>
<area shape="poly" title=" " alt="" coords="226,243,329,258,328,263,225,249"/>
<area shape="rect" href="slp_8c.html#ad188b3c495c6437f9b997e23b1299254" title=" " alt="" coords="321,452,444,478"/>
<area shape="poly" title=" " alt="" coords="205,254,220,290,245,340,279,392,323,439,327,442,323,446,319,443,275,396,240,342,215,293,200,256"/>
<area shape="rect" href="pi-buffer_8c.html#aacd28fae920c743be86733c6ab3c1238" title=" " alt="" coords="518,55,636,80"/>
<area shape="poly" title=" " alt="" coords="443,65,503,65,503,70,443,70"/>
<area shape="rect" href="debug_8c.html#a11a6e0b0ea23a401ca6ce613d8664238" title=" " alt="" coords="724,229,814,255"/>
<area shape="poly" title=" " alt="" coords="625,240,708,240,708,245,625,245"/>
<area shape="rect" href="socket_8c.html#a32b1327c018fb882e8283498858bf8a0" title=" " alt="" coords="524,353,630,379"/>
<area shape="poly" title=" " alt="" coords="426,325,510,347,509,352,424,330"/>
<area shape="rect" href="socket_8c.html#aaeefde34eb00f88065ce7a51dd03a8e6" title=" " alt="" coords="508,304,646,330"/>
<area shape="poly" title=" " alt="" coords="425,314,493,314,493,320,425,320"/>
<area shape="rect" href="threadsafe_8c.html#a57e2304ed7e93f453b4fc66dff84c7c6" title=" " alt="" coords="717,304,822,330"/>
<area shape="poly" title=" " alt="" coords="629,350,701,331,703,337,631,355"/>
<area shape="rect" href="threadsafe_8c.html#a099d75170599d86ab20348b2af1e4da8" title=" " alt="" coords="710,353,829,379"/>
<area shape="poly" title=" " alt="" coords="630,364,694,364,694,369,630,369"/>
<area shape="rect" href="socket_8c.html#ad3e27d0710fe93c314822a548da2286d" title=" " alt="" coords="726,403,813,428"/>
<area shape="poly" title=" " alt="" coords="631,377,711,398,710,403,629,382"/>
<area shape="poly" title=" " alt="" coords="436,399,509,381,510,386,437,405"/>
<area shape="rect" href="socket_8c.html#af71c99cb810ee32e115acfeebcc4fdcd" title=" " alt="" coords="492,403,662,428"/>
<area shape="poly" title=" " alt="" coords="441,413,477,413,477,418,441,418"/>
<area shape="poly" title=" " alt="" coords="428,364,508,364,508,369,428,369"/>
<area shape="poly" title=" " alt="" coords="422,260,514,248,514,253,422,265"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a0a652a6735dcb5a71256859121ef1562_icgraph.png" border="0" usemap="#aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_icgraph" alt=""/></div>
<map name="aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_icgraph" id="aos2serial_8c_a0a652a6735dcb5a71256859121ef1562_icgraph">
<area shape="rect" title=" " alt="" coords="158,5,225,31"/>
<area shape="rect" href="os2serial_8c.html#ab60308506cb83fd60c2d61a0ab0e95c8" title=" " alt="" coords="5,5,110,31"/>
<area shape="poly" title=" " alt="" coords="142,21,110,21,110,16,142,16"/>
</map>
</div>

</div>
</div>
<a id="a2e5afab2de1fa817622a915b4ba4f731" name="a2e5afab2de1fa817622a915b4ba4f731"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e5afab2de1fa817622a915b4ba4f731">&#9670;&#160;</a></span>so_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int so_write </td>
          <td>(</td>
          <td class="paramtype">pi_socket_t *</td>          <td class="paramname"><span class="paramname"><em>ps</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  388</span>{</div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordtype">int</span>     nwrote,</div>
<div class="line"><span class="lineno">  390</span>        len;</div>
<div class="line"><span class="lineno">  391</span>    <span class="keyword">struct  </span>pi_skb *skb;</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  394</span>    <span class="keywordtype">int</span>     i;</div>
<div class="line"><span class="lineno">  395</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  396</span>    <span class="keywordtype">int</span>     c;  <span class="comment">/* switch */</span></div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>    <span class="keywordflow">if</span> (ps-&gt;txq) {</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>        ps-&gt;busy++;</div>
<div class="line"><span class="lineno">  401</span> </div>
<div class="line"><span class="lineno">  402</span>        skb     = ps-&gt;txq;</div>
<div class="line"><span class="lineno">  403</span>        ps-&gt;txq = skb-&gt;next;</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        len = 0;</div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">while</span> (len &lt; skb-&gt;len) {</div>
<div class="line"><span class="lineno">  407</span>            nwrote = 0;</div>
<div class="line"><span class="lineno">  408</span>            c = DosWrite(ps-&gt;mac-&gt;fd, skb-&gt;data, skb-&gt;len,</div>
<div class="line"><span class="lineno">  409</span>                      (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) &amp;nwrote);</div>
<div class="line"><span class="lineno">  410</span>            <span class="keywordflow">if</span> (nwrote &lt;= 0)</div>
<div class="line"><span class="lineno">  411</span>                <span class="keywordflow">break</span>;  <span class="comment">/* transmission failure */</span></div>
<div class="line"><span class="lineno">  412</span>            len += nwrote;</div>
<div class="line"><span class="lineno">  413</span>        }</div>
<div class="line"><span class="lineno">  414</span><span class="preprocessor">#ifndef NO_SERIAL_TRACE</span></div>
<div class="line"><span class="lineno">  415</span>        <span class="keywordflow">if</span> (ps-&gt;debuglog)</div>
<div class="line"><span class="lineno">  416</span>            <span class="keywordflow">for</span> (i = 0; i &lt; skb-&gt;len; i++) {</div>
<div class="line"><span class="lineno">  417</span>                write(ps-&gt;debugfd, <span class="stringliteral">&quot;2&quot;</span>, 1);</div>
<div class="line"><span class="lineno">  418</span>                write(ps-&gt;debugfd, skb-&gt;data + i, 1);</div>
<div class="line"><span class="lineno">  419</span>            }</div>
<div class="line"><span class="lineno">  420</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  421</span>        ps-&gt;tx_bytes += skb-&gt;len;</div>
<div class="line"><span class="lineno">  422</span>        free(skb);</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>        ps-&gt;busy--;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  427</span>    }</div>
<div class="line"><span class="lineno">  428</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  429</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00065">pi_serial_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="os2serial_8c_a2e5afab2de1fa817622a915b4ba4f731_icgraph.png" border="0" usemap="#aos2serial_8c_a2e5afab2de1fa817622a915b4ba4f731_icgraph" alt=""/></div>
<map name="aos2serial_8c_a2e5afab2de1fa817622a915b4ba4f731_icgraph" id="aos2serial_8c_a2e5afab2de1fa817622a915b4ba4f731_icgraph">
<area shape="rect" title=" " alt="" coords="158,5,228,31"/>
<area shape="rect" href="os2serial_8c.html#ab60308506cb83fd60c2d61a0ab0e95c8" title=" " alt="" coords="5,5,110,31"/>
<area shape="poly" title=" " alt="" coords="142,21,110,21,110,16,142,16"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ef3825c9845ea6880aaea633307886b2.html">libpisock</a></li><li class="navelem"><a class="el" href="os2serial_8c.html">os2serial.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
